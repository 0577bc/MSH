# ğŸ›¡ï¸ å†²çªéš”ç¦»æ¨¡å—æµ‹è¯•æ–‡æ¡£

**æµ‹è¯•æ—¥æœŸï¼š** 2025-10-07  
**æµ‹è¯•ç›®çš„ï¼š** éªŒè¯ data-conflict-manager.html çš„å†²çªéš”ç¦»åŠŸèƒ½

---

## âœ… æ›´æ–°å†…å®¹

### 1. æ·»åŠ è¿”å›æŒ‰é’®
- âœ… åœ¨é¡µé¢é¡¶éƒ¨æ·»åŠ "è¿”å›ç®¡ç†é¡µé¢"æŒ‰é’®
- âœ… ç‚¹å‡»æ—¶æœ‰ç¡®è®¤æç¤º
- âœ… è¿”å›åˆ° admin.html

---

## ğŸ§ª å†²çªéš”ç¦»æ¨¡å—åŠŸèƒ½æµ‹è¯•

### æ ¸å¿ƒåŠŸèƒ½æ¸…å•

#### 1. æ•°æ®åŠ è½½åŠŸèƒ½ âœ…
**å‡½æ•°ï¼š** `loadQuarantineData()`

**æµç¨‹ï¼š**
```javascript
1. æ£€æŸ¥ Firebase åˆå§‹åŒ–
2. ä» Firebase è¯»å– quarantine èŠ‚ç‚¹
3. è½¬æ¢æ•°æ®æ ¼å¼
4. æ˜¾ç¤ºéš”ç¦»æ•°æ®åˆ—è¡¨
5. æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
```

**æµ‹è¯•æ­¥éª¤ï¼š**
1. è®¿é—®é¡µé¢ï¼š`tools/msh-system/data-conflict-manager.html`
2. ç‚¹å‡»"ğŸ›¡ï¸ å†²çªéš”ç¦»"æ ‡ç­¾
3. ç‚¹å‡»"ğŸ”„ åˆ·æ–°éš”ç¦»æ•°æ®"æŒ‰é’®
4. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—

**é¢„æœŸç»“æœï¼š**
```javascript
âœ… "ğŸ”„ å¼€å§‹åŠ è½½éš”ç¦»æ•°æ®..."
âœ… "ğŸ“Š åŠ è½½åˆ° X æ¡éš”ç¦»æ•°æ®"
âœ… æ˜¾ç¤ºéš”ç¦»æ•°æ®åˆ—è¡¨
```

#### 2. æ˜¾ç¤ºéš”ç¦»æ•°æ® âœ…
**å‡½æ•°ï¼š** `displayQuarantineData()`

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºéš”ç¦»æ•°æ®åˆ—è¡¨
- åŒºåˆ†çŠ¶æ€ï¼ˆå¾…å¤„ç†/å·²è§£å†³ï¼‰
- ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…

**æµ‹è¯•æ­¥éª¤ï¼š**
1. åŠ è½½éš”ç¦»æ•°æ®å
2. æ£€æŸ¥æ•°æ®åˆ—è¡¨æ˜¾ç¤º
3. ç‚¹å‡»æŸæ¡æ•°æ®

**é¢„æœŸç»“æœï¼š**
```
âœ… åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
âœ… çŠ¶æ€æ ‡è¯†æ¸…æ™°
âœ… ç‚¹å‡»åæ˜¾ç¤ºè¯¦æƒ…
```

#### 3. ç»Ÿè®¡ä¿¡æ¯æ›´æ–° âœ…
**å‡½æ•°ï¼š** `updateQuarantineStats()`

**æ˜¾ç¤ºå†…å®¹ï¼š**
- æ€»æ•°
- å·²è§£å†³æ•°é‡
- å¾…å¤„ç†æ•°é‡

**æµ‹è¯•æ­¥éª¤ï¼š**
1. åŠ è½½æ•°æ®åæ£€æŸ¥ç»Ÿè®¡å¡ç‰‡
2. éªŒè¯æ•°å­—æ˜¯å¦æ­£ç¡®

**é¢„æœŸç»“æœï¼š**
```
âœ… æ€»æ•° = æ•°æ®æ€»æ¡æ•°
âœ… å·²è§£å†³ = status === 'resolved' çš„æ•°é‡
âœ… å¾…å¤„ç† = æ€»æ•° - å·²è§£å†³
```

#### 4. è§£å†³éš”ç¦»é¡¹ âœ…
**å‡½æ•°ï¼š** `resolveQuarantineItem()`

**æµç¨‹ï¼š**
```javascript
1. æ£€æŸ¥æ˜¯å¦é€‰ä¸­é¡¹
2. æ›´æ–°çŠ¶æ€ä¸º 'resolved'
3. åŒæ­¥åˆ° Firebase
4. åˆ·æ–°æ˜¾ç¤º
```

**æµ‹è¯•æ­¥éª¤ï¼š**
1. é€‰ä¸­ä¸€æ¡å¾…å¤„ç†æ•°æ®
2. ç‚¹å‡»"âœ… è§£å†³é€‰ä¸­é¡¹"æŒ‰é’®
3. ç¡®è®¤æ“ä½œ

**é¢„æœŸç»“æœï¼š**
```
âœ… çŠ¶æ€å˜ä¸º"å·²è§£å†³"
âœ… Firebase æ•°æ®æ›´æ–°
âœ… åˆ—è¡¨åˆ·æ–°æ˜¾ç¤º
```

#### 5. æ¢å¤éš”ç¦»é¡¹ âœ…
**å‡½æ•°ï¼š** `restoreQuarantineItem()`

**æµç¨‹ï¼š**
```javascript
1. æ£€æŸ¥æ˜¯å¦é€‰ä¸­é¡¹
2. ä»éš”ç¦»åŒºåˆ é™¤
3. æ¢å¤åˆ°åŸå§‹ä½ç½®
4. åŒæ­¥åˆ° Firebase
```

**æµ‹è¯•æ­¥éª¤ï¼š**
1. é€‰ä¸­ä¸€æ¡æ•°æ®
2. ç‚¹å‡»"â†©ï¸ æ¢å¤é€‰ä¸­é¡¹"æŒ‰é’®
3. ç¡®è®¤æ“ä½œ

**é¢„æœŸç»“æœï¼š**
```
âœ… ä»éš”ç¦»åŒºåˆ é™¤
âœ… æ•°æ®æ¢å¤åˆ°åŸä½ç½®
âœ… Firebase åŒæ­¥æˆåŠŸ
```

#### 6. åˆ é™¤éš”ç¦»é¡¹ âœ…
**å‡½æ•°ï¼š** `deleteQuarantineItem()`

**æµç¨‹ï¼š**
```javascript
1. æ£€æŸ¥æ˜¯å¦é€‰ä¸­é¡¹
2. ç¡®è®¤åˆ é™¤æ“ä½œ
3. ä» Firebase åˆ é™¤
4. åˆ·æ–°åˆ—è¡¨
```

**æµ‹è¯•æ­¥éª¤ï¼š**
1. é€‰ä¸­ä¸€æ¡æ•°æ®
2. ç‚¹å‡»"ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­é¡¹"æŒ‰é’®
3. ç¡®è®¤åˆ é™¤

**é¢„æœŸç»“æœï¼š**
```
âœ… ç¡®è®¤æç¤ºæ˜¾ç¤º
âœ… æ•°æ®ä» Firebase åˆ é™¤
âœ… åˆ—è¡¨æ›´æ–°
```

#### 7. æ¸…ç©ºæ‰€æœ‰éš”ç¦» âœ…
**å‡½æ•°ï¼š** `clearAllQuarantine()`

**æµç¨‹ï¼š**
```javascript
1. ç¡®è®¤æ“ä½œ
2. åˆ é™¤æ‰€æœ‰éš”ç¦»æ•°æ®
3. åŒæ­¥åˆ° Firebase
4. æ¸…ç©ºåˆ—è¡¨
```

**æµ‹è¯•æ­¥éª¤ï¼š**
1. ç‚¹å‡»"ğŸ§¹ æ¸…ç©ºæ‰€æœ‰éš”ç¦»"æŒ‰é’®
2. ç¡®è®¤æ“ä½œ

**é¢„æœŸç»“æœï¼š**
```
âœ… å±é™©æ“ä½œç¡®è®¤æç¤º
âœ… æ‰€æœ‰æ•°æ®åˆ é™¤
âœ… Firebase åŒæ­¥
âœ… åˆ—è¡¨æ¸…ç©º
```

---

## ğŸ” æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1ï¼šæ­£å¸¸æ•°æ®åŠ è½½
```
æ­¥éª¤ï¼š
1. è®¿é—®é¡µé¢
2. ç‚¹å‡»å†²çªéš”ç¦»æ ‡ç­¾
3. ç‚¹å‡»åˆ·æ–°æŒ‰é’®

é¢„æœŸï¼š
âœ… æ§åˆ¶å°æ˜¾ç¤ºåŠ è½½æ—¥å¿—
âœ… æ•°æ®æ­£ç¡®æ˜¾ç¤º
âœ… ç»Ÿè®¡ä¿¡æ¯å‡†ç¡®
```

### åœºæ™¯ 2ï¼šç©ºæ•°æ®å¤„ç†
```
æ­¥éª¤ï¼š
1. Firebase quarantine èŠ‚ç‚¹ä¸ºç©º
2. åˆ·æ–°éš”ç¦»æ•°æ®

é¢„æœŸï¼š
âœ… æ˜¾ç¤º"æš‚æ— éš”ç¦»æ•°æ®"
âœ… ç»Ÿè®¡å…¨éƒ¨ä¸º 0
âœ… ä¸æŠ¥é”™
```

### åœºæ™¯ 3ï¼šæ•°æ®æ“ä½œæµç¨‹
```
æ­¥éª¤ï¼š
1. åŠ è½½éš”ç¦»æ•°æ®
2. é€‰ä¸­ä¸€æ¡æ•°æ®
3. ç‚¹å‡»è§£å†³æŒ‰é’®
4. éªŒè¯çŠ¶æ€æ›´æ–°

é¢„æœŸï¼š
âœ… çŠ¶æ€å˜ä¸ºå·²è§£å†³
âœ… Firebase åŒæ­¥æˆåŠŸ
âœ… é¡µé¢æ˜¾ç¤ºæ›´æ–°
```

### åœºæ™¯ 4ï¼šæ¢å¤æ•°æ®åŠŸèƒ½
```
æ­¥éª¤ï¼š
1. é€‰ä¸­éš”ç¦»æ•°æ®
2. ç‚¹å‡»æ¢å¤æŒ‰é’®
3. æ£€æŸ¥åŸå§‹ä½ç½®

é¢„æœŸï¼š
âœ… æ•°æ®ä»éš”ç¦»åŒºåˆ é™¤
âœ… æ•°æ®æ¢å¤åˆ°åŸä½ç½®ï¼ˆgroups/attendanceRecordsï¼‰
âœ… åŸå§‹æ•°æ®å®Œæ•´æ— æŸ
```

---

## ğŸ› æ½œåœ¨é—®é¢˜æ£€æŸ¥

### 1. Firebase åˆå§‹åŒ– âœ…
**æ£€æŸ¥ç‚¹ï¼š**
- Firebase æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
- æ•°æ®åº“å¼•ç”¨æ˜¯å¦æœ‰æ•ˆ

**éªŒè¯ï¼š**
```javascript
console.log('Firebase apps:', firebase.apps.length);
console.log('Database:', firebase.database());
```

### 2. æ•°æ®ç»“æ„ âœ…
**æ£€æŸ¥ç‚¹ï¼š**
- quarantine èŠ‚ç‚¹ç»“æ„
- æ•°æ®å­—æ®µå®Œæ•´æ€§

**é¢„æœŸç»“æ„ï¼š**
```javascript
{
  "quarantine": {
    "uniqueId": {
      "type": "conflict",
      "data": {...},
      "reason": "æè¿°",
      "quarantinedAt": "æ—¶é—´æˆ³",
      "status": "pending/resolved"
    }
  }
}
```

### 3. é”™è¯¯å¤„ç† âœ…
**æ£€æŸ¥ç‚¹ï¼š**
- ç½‘ç»œé”™è¯¯å¤„ç†
- æ•°æ®æ ¼å¼é”™è¯¯å¤„ç†
- ç”¨æˆ·æ“ä½œé”™è¯¯æç¤º

**éªŒè¯ï¼š**
- æ–­ç½‘æƒ…å†µæµ‹è¯•
- æ— æ•ˆæ•°æ®æµ‹è¯•
- æœªé€‰ä¸­é¡¹æ“ä½œæµ‹è¯•

---

## ğŸ“Š æµ‹è¯•ç»“æœè®°å½•

### åŠŸèƒ½æµ‹è¯•

| åŠŸèƒ½ | çŠ¶æ€ | å¤‡æ³¨ |
|-----|------|------|
| åŠ è½½éš”ç¦»æ•°æ® | â–¡ å¾…æµ‹è¯• | - |
| æ˜¾ç¤ºæ•°æ®åˆ—è¡¨ | â–¡ å¾…æµ‹è¯• | - |
| ç»Ÿè®¡ä¿¡æ¯ | â–¡ å¾…æµ‹è¯• | - |
| è§£å†³éš”ç¦»é¡¹ | â–¡ å¾…æµ‹è¯• | - |
| æ¢å¤éš”ç¦»é¡¹ | â–¡ å¾…æµ‹è¯• | - |
| åˆ é™¤éš”ç¦»é¡¹ | â–¡ å¾…æµ‹è¯• | - |
| æ¸…ç©ºæ‰€æœ‰éš”ç¦» | â–¡ å¾…æµ‹è¯• | - |
| è¿”å›æŒ‰é’® | â–¡ å¾…æµ‹è¯• | - |

### æµ‹è¯•ç¯å¢ƒ

- **æµè§ˆå™¨ï¼š** ___________
- **Firebase çŠ¶æ€ï¼š** ___________
- **æ•°æ®é‡ï¼š** ___________ æ¡

### å‘ç°çš„é—®é¢˜

1. **é—®é¢˜æè¿°ï¼š** ___________
   - ä¸¥é‡ç¨‹åº¦ï¼šâ–¡ é«˜ â–¡ ä¸­ â–¡ ä½
   - çŠ¶æ€ï¼šâ–¡ å¾…ä¿®å¤ â–¡ å·²ä¿®å¤

2. **é—®é¢˜æè¿°ï¼š** ___________
   - ä¸¥é‡ç¨‹åº¦ï¼šâ–¡ é«˜ â–¡ ä¸­ â–¡ ä½
   - çŠ¶æ€ï¼šâ–¡ å¾…ä¿®å¤ â–¡ å·²ä¿®å¤

---

## ğŸ”„ å¿«é€Ÿæµ‹è¯•è„šæœ¬

### æ§åˆ¶å°æµ‹è¯•å‘½ä»¤

```javascript
// 1. æ£€æŸ¥ Firebase åˆå§‹åŒ–
console.log('Firebase çŠ¶æ€:', firebase.apps.length > 0 ? 'âœ… å·²åˆå§‹åŒ–' : 'âŒ æœªåˆå§‹åŒ–');

// 2. æ‰‹åŠ¨åŠ è½½æ•°æ®
loadQuarantineData();

// 3. æ£€æŸ¥éš”ç¦»æ•°æ®
console.log('éš”ç¦»æ•°æ®:', quarantineData);

// 4. æŸ¥çœ‹ç»Ÿè®¡
console.log('ç»Ÿè®¡:', {
  total: quarantineData.length,
  resolved: quarantineData.filter(i => i.status === 'resolved').length,
  pending: quarantineData.filter(i => i.status === 'pending').length
});
```

### æ¨¡æ‹Ÿéš”ç¦»æ•°æ®

```javascript
// åˆ›å»ºæµ‹è¯•æ•°æ®
const testQuarantineData = {
  type: 'uuid_conflict',
  data: {
    name: 'æµ‹è¯•æˆå‘˜',
    uuid: 'test-uuid-123',
    group: 'group1'
  },
  reason: 'UUIDå†²çªæµ‹è¯•',
  quarantinedAt: new Date().toISOString(),
  status: 'pending'
};

// ä¿å­˜åˆ° Firebase
firebase.database().ref('quarantine').push(testQuarantineData);
```

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### å‡†å¤‡å·¥ä½œ
- [ ] Firebase æ­£ç¡®é…ç½®
- [ ] é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] æ§åˆ¶å°æ— æŠ¥é”™

### åŸºç¡€åŠŸèƒ½
- [ ] è¿”å›æŒ‰é’®æ­£å¸¸å·¥ä½œ
- [ ] æ ‡ç­¾é¡µåˆ‡æ¢æ­£å¸¸
- [ ] æ•°æ®åŠ è½½æ­£å¸¸

### å†²çªéš”ç¦»åŠŸèƒ½
- [ ] åˆ·æ–°æ•°æ®æˆåŠŸ
- [ ] æ•°æ®åˆ—è¡¨æ˜¾ç¤º
- [ ] ç»Ÿè®¡ä¿¡æ¯å‡†ç¡®
- [ ] è§£å†³åŠŸèƒ½æ­£å¸¸
- [ ] æ¢å¤åŠŸèƒ½æ­£å¸¸
- [ ] åˆ é™¤åŠŸèƒ½æ­£å¸¸
- [ ] æ¸…ç©ºåŠŸèƒ½æ­£å¸¸

### å¼‚å¸¸å¤„ç†
- [ ] æœªé€‰ä¸­é¡¹æ“ä½œæç¤º
- [ ] ç½‘ç»œé”™è¯¯å¤„ç†
- [ ] ç©ºæ•°æ®å¤„ç†

---

## ğŸ“ æµ‹è¯•æ€»ç»“

**æµ‹è¯•å®Œæˆæ—¥æœŸï¼š** ___________

**æ€»ä½“è¯„ä»·ï¼š**
- â–¡ åŠŸèƒ½å®Œå…¨æ­£å¸¸
- â–¡ åŠŸèƒ½åŸºæœ¬æ­£å¸¸ï¼Œæœ‰å°é—®é¢˜
- â–¡ å­˜åœ¨é‡è¦é—®é¢˜éœ€è¦ä¿®å¤

**å»ºè®®ï¼š**
```
è®°å½•æµ‹è¯•è¿‡ç¨‹ä¸­çš„å‘ç°å’Œå»ºè®®...
```

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2025-10-07  
**ç»´æŠ¤è€…ï¼š** MSH å¼€å‘å›¢é˜Ÿ


