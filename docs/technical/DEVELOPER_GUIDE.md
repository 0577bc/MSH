# MSHç­¾åˆ°ç³»ç»Ÿ - å¼€å‘è€…æŒ‡å—

## ğŸ“‹ å¼€å‘æŒ‡å—æ¦‚è¿°

**ç³»ç»Ÿåç§°**ï¼šMSHç­¾åˆ°ç³»ç»Ÿ  
**ç‰ˆæœ¬**ï¼š2.0  
**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2025-09-27  
**ç»´æŠ¤è€…**ï¼šMSHæŠ€æœ¯å›¢é˜Ÿ  

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### 1. æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MSHç­¾åˆ°ç³»ç»Ÿæ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‰ç«¯å±‚ (Frontend)                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  ç­¾åˆ°é¡µé¢   â”‚ â”‚  ç®¡ç†é¡µé¢   â”‚ â”‚  æŠ¥è¡¨é¡µé¢   â”‚           â”‚
â”‚  â”‚ index.html  â”‚ â”‚ admin.html  â”‚ â”‚ summary.htmlâ”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ æ•°æ®ç®¡ç†å™¨  â”‚ â”‚ è·Ÿè¸ªç®¡ç†å™¨  â”‚ â”‚ å·¥å…·å‡½æ•°    â”‚           â”‚
â”‚  â”‚NewDataMgr   â”‚ â”‚SundayTrack  â”‚ â”‚ utils.js    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚ (Data Layer)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ æœ¬åœ°å­˜å‚¨    â”‚ â”‚ äº‘ç«¯å­˜å‚¨    â”‚ â”‚ ç¼“å­˜ç®¡ç†    â”‚           â”‚
â”‚  â”‚localStorage â”‚ â”‚ Firebase    â”‚ â”‚ CacheMgr    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**ï¼šåŸç”ŸJavaScript (ES6+)
- **åç«¯æœåŠ¡**ï¼šFirebase Realtime Database
- **æ•°æ®ç®¡ç†**ï¼šNewDataManager (è‡ªå®šä¹‰)
- **ç¼“å­˜ç­–ç•¥**ï¼šlocalStorage + sessionStorage
- **UIæ¡†æ¶**ï¼šåŸç”ŸHTML5 + CSS3
- **æ„å»ºå·¥å…·**ï¼šæ— æ„å»ºå·¥å…·ï¼Œç›´æ¥éƒ¨ç½²

### 3. æ ¸å¿ƒæ¨¡å—

#### 3.1 NewDataManager (æ•°æ®ç®¡ç†å™¨)
```javascript
class NewDataManager {
  // æ ¸å¿ƒåŠŸèƒ½
  async loadAllDataFromFirebase()
  async saveData(dataType, data)
  async performManualSync()
  
  // æ•°æ®ç®¡ç†
  getData(dataType)
  setData(dataType, data)
  markDataChange(dataType, changeType, details)
  
  // åŒæ­¥æœºåˆ¶
  enableAutoSync()
  disableAutoSync()
  getSyncStatus()
}
```

#### 3.2 SundayTrackingManager (ä¸»æ—¥è·Ÿè¸ªç®¡ç†å™¨)
```javascript
const SundayTrackingManager = {
  // æ ¸å¿ƒåŠŸèƒ½
  generateTrackingList()
  getTrackingRecords()
  saveTrackingRecord(record)
  
  // äº‹ä»¶ç®¡ç†
  terminateTracking(recordId, terminationRecord)
  restartEvent(recordId, restartRecord)
  
  // ç¼“å­˜ç®¡ç†
  _isCacheValid()
  _clearCache()
  _generateDataHash()
}
```

#### 3.3 å·¥å…·å‡½æ•°æ¨¡å—
```javascript
// é€šç”¨å·¥å…·
window.utils = {
  initializeFirebase()
  generateUUID()
  formatDateForDisplay()
  getStatusText()
  
  // æ•°æ®å¤„ç†
  loadExcludedMembers()
  isMemberExcluded()
  sortGroups()
  sortMembersByName()
  
  // å®‰å…¨å·¥å…·
  preventDuplicateExecution()
  createSafeSaveFunction()
  createSafeSyncFunction()
}
```

## ğŸ”§ å¼€å‘ç¯å¢ƒè®¾ç½®

### 1. ç¯å¢ƒè¦æ±‚

- **Node.js**ï¼šv14+ (å¯é€‰ï¼Œç”¨äºå¼€å‘å·¥å…·)
- **æµè§ˆå™¨**ï¼šChrome 80+, Firefox 75+, Safari 13+, Edge 80+
- **ç¼–è¾‘å™¨**ï¼šVS Code, WebStorm, æˆ–å…¶ä»–ç°ä»£ç¼–è¾‘å™¨
- **Git**ï¼šç‰ˆæœ¬æ§åˆ¶

### 2. é¡¹ç›®ç»“æ„

```
MSH/
â”œâ”€â”€ index.html                 # ä¸»ç­¾åˆ°é¡µé¢
â”œâ”€â”€ admin.html                 # ç®¡ç†é¡µé¢
â”œâ”€â”€ summary.html               # æŠ¥è¡¨é¡µé¢
â”œâ”€â”€ sunday-tracking.html       # ä¸»æ—¥è·Ÿè¸ªé¡µé¢
â”œâ”€â”€ group-management.html      # å°ç»„ç®¡ç†é¡µé¢
â”œâ”€â”€ delete-management.html     # åˆ é™¤ç®¡ç†é¡µé¢
â”œâ”€â”€ personal-page.html         # ä¸ªäººé¡µé¢
â”œâ”€â”€ tracking-event-detail.html # äº‹ä»¶è¯¦æƒ…é¡µé¢
â”œâ”€â”€ daily-report.html          # æ—¥æŠ¥è¡¨é¡µé¢
â”œâ”€â”€ attendance-records.html    # ç­¾åˆ°è®°å½•é¡µé¢
â”œâ”€â”€ firebase-monitor.html      # Firebaseç›‘æ§é¡µé¢
â”œâ”€â”€ manifest.json              # PWAé…ç½®
â”œâ”€â”€ config.js                  # é…ç½®æ–‡ä»¶
â”œâ”€â”€ src/                       # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.js                # ä¸»é¡µé¢é€»è¾‘
â”‚   â”œâ”€â”€ admin.js               # ç®¡ç†é¡µé¢é€»è¾‘
â”‚   â”œâ”€â”€ summary.js             # æŠ¥è¡¨é¡µé¢é€»è¾‘
â”‚   â”œâ”€â”€ sunday-tracking.js     # ä¸»æ—¥è·Ÿè¸ªé€»è¾‘
â”‚   â”œâ”€â”€ group-management.js    # å°ç»„ç®¡ç†é€»è¾‘
â”‚   â”œâ”€â”€ delete-management.js   # åˆ é™¤ç®¡ç†é€»è¾‘
â”‚   â”œâ”€â”€ personal-page.js       # ä¸ªäººé¡µé¢é€»è¾‘
â”‚   â”œâ”€â”€ tracking-event-detail.js # äº‹ä»¶è¯¦æƒ…é€»è¾‘
â”‚   â”œâ”€â”€ daily-report.js        # æ—¥æŠ¥è¡¨é€»è¾‘
â”‚   â”œâ”€â”€ attendance-records.js  # ç­¾åˆ°è®°å½•é€»è¾‘
â”‚   â”œâ”€â”€ new-data-manager.js    # æ•°æ®ç®¡ç†å™¨
â”‚   â”œâ”€â”€ utils.js               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ style.css              # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ service-worker.js      # Service Worker
â”‚   â””â”€â”€ ...                    # å…¶ä»–æ¨¡å—
â”œâ”€â”€ docs/                      # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ tools/                     # å·¥å…·ç›®å½•
â””â”€â”€ simple-memory-system/      # å¤–éƒ¨è®°å¿†ç³»ç»Ÿ
```

### 3. å¼€å‘å·¥å…·é…ç½®

#### 3.1 VS Code é…ç½®
```json
{
  "editor.tabSize": 2,
  "editor.insertSpaces": true,
  "editor.detectIndentation": false,
  "files.associations": {
    "*.js": "javascript"
  },
  "emmet.includeLanguages": {
    "javascript": "javascriptreact"
  }
}
```

#### 3.2 ä»£ç æ ¼å¼åŒ–
```javascript
// ä½¿ç”¨Prettieræ ¼å¼åŒ–ä»£ç 
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2
}
```

## ğŸ“ ç¼–ç è§„èŒƒ

### 1. JavaScript ç¼–ç è§„èŒƒ

#### 1.1 å‘½åè§„èŒƒ
```javascript
// å˜é‡å’Œå‡½æ•°ï¼šé©¼å³°å‘½å
const memberName = 'å¼ ä¸‰';
function loadMemberData() {}

// å¸¸é‡ï¼šå…¨å¤§å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
const MAX_RETRY_COUNT = 3;
const FIREBASE_CONFIG = {};

// ç±»åï¼šå¸•æ–¯å¡å‘½å
class NewDataManager {}
const SundayTrackingManager = {};

// ç§æœ‰æ–¹æ³•ï¼šä¸‹åˆ’çº¿å‰ç¼€
function _generateDataHash() {}
function _isCacheValid() {}
```

#### 1.2 å‡½æ•°è§„èŒƒ
```javascript
// å‡½æ•°å£°æ˜
async function loadDataFromFirebase() {
  try {
    // å‡½æ•°ä½“
    const result = await firebase.database().ref().once('value');
    return result.val();
  } catch (error) {
    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
    throw error;
  }
}

// ç®­å¤´å‡½æ•°
const processData = (data) => {
  return data.map(item => ({
    ...item,
    processed: true
  }));
};
```

#### 1.3 é”™è¯¯å¤„ç†
```javascript
// å¼‚æ­¥å‡½æ•°é”™è¯¯å¤„ç†
async function saveData(data) {
  try {
    await newDataManager.saveData('groups', data);
    console.log('æ•°æ®ä¿å­˜æˆåŠŸ');
  } catch (error) {
    console.error('æ•°æ®ä¿å­˜å¤±è´¥:', error);
    // ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
    alert('æ•°æ®ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
  }
}

// åŒæ­¥å‡½æ•°é”™è¯¯å¤„ç†
function validateData(data) {
  if (!data || typeof data !== 'object') {
    throw new Error('æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
  }
  return true;
}
```

### 2. HTML ç¼–ç è§„èŒƒ

#### 2.1 ç»“æ„è§„èŒƒ
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é¡µé¢æ ‡é¢˜</title>
  <link rel="stylesheet" href="src/style.css">
</head>
<body>
  <!-- é¡µé¢å†…å®¹ -->
  <script src="config.js"></script>
  <script src="src/utils.js"></script>
  <script src="src/main.js"></script>
</body>
</html>
```

#### 2.2 è¯­ä¹‰åŒ–æ ‡ç­¾
```html
<!-- ä½¿ç”¨è¯­ä¹‰åŒ–æ ‡ç­¾ -->
<header>
  <nav>
    <ul>
      <li><a href="index.html">ç­¾åˆ°</a></li>
      <li><a href="admin.html">ç®¡ç†</a></li>
    </ul>
  </nav>
</header>

<main>
  <section>
    <h1>é¡µé¢æ ‡é¢˜</h1>
    <article>
      <!-- å†…å®¹ -->
    </article>
  </section>
</main>

<footer>
  <p>&copy; 2025 MSHç³»ç»Ÿ</p>
</footer>
```

### 3. CSS ç¼–ç è§„èŒƒ

#### 3.1 å‘½åè§„èŒƒ
```css
/* BEMå‘½åè§„èŒƒ */
.member-card { }
.member-card__title { }
.member-card__content { }
.member-card--active { }

/* åŠŸèƒ½ç±»å‘½å */
.btn-primary { }
.btn-secondary { }
.form-group { }
.form-control { }
```

#### 3.2 æ ·å¼ç»„ç»‡
```css
/* 1. é‡ç½®æ ·å¼ */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* 2. åŸºç¡€æ ·å¼ */
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  line-height: 1.6;
  color: #333;
}

/* 3. å¸ƒå±€æ ·å¼ */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

/* 4. ç»„ä»¶æ ·å¼ */
.member-card {
  background: #fff;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
```

## ğŸ”„ æ•°æ®æµç®¡ç†

### 1. æ•°æ®æµæ¶æ„

```
ç”¨æˆ·æ“ä½œ â†’ ä¸šåŠ¡é€»è¾‘ â†’ æ•°æ®ç®¡ç†å™¨ â†’ æœ¬åœ°å­˜å‚¨/äº‘ç«¯å­˜å‚¨
    â†“           â†“           â†“              â†“
  ç•Œé¢æ›´æ–° â† çŠ¶æ€ç®¡ç† â† ç¼“å­˜ç®¡ç† â† æ•°æ®åŒæ­¥
```

### 2. æ•°æ®åŒæ­¥æœºåˆ¶

#### 2.1 è‡ªåŠ¨åŒæ­¥
```javascript
// å¯ç”¨è‡ªåŠ¨åŒæ­¥
newDataManager.enableAutoSync();

// åŒæ­¥é—´éš”è®¾ç½®
newDataManager.setSyncInterval(30000); // 30ç§’

// æ•°æ®å˜æ›´ç›‘å¬
newDataManager.onDataChange((dataType, changeType, details) => {
  console.log(`æ•°æ®å˜æ›´: ${dataType}, ç±»å‹: ${changeType}`);
  // è§¦å‘åŒæ­¥
  newDataManager.performAutoSync();
});
```

#### 2.2 æ‰‹åŠ¨åŒæ­¥
```javascript
// æ‰‹åŠ¨åŒæ­¥
async function performManualSync() {
  try {
    const result = await newDataManager.performManualSync();
    if (result.success) {
      console.log('åŒæ­¥æˆåŠŸ');
    } else {
      console.error('åŒæ­¥å¤±è´¥:', result.errors);
    }
  } catch (error) {
    console.error('åŒæ­¥å¼‚å¸¸:', error);
  }
}
```

### 3. ç¼“å­˜ç­–ç•¥

#### 3.1 ç¼“å­˜å±‚çº§
```javascript
// 1. å†…å­˜ç¼“å­˜ (æœ€å¿«)
const memoryCache = new Map();

// 2. sessionStorage (ä¼šè¯çº§)
sessionStorage.setItem('temp_data', JSON.stringify(data));

// 3. localStorage (æŒä¹…åŒ–)
localStorage.setItem('msh_groups', JSON.stringify(groups));

// 4. Firebase (äº‘ç«¯)
firebase.database().ref('groups').set(groups);
```

#### 3.2 ç¼“å­˜å¤±æ•ˆ
```javascript
// ç¼“å­˜å¤±æ•ˆç­–ç•¥
const cacheConfig = {
  expiry: 30 * 60 * 1000, // 30åˆ†é’Ÿ
  maxSize: 100, // æœ€å¤§ç¼“å­˜é¡¹æ•°
  strategy: 'LRU' // æœ€è¿‘æœ€å°‘ä½¿ç”¨
};

// æ£€æŸ¥ç¼“å­˜æœ‰æ•ˆæ€§
function isCacheValid(cacheKey) {
  const cached = localStorage.getItem(cacheKey);
  if (!cached) return false;
  
  const { data, timestamp } = JSON.parse(cached);
  const now = Date.now();
  
  return (now - timestamp) < cacheConfig.expiry;
}
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

#### 1.1 æµ‹è¯•æ¡†æ¶
```javascript
// ä½¿ç”¨åŸç”ŸJavaScriptæµ‹è¯•
function runTests() {
  const tests = [
    testGenerateUUID,
    testValidateData,
    testFormatDate
  ];
  
  tests.forEach(test => {
    try {
      test();
      console.log(`âœ… ${test.name} é€šè¿‡`);
    } catch (error) {
      console.error(`âŒ ${test.name} å¤±è´¥:`, error.message);
    }
  });
}

// æµ‹è¯•ç”¨ä¾‹
function testGenerateUUID() {
  const uuid = generateUUID();
  assert(typeof uuid === 'string', 'UUIDåº”è¯¥æ˜¯å­—ç¬¦ä¸²');
  assert(uuid.length === 36, 'UUIDé•¿åº¦åº”è¯¥æ˜¯36');
  assert(uuid.includes('-'), 'UUIDåº”è¯¥åŒ…å«è¿å­—ç¬¦');
}
```

#### 1.2 æ–­è¨€å‡½æ•°
```javascript
// ç®€å•æ–­è¨€å‡½æ•°
function assert(condition, message) {
  if (!condition) {
    throw new Error(`æ–­è¨€å¤±è´¥: ${message}`);
  }
}

// æ·±åº¦æ¯”è¾ƒ
function assertEqual(actual, expected, message) {
  if (JSON.stringify(actual) !== JSON.stringify(expected)) {
    throw new Error(`æ–­è¨€å¤±è´¥: ${message}\næœŸæœ›: ${JSON.stringify(expected)}\nå®é™…: ${JSON.stringify(actual)}`);
  }
}
```

### 2. é›†æˆæµ‹è¯•

#### 2.1 æ•°æ®æµæµ‹è¯•
```javascript
// æµ‹è¯•å®Œæ•´æ•°æ®æµ
async function testDataFlow() {
  try {
    // 1. åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
    const dataManager = new NewDataManager();
    
    // 2. åŠ è½½æ•°æ®
    await dataManager.loadAllDataFromFirebase();
    
    // 3. ä¿®æ”¹æ•°æ®
    const groups = dataManager.getData('groups');
    groups['æµ‹è¯•å°ç»„'] = [];
    
    // 4. ä¿å­˜æ•°æ®
    await dataManager.saveData('groups', groups);
    
    // 5. éªŒè¯æ•°æ®
    const savedGroups = dataManager.getData('groups');
    assert(savedGroups['æµ‹è¯•å°ç»„'], 'æµ‹è¯•å°ç»„åº”è¯¥å­˜åœ¨');
    
    console.log('âœ… æ•°æ®æµæµ‹è¯•é€šè¿‡');
  } catch (error) {
    console.error('âŒ æ•°æ®æµæµ‹è¯•å¤±è´¥:', error);
  }
}
```

### 3. æ€§èƒ½æµ‹è¯•

#### 3.1 æ€§èƒ½ç›‘æ§
```javascript
// æ€§èƒ½ç›‘æ§å·¥å…·
class PerformanceMonitor {
  constructor() {
    this.metrics = new Map();
  }
  
  start(name) {
    this.metrics.set(name, performance.now());
  }
  
  end(name) {
    const startTime = this.metrics.get(name);
    if (startTime) {
      const duration = performance.now() - startTime;
      console.log(`â±ï¸ ${name}: ${duration.toFixed(2)}ms`);
      return duration;
    }
  }
  
  measure(name, fn) {
    this.start(name);
    const result = fn();
    this.end(name);
    return result;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const monitor = new PerformanceMonitor();
monitor.measure('æ•°æ®åŠ è½½', () => {
  loadAllDataFromFirebase();
});
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. éƒ¨ç½²å‡†å¤‡

#### 1.1 ç¯å¢ƒæ£€æŸ¥
```bash
# æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
find . -name "*.html" -o -name "*.js" -o -name "*.css" | wc -l

# æ£€æŸ¥è¯­æ³•é”™è¯¯
node -c src/*.js

# æ£€æŸ¥æ–‡ä»¶å¤§å°
du -sh src/
```

#### 1.2 é…ç½®æ£€æŸ¥
```javascript
// æ£€æŸ¥Firebaseé…ç½®
if (!window.firebaseConfig) {
  throw new Error('Firebaseé…ç½®ç¼ºå¤±');
}

// æ£€æŸ¥å¿…éœ€æ–‡ä»¶
const requiredFiles = [
  'index.html',
  'src/main.js',
  'src/utils.js',
  'src/new-data-manager.js'
];

requiredFiles.forEach(file => {
  if (!document.querySelector(`script[src="${file}"]`)) {
    console.warn(`ç¼ºå°‘å¿…éœ€æ–‡ä»¶: ${file}`);
  }
});
```

### 2. éƒ¨ç½²æ­¥éª¤

#### 2.1 é™æ€æ–‡ä»¶éƒ¨ç½²
```bash
# 1. å‹ç¼©æ–‡ä»¶
tar -czf msh-system.tar.gz .

# 2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp msh-system.tar.gz user@server:/var/www/

# 3. è§£å‹æ–‡ä»¶
ssh user@server "cd /var/www && tar -xzf msh-system.tar.gz"

# 4. è®¾ç½®æƒé™
ssh user@server "chmod -R 755 /var/www/msh-system"
```

#### 2.2 æœåŠ¡å™¨é…ç½®
```nginx
# Nginxé…ç½®
server {
    listen 80;
    server_name msh.example.com;
    root /var/www/msh-system;
    index index.html;
    
    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # HTMLæ–‡ä»¶ä¸ç¼“å­˜
    location ~* \.html$ {
        expires -1;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # æ”¯æŒPWA
    location /manifest.json {
        add_header Content-Type application/json;
    }
    
    # æ”¯æŒService Worker
    location /service-worker.js {
        add_header Content-Type application/javascript;
    }
}
```

### 3. ç›‘æ§å’Œç»´æŠ¤

#### 3.1 é”™è¯¯ç›‘æ§
```javascript
// å…¨å±€é”™è¯¯å¤„ç†
window.addEventListener('error', (event) => {
  console.error('å…¨å±€é”™è¯¯:', event.error);
  // å‘é€é”™è¯¯æŠ¥å‘Šåˆ°ç›‘æ§ç³»ç»Ÿ
  sendErrorReport(event.error);
});

// æœªå¤„ç†çš„Promiseæ‹’ç»
window.addEventListener('unhandledrejection', (event) => {
  console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', event.reason);
  // å‘é€é”™è¯¯æŠ¥å‘Š
  sendErrorReport(event.reason);
});
```

#### 3.2 æ€§èƒ½ç›‘æ§
```javascript
// é¡µé¢åŠ è½½æ€§èƒ½
window.addEventListener('load', () => {
  const perfData = performance.getEntriesByType('navigation')[0];
  console.log('é¡µé¢åŠ è½½æ—¶é—´:', perfData.loadEventEnd - perfData.loadEventStart);
  
  // å‘é€æ€§èƒ½æ•°æ®
  sendPerformanceData(perfData);
});
```

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. æµè§ˆå™¨è°ƒè¯•

#### 1.1 æ§åˆ¶å°è°ƒè¯•
```javascript
// è°ƒè¯•ä¿¡æ¯è¾“å‡º
console.log('è°ƒè¯•ä¿¡æ¯:', data);
console.warn('è­¦å‘Šä¿¡æ¯:', warning);
console.error('é”™è¯¯ä¿¡æ¯:', error);

// åˆ†ç»„è°ƒè¯•
console.group('æ•°æ®åŠ è½½');
console.log('å¼€å§‹åŠ è½½æ•°æ®');
console.log('æ•°æ®åŠ è½½å®Œæˆ');
console.groupEnd();

// è¡¨æ ¼æ˜¾ç¤º
console.table(dataArray);

// æ—¶é—´æµ‹é‡
console.time('æ“ä½œè€—æ—¶');
// æ‰§è¡Œæ“ä½œ
console.timeEnd('æ“ä½œè€—æ—¶');
```

#### 1.2 æ–­ç‚¹è°ƒè¯•
```javascript
// æ¡ä»¶æ–­ç‚¹
if (memberName === 'å¼ ä¸‰') {
  debugger; // åªæœ‰æˆå‘˜åä¸ºå¼ ä¸‰æ—¶æ‰æ–­ç‚¹
}

// æ—¥å¿—æ–­ç‚¹
console.log('æ–­ç‚¹ä½ç½®:', { memberName, groupName });

// å¼‚å¸¸æ–­ç‚¹
try {
  // å¯èƒ½å‡ºé”™çš„ä»£ç 
} catch (error) {
  debugger; // å¼‚å¸¸æ—¶æ–­ç‚¹
  throw error;
}
```

### 2. æ•°æ®è°ƒè¯•

#### 2.1 æ•°æ®çŠ¶æ€æ£€æŸ¥
```javascript
// æ£€æŸ¥å…¨å±€æ•°æ®çŠ¶æ€
function checkGlobalData() {
  console.log('=== å…¨å±€æ•°æ®çŠ¶æ€ ===');
  console.log('groups:', window.groups);
  console.log('attendanceRecords:', window.attendanceRecords);
  console.log('groupNames:', window.groupNames);
  console.log('excludedMembers:', window.excludedMembers);
}

// æ£€æŸ¥localStorage
function checkLocalStorage() {
  console.log('=== localStorageçŠ¶æ€ ===');
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith('msh_')) {
      console.log(key, localStorage.getItem(key));
    }
  }
}
```

#### 2.2 æ•°æ®æµè¿½è¸ª
```javascript
// æ•°æ®æµè¿½è¸ª
function traceDataFlow(operation, data) {
  console.log(`ğŸ” æ•°æ®æµè¿½è¸ª: ${operation}`);
  console.log('è¾“å…¥æ•°æ®:', data);
  
  // æ‰§è¡Œæ“ä½œ
  const result = performOperation(data);
  
  console.log('è¾“å‡ºæ•°æ®:', result);
  return result;
}
```

## ğŸ“š æœ€ä½³å®è·µ

### 1. ä»£ç ç»„ç»‡

#### 1.1 æ¨¡å—åŒ–è®¾è®¡
```javascript
// æ¨¡å—åŒ–ç»„ç»‡
const MemberManager = {
  // æˆå‘˜ç›¸å…³åŠŸèƒ½
  addMember: function(memberData) {},
  updateMember: function(memberId, newData) {},
  deleteMember: function(memberId) {}
};

const AttendanceManager = {
  // ç­¾åˆ°ç›¸å…³åŠŸèƒ½
  signIn: function(memberId) {},
  getAttendance: function(date) {},
  exportAttendance: function(dateRange) {}
};
```

#### 1.2 ä¾èµ–ç®¡ç†
```javascript
// ä¾èµ–æ³¨å…¥
function createDataManager(dependencies) {
  const { firebase, localStorage, utils } = dependencies;
  
  return {
    save: function(data) {
      // ä½¿ç”¨æ³¨å…¥çš„ä¾èµ–
    }
  };
}

// ä½¿ç”¨ä¾èµ–æ³¨å…¥
const dataManager = createDataManager({
  firebase: window.firebase,
  localStorage: window.localStorage,
  utils: window.utils
});
```

### 2. æ€§èƒ½ä¼˜åŒ–

#### 2.1 é˜²æŠ–å’ŒèŠ‚æµ
```javascript
// é˜²æŠ–å‡½æ•°
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// èŠ‚æµå‡½æ•°
function throttle(func, limit) {
  let inThrottle;
  return function() {
    const args = arguments;
    const context = this;
    if (!inThrottle) {
      func.apply(context, args);
      inThrottle = true;
      setTimeout(() => inThrottle = false, limit);
    }
  };
}

// ä½¿ç”¨ç¤ºä¾‹
const debouncedSearch = debounce(searchMembers, 300);
const throttledScroll = throttle(handleScroll, 100);
```

#### 2.2 å†…å­˜ç®¡ç†
```javascript
// å†…å­˜æ³„æ¼é¢„é˜²
function cleanup() {
  // æ¸…é™¤äº‹ä»¶ç›‘å¬å™¨
  document.removeEventListener('click', handleClick);
  
  // æ¸…é™¤å®šæ—¶å™¨
  clearInterval(intervalId);
  clearTimeout(timeoutId);
  
  // æ¸…é™¤å¼•ç”¨
  largeDataArray = null;
  cachedData = null;
}

// é¡µé¢å¸è½½æ—¶æ¸…ç†
window.addEventListener('beforeunload', cleanup);
```

### 3. å®‰å…¨å®è·µ

#### 3.1 è¾“å…¥éªŒè¯
```javascript
// è¾“å…¥éªŒè¯
function validateInput(input, type) {
  switch (type) {
    case 'email':
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input);
    case 'phone':
      return /^1[3-9]\d{9}$/.test(input);
    case 'name':
      return /^[\u4e00-\u9fa5a-zA-Z\s]{2,20}$/.test(input);
    default:
      return false;
  }
}

// ä½¿ç”¨éªŒè¯
function addMember(memberData) {
  if (!validateInput(memberData.name, 'name')) {
    throw new Error('å§“åæ ¼å¼ä¸æ­£ç¡®');
  }
  if (!validateInput(memberData.phone, 'phone')) {
    throw new Error('æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®');
  }
  // ç»§ç»­å¤„ç†
}
```

#### 3.2 æ•°æ®å®‰å…¨
```javascript
// æ•°æ®åŠ å¯†
function encryptData(data, key) {
  // ç®€å•çš„Base64ç¼–ç ï¼ˆå®é™…é¡¹ç›®ä¸­åº”ä½¿ç”¨æ›´å®‰å…¨çš„åŠ å¯†æ–¹æ³•ï¼‰
  return btoa(JSON.stringify(data));
}

// æ•°æ®è§£å¯†
function decryptData(encryptedData, key) {
  try {
    return JSON.parse(atob(encryptedData));
  } catch (error) {
    throw new Error('æ•°æ®è§£å¯†å¤±è´¥');
  }
}
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### 1. å¼€å‘æ”¯æŒ
- **ä»£ç å®¡æŸ¥**ï¼šæäº¤ä»£ç å‰è¿›è¡Œè‡ªæˆ‘å®¡æŸ¥
- **æ–‡æ¡£æ›´æ–°**ï¼šåŠæ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£
- **æµ‹è¯•è¦†ç›–**ï¼šç¡®ä¿æ–°åŠŸèƒ½æœ‰æµ‹è¯•è¦†ç›–

### 2. é—®é¢˜åé¦ˆ
- **BugæŠ¥å‘Š**ï¼šè¯¦ç»†æè¿°é—®é¢˜å’Œå¤ç°æ­¥éª¤
- **åŠŸèƒ½è¯·æ±‚**ï¼šè¯´æ˜éœ€æ±‚å’Œä½¿ç”¨åœºæ™¯
- **æ€§èƒ½é—®é¢˜**ï¼šæä¾›æ€§èƒ½æ•°æ®å’Œç¯å¢ƒä¿¡æ¯

### 3. å­¦ä¹ èµ„æº
- **æŠ€æœ¯æ–‡æ¡£**ï¼šå‚è€ƒç›¸å…³æŠ€æœ¯æ–‡æ¡£
- **æœ€ä½³å®è·µ**ï¼šå­¦ä¹ è¡Œä¸šæœ€ä½³å®è·µ
- **ä»£ç ç¤ºä¾‹**ï¼šå‚è€ƒé¡¹ç›®ä¸­çš„ä»£ç ç¤ºä¾‹

---

*æ­¤å¼€å‘è€…æŒ‡å—å°†æ ¹æ®ç³»ç»Ÿæ›´æ–°æŒç»­ç»´æŠ¤*
