# 小组签到表单系统

## 系统概述

小组签到表单系统是基于阿里云外部表单平台架构建立的独立签到管理功能，专门为9个指定小组提供签到服务。系统集成了密码验证、组别选择、成员多选、24小时防重复签到、缺勤事件生成等完整功能，所有数据存储和处理都基于阿里云平台。

## 功能特性

### 1. 密码验证
- 简单密码验证（1234）
- 防止未授权访问
- 验证成功后显示签到表单

### 2. 组别管理
支持以下9个小组的签到：
- 阿茜组
- 花园小家
- 中梁砥柱
- 时代小家
- 琼娜组
- 晓杰组image.png
- 木山后
- 培茹组
- 以勒小家

### 3. 成员多选
- 根据选择的组别动态加载成员列表
- 支持多选成员进行签到
- 实时显示选中成员数量

### 4. 24小时防重复签到
- 检查同一组别24小时内是否已签到
- 防止重复提交签到数据
- 确保数据准确性

### 5. 缺勤事件生成
- 基于主日跟踪逻辑生成缺勤事件
- 连续缺勤2次及以上自动生成事件
- 事件类型分类：tracking、severe_absence、extended_absence

### 6. 外部记忆系统集成
- 自动记录签到数据到外部记忆系统
- 更新进度记录
- 支持数据查询和统计

## 技术实现

### 文件结构
```
MSH/
├── group-signin-form.html          # 主签到表单页面
├── group-signin-result.html       # 签到结果页面
└── docs/
    └── group-signin-system.md     # 系统说明文档
```

### 数据流程
1. **密码验证** → 显示签到表单
2. **组别选择** → 加载对应成员列表
3. **成员选择** → 实时更新选中状态
4. **提交签到** → 验证24小时防重复
5. **保存数据** → 阿里云外部表单平台 + 外部记忆系统
6. **生成事件** → 缺勤成员事件生成到阿里云平台
7. **显示结果** → 跳转结果页面

### 数据存储
- **阿里云外部表单平台**: 主要签到数据存储和处理
- **localStorage**: 外部记忆系统缓存
- **实时同步**: 数据变化实时更新到阿里云平台

### 技术栈
- **前端**: HTML5 + CSS3 + JavaScript (ES6+)
- **后端**: 阿里云外部表单平台
- **存储**: 阿里云平台 + localStorage
- **集成**: 外部记忆系统
- **安全**: 密码验证 + 24小时防重复

## 使用方法

### 1. 访问签到表单
```
http://localhost:8000/group-signin-form.html
```

### 2. 密码验证
输入密码：`1234`

### 3. 选择组别
从下拉列表中选择对应的小组

### 4. 选择成员
勾选已签到的成员（可多选）

### 5. 提交签到
点击"提交签到"按钮完成签到

### 6. 查看结果
系统自动跳转到结果页面，显示签到统计

## 数据格式

### 签到数据格式
```json
{
  "group": "琼娜组",
  "members": ["琼娜", "钱佳满", "钱佳佳"],
  "signinDate": "2025-10-02",
  "signinTime": "2025-10-02T10:30:00.000Z",
  "submittedBy": "group-signin-form",
  "uuid": "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"
}
```

### 缺勤事件格式
```json
{
  "memberName": "陈贝托",
  "memberUUID": "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",
  "group": "琼娜组",
  "groupDisplayName": "琼娜组",
  "consecutiveAbsences": 3,
  "startDate": "2025-10-02",
  "lastAttendanceDate": "2025-09-25",
  "eventType": "severe_absence",
  "status": "active",
  "source": "group-signin-form",
  "createdAt": "2025-10-02T10:30:00.000Z",
  "recordId": "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"
}
```

## 外部记忆系统集成

### 记忆记录格式
```json
{
  "type": "GROUP_SIGNIN",
  "timestamp": "2025-10-02T10:30:00.000Z",
  "data": {
    "group": "琼娜组",
    "members": ["琼娜", "钱佳满", "钱佳佳"],
    "signinDate": "2025-10-02",
    "signinTime": "2025-10-02T10:30:00.000Z",
    "totalMembers": 12,
    "signedCount": 3,
    "absentCount": 9
  },
  "source": "group-signin-form",
  "uuid": "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"
}
```

### 进度更新
系统会自动更新外部记忆系统的进度记录，包含：
- 签到UUID
- 组别信息
- 签到日期
- 签到人数
- 缺勤人数
- 时间戳

## 安全特性

### 1. 密码保护
- 简单密码验证机制
- 防止未授权访问

### 2. 24小时防重复
- 同一组别24小时内只能签到一次
- 确保数据准确性

### 3. 数据验证
- 前端输入验证
- 后端数据验证
- 错误处理机制

## 扩展功能

### 1. 数据统计
- 签到率统计
- 缺勤趋势分析
- 小组对比分析

### 2. 事件管理
- 缺勤事件查看
- 事件状态更新
- 跟踪记录管理

### 3. 报表生成
- 签到报表
- 缺勤报表
- 统计图表

## 维护说明

### 1. 成员数据更新
在 `group-signin-form.html` 中更新 `GROUP_MEMBERS_DATA` 对象

### 2. 组别管理
在组别选择下拉列表中添加或修改组别选项

### 3. 密码修改
在 `verifyPassword()` 函数中修改密码验证逻辑

### 4. 事件生成规则
在 `generateMemberAbsenceEvent()` 函数中调整事件生成逻辑

## 故障排除

### 1. 密码验证失败
- 检查密码是否正确（1234）
- 清除浏览器缓存
- 刷新页面重试

### 2. 成员列表不显示
- 检查组别是否选择
- 验证 `GROUP_MEMBERS_DATA` 数据
- 查看浏览器控制台错误

### 3. 提交失败
- 检查Firebase连接
- 验证网络连接
- 查看错误日志

### 4. 结果页面无法显示
- 检查URL参数
- 验证数据格式
- 查看Firebase数据

## 版本历史

### v1.0 (2025-10-02)
- 初始版本发布
- 基础签到功能
- 密码验证
- 组别选择
- 成员多选
- 24小时防重复
- 缺勤事件生成
- 外部记忆系统集成

---

**创建日期**: 2025-10-02  
**版本**: 1.0  
**维护者**: MSH系统开发团队
