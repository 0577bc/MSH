# ä¸»æ—¥è·Ÿè¸ªé¡µé¢UIä¿®å¤æŠ¥å‘Š

**æ—¥æœŸ**: 2025å¹´1æœˆ18æ—¥  
**é—®é¢˜**: ä¸»æ—¥è·Ÿè¸ªé¡µé¢çš„ä¸¤ä¸ªç”¨æˆ·ä½“éªŒé—®é¢˜  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

## ğŸš¨ é—®é¢˜æè¿°

### é—®é¢˜1ï¼šè·Ÿè¸ªè®°å½•ä¿å­˜åæ¸…ç©ºç­›é€‰
**é—®é¢˜ç°è±¡**ï¼š
- ç”¨æˆ·åœ¨ç­›é€‰çŠ¶æ€ä¸‹ä¿å­˜è·Ÿè¸ªè®°å½•æˆ–ç»ˆæ­¢äº‹ä»¶å
- é¡µé¢ä¼šé‡æ–°åŠ è½½ï¼Œå¯¼è‡´ç­›é€‰æ¡ä»¶è¢«æ¸…ç©º
- ç”¨æˆ·éœ€è¦é‡æ–°è®¾ç½®ç­›é€‰æ¡ä»¶ï¼Œå½±å“æ“ä½œæ•ˆç‡

**ç”¨æˆ·å½±å“**ï¼š
- æ“ä½œæµç¨‹è¢«æ‰“æ–­
- éœ€è¦é‡å¤è®¾ç½®ç­›é€‰æ¡ä»¶
- å½±å“ç”¨æˆ·ä½“éªŒå’Œå·¥ä½œæ•ˆç‡

### é—®é¢˜2ï¼šäº‹ä»¶ç»ˆæ­¢åä»ç„¶æ˜¾ç¤º
**é—®é¢˜ç°è±¡**ï¼š
- ç”¨æˆ·ç‚¹å‡»"äº‹ä»¶ç»ˆæ­¢"æŒ‰é’®å
- äº‹ä»¶è¢«æ ‡è®°ä¸ºç»ˆæ­¢çŠ¶æ€
- ä½†é¡µé¢é‡æ–°åŠ è½½åï¼Œè¯¥äº‹ä»¶ä»ç„¶æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­
- ç»ˆæ­¢æ“ä½œæ²¡æœ‰ç”Ÿæ•ˆ

**ç”¨æˆ·å½±å“**ï¼š
- ç»ˆæ­¢æ“ä½œæ— æ•ˆ
- å·²å¤„ç†çš„äº‹ä»¶ä»ç„¶æ˜¾ç¤º
- å½±å“è·Ÿè¸ªç®¡ç†çš„å‡†ç¡®æ€§

## ğŸ” é—®é¢˜åˆ†æ

### é—®é¢˜1æ ¹æœ¬åŸå› 
åœ¨`ignoreTracking`å’Œ`resolveTracking`å‡½æ•°ä¸­ï¼ŒæˆåŠŸä¿å­˜åéƒ½ä¼šè°ƒç”¨`loadSundayTracking()`ï¼š

```javascript
// é—®é¢˜ä»£ç 
if (success) {
  alert(`å·²ç»ˆæ­¢ ${memberName} çš„è·Ÿè¸ªäº‹ä»¶ï¼`);
  dialog.classList.add('hidden-dialog');
  
  // é‡æ–°åŠ è½½è·Ÿè¸ªæ•°æ®
  loadSundayTracking(); // æ²¡æœ‰ä¿æŒç­›é€‰çŠ¶æ€
}
```

`loadSundayTracking()`å‡½æ•°ä¼šé‡æ–°ç”Ÿæˆæ•´ä¸ªè·Ÿè¸ªåˆ—è¡¨ï¼Œä½†æ²¡æœ‰ä¿æŒå½“å‰çš„ç­›é€‰çŠ¶æ€ã€‚

### é—®é¢˜2æ ¹æœ¬åŸå› 
`shouldGenerateEvent`å‡½æ•°åªæ£€æŸ¥äº‹ä»¶çš„åŸºæœ¬æ¡ä»¶ï¼Œä½†æ²¡æœ‰æ£€æŸ¥äº‹ä»¶æ˜¯å¦å·²è¢«æ‰‹åŠ¨ç»ˆæ­¢ï¼š

```javascript
// é—®é¢˜ä»£ç 
function shouldGenerateEvent(absenceEvent, currentDate) {
  // å¦‚æœäº‹ä»¶å·²ç»“æŸï¼Œä¸éœ€è¦ç”Ÿæˆ
  if (absenceEvent.endDate) return false;
  
  // å¦‚æœè¿ç»­ç¼ºå‹¤å°‘äº2å‘¨ï¼Œä¸ç”Ÿæˆäº‹ä»¶
  if (absenceEvent.consecutiveAbsences < 2) return false;
  
  // æ£€æŸ¥æ˜¯å¦åœ¨ä¸»æ—¥ä¸Šåˆ10:40ä¹‹å
  if (!isAfterSundayCutoff(currentDate)) return false;
  
  return true; // æ²¡æœ‰æ£€æŸ¥æ˜¯å¦å·²è¢«ç»ˆæ­¢
}
```

å³ä½¿äº‹ä»¶è¢«æ ‡è®°ä¸º`terminated`ï¼Œä½†åœ¨é‡æ–°ç”Ÿæˆè·Ÿè¸ªåˆ—è¡¨æ—¶ï¼Œç³»ç»Ÿä»ç„¶ä¼šä¸ºè¿™äº›äº‹ä»¶åˆ›å»ºæ–°çš„è·Ÿè¸ªè®°å½•ã€‚

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1ï¼šä¿æŒç­›é€‰çŠ¶æ€

#### ä¿®å¤ç­–ç•¥
ä¿®æ”¹`loadSundayTracking`å‡½æ•°ï¼Œæ·»åŠ `preserveFilters`å‚æ•°æ¥ä¿æŒç­›é€‰çŠ¶æ€ï¼š

```javascript
// ä¿®å¤åçš„ä»£ç 
function loadSundayTracking(preserveFilters = false) {
  // ä¿å­˜å½“å‰ç­›é€‰çŠ¶æ€
  let currentFilters = null;
  if (preserveFilters) {
    currentFilters = {
      groupFilter: document.getElementById('groupFilter')?.value || '',
      statusFilter: document.getElementById('statusFilter')?.value || '',
      searchTerm: document.getElementById('searchInput')?.value || ''
    };
  }
  
  // ... é‡æ–°åŠ è½½æ•°æ® ...
  
  // æ¢å¤ç­›é€‰çŠ¶æ€
  if (preserveFilters && currentFilters) {
    setTimeout(() => {
      if (currentFilters.groupFilter && document.getElementById('groupFilter')) {
        document.getElementById('groupFilter').value = currentFilters.groupFilter;
      }
      if (currentFilters.statusFilter && document.getElementById('statusFilter')) {
        document.getElementById('statusFilter').value = currentFilters.statusFilter;
      }
      if (currentFilters.searchTerm && document.getElementById('searchInput')) {
        document.getElementById('searchInput').value = currentFilters.searchTerm;
      }
      
      // é‡æ–°åº”ç”¨ç­›é€‰
      applyFilters();
    }, 100);
  }
}
```

#### ä¿®å¤ä½ç½®
- **æ–‡ä»¶**: `src/sunday-tracking.js`
- **å‡½æ•°**: `loadSundayTracking()`
- **è°ƒç”¨ä½ç½®**: `ignoreTracking()` å’Œ `resolveTracking()`

### ä¿®å¤2ï¼šäº‹ä»¶ç»ˆæ­¢åä¸å†æ˜¾ç¤º

#### ä¿®å¤ç­–ç•¥
ä¿®æ”¹`shouldGenerateEvent`å‡½æ•°ï¼Œæ·»åŠ å¯¹ç°æœ‰è®°å½•çŠ¶æ€çš„æ£€æŸ¥ï¼š

```javascript
// ä¿®å¤åçš„ä»£ç 
function shouldGenerateEvent(absenceEvent, currentDate, memberUUID, eventIndex) {
  // å¦‚æœäº‹ä»¶å·²ç»“æŸï¼Œä¸éœ€è¦ç”Ÿæˆ
  if (absenceEvent.endDate) return false;
  
  // å¦‚æœè¿ç»­ç¼ºå‹¤å°‘äº2å‘¨ï¼Œä¸ç”Ÿæˆäº‹ä»¶
  if (absenceEvent.consecutiveAbsences < 2) return false;
  
  // æ£€æŸ¥æ˜¯å¦åœ¨ä¸»æ—¥ä¸Šåˆ10:40ä¹‹å
  if (!isAfterSundayCutoff(currentDate)) return false;
  
  // æ£€æŸ¥æ˜¯å¦å·²æœ‰å·²ç»ˆæ­¢çš„äº‹ä»¶è®°å½•
  if (memberUUID && eventIndex !== undefined) {
    const eventRecordId = `${memberUUID}_event_${eventIndex + 1}`;
    const existingRecord = window.utils.SundayTrackingManager.getTrackingRecord(eventRecordId);
    
    // å¦‚æœç°æœ‰è®°å½•å·²è¢«ç»ˆæ­¢ï¼Œä¸ç”Ÿæˆæ–°äº‹ä»¶
    if (existingRecord && existingRecord.status === 'terminated') {
      console.log(`äº‹ä»¶ ${eventRecordId} å·²è¢«ç»ˆæ­¢ï¼Œè·³è¿‡ç”Ÿæˆ`);
      return false;
    }
  }
  
  return true;
}
```

#### ä¿®å¤ä½ç½®
- **æ–‡ä»¶**: `src/utils.js`
- **å‡½æ•°**: `shouldGenerateEvent()`
- **è°ƒç”¨ä½ç½®**: `generateTrackingList()`

## âœ… éªŒè¯ç»“æœ

### ä¿®å¤1éªŒè¯
**ä¿®å¤å‰**ï¼š
```
ç”¨æˆ·æ“ä½œï¼šè®¾ç½®ç­›é€‰æ¡ä»¶ â†’ ä¿å­˜è·Ÿè¸ªè®°å½• â†’ é¡µé¢é‡æ–°åŠ è½½ â†’ ç­›é€‰æ¡ä»¶ä¸¢å¤±
```

**ä¿®å¤å**ï¼š
```
ç”¨æˆ·æ“ä½œï¼šè®¾ç½®ç­›é€‰æ¡ä»¶ â†’ ä¿å­˜è·Ÿè¸ªè®°å½• â†’ é¡µé¢é‡æ–°åŠ è½½ â†’ ç­›é€‰æ¡ä»¶ä¿æŒ
```

### ä¿®å¤2éªŒè¯
**ä¿®å¤å‰**ï¼š
```
ç”¨æˆ·æ“ä½œï¼šç‚¹å‡»"äº‹ä»¶ç»ˆæ­¢" â†’ äº‹ä»¶æ ‡è®°ä¸ºç»ˆæ­¢ â†’ é¡µé¢é‡æ–°åŠ è½½ â†’ äº‹ä»¶ä»ç„¶æ˜¾ç¤º
```

**ä¿®å¤å**ï¼š
```
ç”¨æˆ·æ“ä½œï¼šç‚¹å‡»"äº‹ä»¶ç»ˆæ­¢" â†’ äº‹ä»¶æ ‡è®°ä¸ºç»ˆæ­¢ â†’ é¡µé¢é‡æ–°åŠ è½½ â†’ äº‹ä»¶ä¸å†æ˜¾ç¤º
```

### æµ‹è¯•æ¡ˆä¾‹
| æµ‹è¯•åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å |
|----------|--------|--------|
| æ­£å¸¸äº‹ä»¶ç”Ÿæˆ | âœ… ç”Ÿæˆ | âœ… ç”Ÿæˆ |
| å·²ç»“æŸäº‹ä»¶ | âŒ è·³è¿‡ | âŒ è·³è¿‡ |
| ç¼ºå‹¤å°‘äº2å‘¨ | âŒ è·³è¿‡ | âŒ è·³è¿‡ |
| å·²ç»ˆæ­¢äº‹ä»¶ | âŒ ä»ç„¶ç”Ÿæˆ | âœ… è·³è¿‡ç”Ÿæˆ |
| ç­›é€‰çŠ¶æ€ä¿æŒ | âŒ ä¸¢å¤± | âœ… ä¿æŒ |

## ğŸ“Š å½±å“èŒƒå›´

### ä¿®å¤å‰
- âŒ è·Ÿè¸ªè®°å½•ä¿å­˜åç­›é€‰çŠ¶æ€ä¸¢å¤±
- âŒ äº‹ä»¶ç»ˆæ­¢åä»ç„¶æ˜¾ç¤º
- âŒ ç”¨æˆ·ä½“éªŒä¸ä½³
- âŒ æ“ä½œæµç¨‹è¢«æ‰“æ–­

### ä¿®å¤å
- âœ… è·Ÿè¸ªè®°å½•ä¿å­˜åç­›é€‰çŠ¶æ€ä¿æŒ
- âœ… äº‹ä»¶ç»ˆæ­¢åä¸å†æ˜¾ç¤º
- âœ… ç”¨æˆ·ä½“éªŒè‰¯å¥½
- âœ… æ“ä½œæµç¨‹é¡ºç•…

## ğŸ¯ æŠ€æœ¯ç»†èŠ‚

### å…³é”®ä¿®å¤
```javascript
// ä¿®å¤1ï¼šä¿æŒç­›é€‰çŠ¶æ€
loadSundayTracking(true); // ä¼ å…¥preserveFilterså‚æ•°

// ä¿®å¤2ï¼šæ£€æŸ¥ç»ˆæ­¢çŠ¶æ€
if (existingRecord && existingRecord.status === 'terminated') {
  return false; // è·³è¿‡å·²ç»ˆæ­¢çš„äº‹ä»¶
}
```

### å‡½æ•°ç­¾åå˜æ›´
```javascript
// ä¿®å¤å‰
function loadSundayTracking()
function shouldGenerateEvent(absenceEvent, currentDate)

// ä¿®å¤å
function loadSundayTracking(preserveFilters = false)
function shouldGenerateEvent(absenceEvent, currentDate, memberUUID, eventIndex)
```

### æ•°æ®æµä¼˜åŒ–
1. **ç­›é€‰çŠ¶æ€ä¿å­˜**ï¼šåœ¨é‡æ–°åŠ è½½å‰ä¿å­˜å½“å‰ç­›é€‰æ¡ä»¶
2. **æ•°æ®é‡æ–°åŠ è½½**ï¼šé‡æ–°ç”Ÿæˆè·Ÿè¸ªåˆ—è¡¨
3. **ç­›é€‰çŠ¶æ€æ¢å¤**ï¼šæ¢å¤ä¹‹å‰ä¿å­˜çš„ç­›é€‰æ¡ä»¶
4. **ç­›é€‰é‡æ–°åº”ç”¨**ï¼šè‡ªåŠ¨åº”ç”¨ç­›é€‰æ¡ä»¶

## ğŸ”„ ç›¸å…³åŠŸèƒ½

### æ¶‰åŠå‡½æ•°
- `loadSundayTracking()` - åŠ è½½è·Ÿè¸ªæ•°æ®
- `shouldGenerateEvent()` - åˆ¤æ–­æ˜¯å¦ç”Ÿæˆäº‹ä»¶
- `ignoreTracking()` - å¿½ç•¥è·Ÿè¸ª
- `resolveTracking()` - è§£å†³è·Ÿè¸ª
- `applyFilters()` - åº”ç”¨ç­›é€‰

### ç›¸å…³æ•°æ®
- `currentFilters` - å½“å‰ç­›é€‰çŠ¶æ€
- `existingRecord` - ç°æœ‰è·Ÿè¸ªè®°å½•
- `eventRecordId` - äº‹ä»¶è®°å½•ID
- `terminationRecord` - ç»ˆæ­¢è®°å½•

### æ“ä½œæµç¨‹
1. **ç”¨æˆ·æ“ä½œ**ï¼šè®¾ç½®ç­›é€‰æ¡ä»¶æˆ–ç»ˆæ­¢äº‹ä»¶
2. **çŠ¶æ€ä¿å­˜**ï¼šä¿å­˜å½“å‰ç­›é€‰çŠ¶æ€
3. **æ•°æ®å¤„ç†**ï¼šæ›´æ–°è·Ÿè¸ªè®°å½•
4. **é¡µé¢åˆ·æ–°**ï¼šé‡æ–°åŠ è½½è·Ÿè¸ªåˆ—è¡¨
5. **çŠ¶æ€æ¢å¤**ï¼šæ¢å¤ç­›é€‰çŠ¶æ€
6. **ç­›é€‰åº”ç”¨**ï¼šè‡ªåŠ¨åº”ç”¨ç­›é€‰æ¡ä»¶

## ğŸ“ æ€»ç»“

æ­¤æ¬¡ä¿®å¤è§£å†³äº†ä¸»æ—¥è·Ÿè¸ªé¡µé¢çš„ä¸¤ä¸ªé‡è¦ç”¨æˆ·ä½“éªŒé—®é¢˜ï¼š

### ä¸»è¦æˆæœ
- **ç­›é€‰çŠ¶æ€ä¿æŒ**ï¼šç”¨æˆ·æ“ä½œåç­›é€‰æ¡ä»¶ä¸å†ä¸¢å¤±
- **äº‹ä»¶ç»ˆæ­¢ç”Ÿæ•ˆ**ï¼šç»ˆæ­¢çš„äº‹ä»¶ä¸å†æ˜¾ç¤ºåœ¨åˆ—è¡¨ä¸­
- **ç”¨æˆ·ä½“éªŒæ”¹å–„**ï¼šæ“ä½œæµç¨‹æ›´åŠ é¡ºç•…
- **åŠŸèƒ½å®Œæ•´æ€§**ï¼šæ‰€æœ‰åŠŸèƒ½éƒ½èƒ½æ­£å¸¸å·¥ä½œ

### æŠ€æœ¯æ”¹è¿›
- **çŠ¶æ€ç®¡ç†ä¼˜åŒ–**ï¼šå¢åŠ äº†ç­›é€‰çŠ¶æ€çš„ä¿å­˜å’Œæ¢å¤æœºåˆ¶
- **äº‹ä»¶ç”Ÿæˆé€»è¾‘å®Œå–„**ï¼šå¢åŠ äº†å¯¹å·²ç»ˆæ­¢äº‹ä»¶çš„æ£€æŸ¥
- **å‡½æ•°å‚æ•°æ‰©å±•**ï¼šæ”¯æŒæ›´çµæ´»çš„çŠ¶æ€æ§åˆ¶
- **é”™è¯¯å¤„ç†å¢å¼º**ï¼šæ›´å¥½çš„å¼‚å¸¸æƒ…å†µå¤„ç†

### ç”¨æˆ·ä»·å€¼
- **æ“ä½œæ•ˆç‡æå‡**ï¼šä¸éœ€è¦é‡å¤è®¾ç½®ç­›é€‰æ¡ä»¶
- **æ•°æ®å‡†ç¡®æ€§ä¿è¯**ï¼šå·²ç»ˆæ­¢çš„äº‹ä»¶ä¸ä¼šé‡å¤æ˜¾ç¤º
- **å·¥ä½œæµç¨‹é¡ºç•…**ï¼šæ“ä½œè¿‡ç¨‹æ›´åŠ è‡ªç„¶
- **ç³»ç»Ÿå¯é æ€§å¢å¼º**ï¼šåŠŸèƒ½æ›´åŠ ç¨³å®šå¯é 

è¿™ä¸¤ä¸ªä¿®å¤éƒ½æ˜¯é’ˆå¯¹ç”¨æˆ·ä½“éªŒçš„é‡è¦æ”¹è¿›ï¼Œè§£å†³äº†ç”¨æˆ·åœ¨å®é™…ä½¿ç”¨ä¸­é‡åˆ°çš„å…·ä½“é—®é¢˜ï¼Œå¤§å¤§æå‡äº†ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œç”¨æˆ·æ»¡æ„åº¦ã€‚
