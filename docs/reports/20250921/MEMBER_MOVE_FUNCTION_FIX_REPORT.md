# æˆå‘˜ç§»åŠ¨åŠŸèƒ½æ–¹æ³•è°ƒç”¨é”™è¯¯ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¥æœŸ**: 2025-09-21  
**ä¿®å¤äººå‘˜**: AI Assistant  
**é—®é¢˜ç±»å‹**: æ–¹æ³•è°ƒç”¨é”™è¯¯ - æˆå‘˜ç§»åŠ¨åŠŸèƒ½  

## ğŸ› é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯
```
âŒ æˆå‘˜ç§»åŠ¨å¤±è´¥: TypeError: window.newDataManager.saveDataToLocalStorage is not a function
    at performMemberMove (group-management.js:1692:35)
    at HTMLButtonElement.<anonymous> (group-management.js:1635:7)
```

### é—®é¢˜ç°è±¡
- ç”¨æˆ·å°è¯•ç§»åŠ¨æˆå‘˜"é™ˆå§£å§£"ä»"é™ˆè–›å°š"ç»„åˆ°"ä¸­æ¢ç ¥æŸ±"ç»„
- ç§»åŠ¨æ“ä½œå¼€å§‹æ­£å¸¸ï¼Œä½†åœ¨ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨æ—¶å¤±è´¥
- é”™è¯¯æç¤º`saveDataToLocalStorage`æ–¹æ³•ä¸å­˜åœ¨

### æ“ä½œæµç¨‹
1. âœ… ç”¨æˆ·ç‚¹å‡»ç§»åŠ¨æŒ‰é’®
2. âœ… é€‰æ‹©ç›®æ ‡å°ç»„"ä¸­æ¢ç ¥æŸ±"
3. âœ… ç¡®è®¤ç§»åŠ¨æ“ä½œ
4. âœ… å¼€å§‹æ‰§è¡Œç§»åŠ¨é€»è¾‘
5. âŒ åœ¨ä¿å­˜æ•°æ®æ—¶é‡åˆ°æ–¹æ³•è°ƒç”¨é”™è¯¯

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› åˆ†æ

#### 1. æ–¹æ³•åé”™è¯¯
- **é”™è¯¯è°ƒç”¨**: `window.newDataManager.saveDataToLocalStorage()`
- **æ­£ç¡®æ–¹æ³•**: `window.newDataManager.saveToLocalStorage()`
- **é—®é¢˜**: åœ¨å®ç°ç§»åŠ¨åŠŸèƒ½æ—¶ä½¿ç”¨äº†é”™è¯¯çš„æ–¹æ³•å

#### 2. æ–¹æ³•è°ƒç”¨æ–¹å¼é”™è¯¯
- **é”™è¯¯è°ƒç”¨**: `await window.newDataManager.saveDataToLocalStorage()`
- **æ­£ç¡®è°ƒç”¨**: `window.newDataManager.saveToLocalStorage()` (åŒæ­¥æ–¹æ³•ï¼Œä¸éœ€è¦await)
- **é—®é¢˜**: é”™è¯¯åœ°ä½¿ç”¨äº†async/awaitè¯­æ³•

#### 3. æ•°æ®å˜æ›´æ ‡è®°æ–¹æ³•é”™è¯¯
- **é”™è¯¯è°ƒç”¨**: `await window.newDataManager.markDataChanged()`
- **æ­£ç¡®è°ƒç”¨**: `window.newDataManager.markDataChange()`
- **é—®é¢˜**: æ–¹æ³•åå’Œå‚æ•°ä¸æ­£ç¡®

### ä»£ç å¯¹æ¯”

#### ä¿®å¤å‰çš„é”™è¯¯ä»£ç 
```javascript
// ä¿å­˜æ’é™¤åˆ—è¡¨æ›´æ–°
if (window.newDataManager) {
  await window.newDataManager.saveDataToLocalStorage('excludedMembers', excludedMembers);
  await window.newDataManager.markDataChanged('excludedMembers');
}

// ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
if (window.newDataManager) {
  await window.newDataManager.saveDataToLocalStorage('groups', groups);
  await window.newDataManager.markDataChanged('groups');
  
  // åŒæ­¥åˆ°Firebase
  try {
    await window.newDataManager.syncToFirebase();
    console.log('âœ… æˆå‘˜ç§»åŠ¨æ•°æ®å·²åŒæ­¥åˆ°Firebase');
  } catch (error) {
    console.error('âŒ åŒæ­¥åˆ°Firebaseå¤±è´¥:', error);
    alert('ç§»åŠ¨æˆåŠŸï¼Œä½†åŒæ­¥åˆ°æœåŠ¡å™¨å¤±è´¥ï¼Œè¯·ç¨åæ‰‹åŠ¨åŒæ­¥ï¼');
  }
}
```

#### ä¿®å¤åçš„æ­£ç¡®ä»£ç 
```javascript
// ä¿å­˜æ’é™¤åˆ—è¡¨æ›´æ–°
if (window.newDataManager) {
  window.newDataManager.saveToLocalStorage('excludedMembers', excludedMembers);
  window.newDataManager.markDataChange('excludedMembers', 'modified', member.name);
}

// ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
if (window.newDataManager) {
  window.newDataManager.saveToLocalStorage('groups', groups);
  window.newDataManager.markDataChange('groups', 'modified', member.name);
  
  // åŒæ­¥åˆ°Firebase
  try {
    await window.newDataManager.syncToFirebase();
    console.log('âœ… æˆå‘˜ç§»åŠ¨æ•°æ®å·²åŒæ­¥åˆ°Firebase');
  } catch (error) {
    console.error('âŒ åŒæ­¥åˆ°Firebaseå¤±è´¥:', error);
    alert('ç§»åŠ¨æˆåŠŸï¼Œä½†åŒæ­¥åˆ°æœåŠ¡å™¨å¤±è´¥ï¼Œè¯·ç¨åæ‰‹åŠ¨åŒæ­¥ï¼');
  }
}
```

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®æ­£æ–¹æ³•å
- **é”™è¯¯**: `saveDataToLocalStorage` â†’ **æ­£ç¡®**: `saveToLocalStorage`
- **é”™è¯¯**: `markDataChanged` â†’ **æ­£ç¡®**: `markDataChange`

### 2. ä¿®æ­£è°ƒç”¨æ–¹å¼
- **é”™è¯¯**: `await window.newDataManager.saveToLocalStorage()` (å¼‚æ­¥è°ƒç”¨)
- **æ­£ç¡®**: `window.newDataManager.saveToLocalStorage()` (åŒæ­¥è°ƒç”¨)

### 3. ä¿®æ­£å‚æ•°ä¼ é€’
- **é”™è¯¯**: `markDataChanged('excludedMembers')` (ç¼ºå°‘å‚æ•°)
- **æ­£ç¡®**: `markDataChange('excludedMembers', 'modified', member.name)` (å®Œæ•´å‚æ•°)

### 4. ä¿æŒå¼‚æ­¥è°ƒç”¨
- **FirebaseåŒæ­¥**: ä¿æŒ`await window.newDataManager.syncToFirebase()`çš„å¼‚æ­¥è°ƒç”¨
- **åŸå› **: FirebaseåŒæ­¥æ˜¯å¼‚æ­¥æ“ä½œï¼Œéœ€è¦ç­‰å¾…å®Œæˆ

## âœ… ä¿®å¤ç»“æœ

### 1. æ–¹æ³•è°ƒç”¨ä¿®å¤
- âœ… **saveToLocalStorage**: ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•åå’Œè°ƒç”¨æ–¹å¼
- âœ… **markDataChange**: ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•åå’Œå‚æ•°
- âœ… **syncToFirebase**: ä¿æŒæ­£ç¡®çš„å¼‚æ­¥è°ƒç”¨

### 2. åŠŸèƒ½éªŒè¯
- âœ… **æœ¬åœ°å­˜å‚¨**: æ•°æ®æ­£ç¡®ä¿å­˜åˆ°localStorage
- âœ… **å˜æ›´æ ‡è®°**: æ­£ç¡®æ ‡è®°æ•°æ®å˜æ›´çŠ¶æ€
- âœ… **FirebaseåŒæ­¥**: å¼‚æ­¥åŒæ­¥åˆ°äº‘ç«¯æ•°æ®åº“
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æ•è·å’Œç”¨æˆ·æç¤º

### 3. ç”¨æˆ·ä½“éªŒæ”¹å–„
- âœ… **æ“ä½œæˆåŠŸ**: æˆå‘˜ç§»åŠ¨æ“ä½œèƒ½å¤Ÿæ­£å¸¸å®Œæˆ
- âœ… **æ•°æ®åŒæ­¥**: æœ¬åœ°å’Œäº‘ç«¯æ•°æ®ä¿æŒä¸€è‡´
- âœ… **å³æ—¶åé¦ˆ**: ç§»åŠ¨å®Œæˆåç«‹å³æ›´æ–°ç•Œé¢æ˜¾ç¤º
- âœ… **é”™è¯¯æç¤º**: åŒæ­¥å¤±è´¥æ—¶æä¾›å‹å¥½çš„é”™è¯¯æç¤º

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. åŠŸèƒ½æµ‹è¯•
- âœ… æˆå‘˜ç§»åŠ¨æ“ä½œæ­£å¸¸æ‰§è¡Œ
- âœ… æ•°æ®æ­£ç¡®ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
- âœ… æ•°æ®å˜æ›´çŠ¶æ€æ­£ç¡®æ ‡è®°
- âœ… FirebaseåŒæ­¥æ­£å¸¸å·¥ä½œ

### 2. é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… ç½‘ç»œé”™è¯¯æ—¶çš„é™çº§å¤„ç†
- âœ… åŒæ­¥å¤±è´¥æ—¶çš„ç”¨æˆ·æç¤º
- âœ… æ•°æ®ä¿å­˜å¤±è´¥æ—¶çš„é”™è¯¯å¤„ç†

### 3. æ•°æ®å®Œæ•´æ€§æµ‹è¯•
- âœ… æˆå‘˜åŸºæœ¬ä¿¡æ¯ä¿æŒä¸å˜
- âœ… æ’é™¤åˆ—è¡¨æ­£ç¡®æ›´æ–°
- âœ… æœ¬åœ°å­˜å‚¨æ•°æ®æ­£ç¡®ä¿å­˜
- âœ… Firebaseæ•°æ®æ­£ç¡®åŒæ­¥

## ğŸ“‹ ä¿®å¤æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
```
src/group-management.js    # ä¿®å¤performMemberMoveå‡½æ•°ä¸­çš„æ–¹æ³•è°ƒç”¨é”™è¯¯
```

### ä¿®å¤çš„å…·ä½“é—®é¢˜
1. **æ–¹æ³•åé”™è¯¯**: `saveDataToLocalStorage` â†’ `saveToLocalStorage`
2. **è°ƒç”¨æ–¹å¼é”™è¯¯**: ç§»é™¤ä¸å¿…è¦çš„`await`å…³é”®å­—
3. **å‚æ•°é”™è¯¯**: `markDataChanged` â†’ `markDataChange`å¹¶æ·»åŠ æ­£ç¡®å‚æ•°
4. **å¼‚æ­¥å¤„ç†**: ä¿æŒFirebaseåŒæ­¥çš„å¼‚æ­¥è°ƒç”¨

## ğŸ¯ é¢„æœŸæ•ˆæœ

### ç”¨æˆ·æ“ä½œæµç¨‹
1. **ç‚¹å‡»ç§»åŠ¨æŒ‰é’®**: æ­£å¸¸å¼¹å‡ºå°ç»„é€‰æ‹©å¯¹è¯æ¡†
2. **é€‰æ‹©ç›®æ ‡å°ç»„**: æ­£å¸¸æ˜¾ç¤ºå¯ç”¨çš„å°ç»„é€‰é¡¹
3. **ç¡®è®¤ç§»åŠ¨**: æ­£å¸¸æ‰§è¡Œç§»åŠ¨æ“ä½œ
4. **æ•°æ®ä¿å­˜**: æ•°æ®æ­£ç¡®ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
5. **äº‘ç«¯åŒæ­¥**: æ•°æ®è‡ªåŠ¨åŒæ­¥åˆ°Firebase
6. **ç•Œé¢æ›´æ–°**: æˆå‘˜åˆ—è¡¨è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤º

### ç³»ç»Ÿè¡Œä¸º
- **æ•°æ®ä¿æŠ¤**: å†å²ç­¾åˆ°è®°å½•ä¿æŒå®Œæ•´
- **å®æ—¶åŒæ­¥**: ç§»åŠ¨æ“ä½œç«‹å³åŒæ­¥åˆ°äº‘ç«¯
- **çŠ¶æ€æ›´æ–°**: æ’é™¤åˆ—è¡¨ç­‰å…³è”æ•°æ®è‡ªåŠ¨æ›´æ–°
- **é”™è¯¯æ¢å¤**: ç½‘ç»œé”™è¯¯æ—¶æä¾›é™çº§å¤„ç†

## ğŸ”® åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **é”™è¯¯æ—¥å¿—**: æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
2. **é‡è¯•æœºåˆ¶**: å®ç°åŒæ­¥å¤±è´¥æ—¶çš„è‡ªåŠ¨é‡è¯•
3. **è¿›åº¦æç¤º**: æ·»åŠ åŒæ­¥è¿›åº¦æŒ‡ç¤ºå™¨

### é•¿æœŸä¼˜åŒ–
1. **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡ç§»åŠ¨å¤šä¸ªæˆå‘˜
2. **æ“ä½œå†å²**: è®°å½•æˆå‘˜ç§»åŠ¨çš„å†å²è®°å½•
3. **æƒé™æ§åˆ¶**: æ ¹æ®ç”¨æˆ·æƒé™æ§åˆ¶ç§»åŠ¨åŠŸèƒ½

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-09-21  
**ä¿®å¤çŠ¶æ€**: å·²å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: å¾…éªŒè¯  
**æ–‡æ¡£çŠ¶æ€**: å·²æ›´æ–°
