# MSH 签到系统 - AI 上下文规则

## 通用开发规则

### 代码生成原则
1. **完整性优先**: 生成的代码必须完整可运行，禁止使用 TODO、FIXME 或占位符
2. **现有代码参考**: 优先参考现有代码模式，如 `@src/main.js` 或 `@src/utils.js`
3. **中文注释**: 所有代码注释使用中文，详细说明功能和作用
4. **错误处理**: 所有异步操作必须包含 try-catch 错误处理
5. **性能考虑**: 考虑缓存策略和网络优化，避免重复请求

### 文件操作规范
1. **文件路径**: 使用绝对路径 `/Users/benchen/MSH/` 作为根目录
2. **文件组织**: 新功能优先在现有文件中扩展，避免创建过多新文件
3. **备份意识**: 修改重要文件前，先检查是否有备份
4. **文档同步**: 代码变更后，同步更新相关文档

### Firebase 操作规则
1. **版本一致性**: 使用 Firebase SDK v8，保持与现有代码一致
2. **数据结构**: 遵循现有的数据结构模式，参考 `config.js` 中的示例数据
3. **错误处理**: Firebase 操作必须包含错误处理和用户友好提示
4. **缓存策略**: 利用现有的缓存管理器，避免重复请求

## 项目特定规则

### MSH 系统特性
1. **多小组支持**: 系统支持9个小组，新增功能需考虑多小组兼容性
2. **签到分类**: 签到分为早到、准时、迟到三类，保持分类逻辑一致
3. **UUID 系统**: 所有数据实体使用 UUID 作为唯一标识符
4. **实时同步**: 所有数据变更需实时同步到 Firebase
5. **PWA 特性**: 保持 PWA 功能完整性，包括 Service Worker 和 Manifest

### 用户界面规范
1. **响应式设计**: 确保所有界面在移动端和桌面端都能正常使用
2. **无障碍支持**: 使用 ARIA 标签和语义化 HTML
3. **中文界面**: 所有用户界面文本使用简体中文
4. **表单验证**: 所有表单必须包含前端验证和用户友好提示
5. **加载状态**: 异步操作期间显示加载状态

### 数据管理规则
1. **数据验证**: 前端验证 + Firebase 规则双重验证
2. **数据备份**: 重要数据变更前自动备份
3. **数据清理**: 定期清理过期数据，保持数据库性能
4. **隐私保护**: 敏感信息（如电话号码）需要适当保护

## AI 行为指导

### 问题解决流程
1. **理解问题**: 先分析问题原因，再提出解决方案
2. **参考现有代码**: 查看相关现有代码，了解实现模式
3. **小步迭代**: 每次修改控制在100行以内，便于测试和回滚
4. **测试验证**: 修改后提供测试建议或验证方法
5. **文档更新**: 重要变更后更新相关文档

### 错误处理原则
1. **调试优先**: 遇到错误时，先解释可能原因，再提供修复方案
2. **用户友好**: 错误信息对用户友好，避免技术术语
3. **日志记录**: 重要操作和错误需要适当的日志记录
4. **回滚机制**: 提供回滚方案，确保系统稳定性

### 安全考虑
1. **输入验证**: 所有用户输入必须验证和清理
2. **权限控制**: 管理功能需要适当的权限验证
3. **数据保护**: 敏感数据需要适当保护
4. **CSRF 防护**: 利用现有的 CSRF 保护机制

## 代码质量要求

### 性能优化
1. **缓存利用**: 充分利用现有的缓存管理器
2. **网络优化**: 减少不必要的网络请求
3. **代码复用**: 避免重复代码，使用现有工具函数
4. **懒加载**: 非关键资源使用懒加载

### 可维护性
1. **模块化**: 保持代码模块化，单一职责原则
2. **注释完整**: 复杂逻辑必须有详细注释
3. **命名规范**: 遵循 DESIGN-SYSTEM.json 中的命名规范
4. **版本控制**: 重要变更需要适当的版本标记

### 测试要求
1. **功能测试**: 新功能需要基本的功能测试
2. **兼容性测试**: 确保在不同浏览器中正常工作
3. **性能测试**: 重要功能需要性能验证
4. **用户体验测试**: 确保用户界面友好易用

## 特殊情况处理

### 紧急修复
1. **快速响应**: 系统崩溃或严重错误需要快速修复
2. **最小影响**: 修复时尽量减少对其他功能的影响
3. **用户通知**: 重要修复需要适当的用户通知
4. **后续优化**: 紧急修复后，计划后续优化

### 功能扩展
1. **向后兼容**: 新功能不能破坏现有功能
2. **渐进增强**: 新功能应该渐进式增强用户体验
3. **配置灵活**: 新功能应该可以通过配置启用/禁用
4. **文档完整**: 新功能需要完整的使用文档

### 数据迁移
1. **备份优先**: 数据迁移前必须完整备份
2. **测试环境**: 在测试环境验证迁移脚本
3. **回滚计划**: 准备数据回滚方案
4. **用户通知**: 重要数据变更需要提前通知用户

## 团队协作规范

### 代码审查
1. **功能验证**: 确保新功能按预期工作
2. **代码质量**: 检查代码质量和规范遵循
3. **性能影响**: 评估对系统性能的影响
4. **文档更新**: 确保相关文档已更新

### 版本管理
1. **语义版本**: 使用语义版本号管理发布
2. **变更日志**: 重要变更需要更新变更日志
3. **发布说明**: 每个版本需要发布说明
4. **回滚准备**: 准备版本回滚方案

---

**最后更新**: 2025-09-27  
**适用版本**: MSH 2.0+  
**维护者**: AI 开发助手

