<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸…ç©ºç¼ºå‹¤æ•°æ®</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
    }
    h1 {
      color: #d32f2f;
    }
    .warning {
      background: #fff3cd;
      border: 2px solid #ffc107;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .controls {
      margin: 20px 0;
      padding: 20px;
      background: #f5f5f5;
      border-radius: 8px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
    }
    .danger-btn {
      background: #d32f2f;
      color: white;
    }
    .danger-btn:hover {
      background: #b71c1c;
    }
    .safe-btn {
      background: #6c757d;
      color: white;
    }
    .safe-btn:hover {
      background: #5a6268;
    }
    .log {
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 4px;
      max-height: 300px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>âš ï¸ æ¸…ç©ºç¼ºå‹¤æ•°æ®</h1>
  
  <div class="warning">
    <h3>âš ï¸ è­¦å‘Š</h3>
    <p><strong>æ­¤æ“ä½œå°†åˆ é™¤ä»¥ä¸‹æ•°æ®ï¼š</strong></p>
    <ul>
      <li><code>absenceCalc</code> - æ‰€æœ‰ç¼ºå‹¤è®¡ç®—ç»“æœ</li>
      <li><code>absenceEvents</code> - æ‰€æœ‰ç¼ºå‹¤äº‹ä»¶</li>
    </ul>
    <p><strong style="color: red;">åˆ é™¤åæ— æ³•æ¢å¤ï¼</strong></p>
    <p>æ¸…ç©ºåï¼Œéœ€è¦é‡æ–°è¿è¡Œ"ç¼ºå‹¤è®¡ç®—å·¥å…·"æ¥ç”Ÿæˆæ­£ç¡®çš„æ•°æ®ã€‚</p>
  </div>
  
  <div class="controls">
    <button class="danger-btn" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
    <button class="safe-btn" onclick="window.location.href='index.html'">è¿”å›</button>
  </div>
  
  <div class="log" id="log"></div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  
  <script src="../../src/smart-config-loader.js"></script>
  <script>
    let db;
    
    // åˆå§‹åŒ–Firebase
    async function initFirebase() {
      let attempts = 0;
      while (!window.firebaseConfig && attempts < 50) {
        await new Promise(resolve => setTimeout(resolve, 100));
        attempts++;
      }
      
      if (!window.firebaseConfig) {
        throw new Error('Firebaseé…ç½®åŠ è½½è¶…æ—¶');
      }
      
      if (!firebase.apps.length) {
        firebase.initializeApp(window.firebaseConfig);
      }
      db = firebase.database();
      log('Firebaseåˆå§‹åŒ–æˆåŠŸ');
    }
    
    // æ—¥å¿—å‡½æ•°
    function log(message) {
      const logDiv = document.getElementById('log');
      const item = document.createElement('div');
      item.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(item);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(message);
    }
    
    // æ¸…ç©ºæ•°æ®
    async function clearData() {
      // äºŒæ¬¡ç¡®è®¤
      const confirm1 = confirm('âš ï¸ è­¦å‘Šï¼šæ­¤æ“ä½œå°†åˆ é™¤æ‰€æœ‰ç¼ºå‹¤è®¡ç®—ç»“æœå’Œäº‹ä»¶ï¼\n\næ˜¯å¦ç»§ç»­ï¼Ÿ');
      if (!confirm1) return;
      
      const confirm2 = confirm('âš ï¸ æœ€åç¡®è®¤ï¼šæ•°æ®åˆ é™¤åæ— æ³•æ¢å¤ï¼\n\nç¡®å®šè¦æ¸…ç©ºæ•°æ®å—ï¼Ÿ');
      if (!confirm2) return;
      
      try {
        log('å¼€å§‹æ¸…ç©ºæ•°æ®...');
        await initFirebase();
        
        // æ¸…ç©º absenceCalc
        log('æ¸…ç©º absenceCalc...');
        await db.ref('absenceCalc').remove();
        log('âœ… absenceCalc å·²æ¸…ç©º');
        
        // æ¸…ç©º absenceEvents
        log('æ¸…ç©º absenceEvents...');
        await db.ref('absenceEvents').remove();
        log('âœ… absenceEvents å·²æ¸…ç©º');

        // æ¸…ç©º trackingRecordsï¼ˆæ—§äº‹ä»¶è®°å½•ï¼‰
        log('æ¸…ç©º trackingRecords...');
        await db.ref('trackingRecords').remove();
        log('âœ… trackingRecords å·²æ¸…ç©º');

        // æ¸…é™¤æœ¬åœ°ç¼“å­˜
        log('æ¸…é™¤æµè§ˆå™¨ localStorage ä¸­çš„äº‹ä»¶ç¼“å­˜...');
        localStorage.removeItem('msh_sunday_tracking');
        log('âœ… localStorage å·²æ¸…é™¤');
        
        log('==============================');
        log('âœ… æ•°æ®æ¸…ç©ºå®Œæˆï¼');
        log('è¯·è®¿é—®"ç¼ºå‹¤è®¡ç®—å·¥å…·"é‡æ–°è®¡ç®—æ•°æ®');
        
        alert('æ•°æ®æ¸…ç©ºå®Œæˆï¼\n\nè¯·è®¿é—®"ç¼ºå‹¤è®¡ç®—å·¥å…·"é‡æ–°è®¡ç®—æ•°æ®ã€‚');
        
      } catch (error) {
        log(`âŒ é”™è¯¯: ${error.message}`);
        alert('æ¸…ç©ºæ•°æ®å¤±è´¥: ' + error.message);
        console.error(error);
      }
    }
    
    window.addEventListener('load', () => {
      log('é¡µé¢åŠ è½½å®Œæˆ');
      log('ç‚¹å‡»"æ¸…ç©ºæ•°æ®"æŒ‰é’®å¼€å§‹æ“ä½œ');
    });
  </script>
</body>
</html>

