<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½æµ‹è¯•å·¥å…· - MSHç­¾åˆ°ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../../src/style.css">
    <style>
        .testing-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .testing-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .testing-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .testing-header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .test-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .test-section h2 {
            color: #2d3748;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .test-category {
            margin-bottom: 30px;
        }

        .test-category h3 {
            color: #4a5568;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .test-item {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .test-item:hover {
            background: #e2e8f0;
            border-color: #4299e1;
        }

        .test-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .test-item-title {
            font-weight: bold;
            color: #2d3748;
        }

        .test-item-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .test-item-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .test-item-status.running {
            background: #d1ecf1;
            color: #0c5460;
        }

        .test-item-status.passed {
            background: #d4edda;
            color: #155724;
        }

        .test-item-status.failed {
            background: #f8d7da;
            color: #721c24;
        }

        .test-item-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .test-results {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 14px;
            display: none;
        }

        .test-results.show {
            display: block;
        }

        .test-log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-info { color: #4299e1; }
        .log-success { color: #48bb78; }
        .log-warning { color: #ed8936; }
        .log-error { color: #f56565; }

        .test-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="testing-container">
        <div class="testing-header">
            <h1>ğŸ§ª åŠŸèƒ½æµ‹è¯•å·¥å…·</h1>
            <p>æµ‹è¯•MSHç³»ç»Ÿçš„å„é¡¹åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        </div>
        
        <!-- æµ‹è¯•ç»Ÿè®¡ -->
        <div class="test-section">
            <h2>ğŸ“Š æµ‹è¯•ç»Ÿè®¡</h2>
            <div class="test-summary">
                <div class="summary-card">
                    <div class="summary-number" id="totalTests">0</div>
                    <div class="summary-label">æ€»æµ‹è¯•æ•°</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="passedTests">0</div>
                    <div class="summary-label">é€šè¿‡æµ‹è¯•</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="failedTests">0</div>
                    <div class="summary-label">å¤±è´¥æµ‹è¯•</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="pendingTests">0</div>
                    <div class="summary-label">å¾…æµ‹è¯•</div>
                </div>
            </div>
        </div>
        
        <!-- æµ‹è¯•æ“ä½œ -->
        <div class="test-section">
            <h2>ğŸ”„ æµ‹è¯•æ“ä½œ</h2>
            <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="runAllTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
                <button class="btn btn-success" onclick="runPassedTests()">âœ… è¿è¡Œé€šè¿‡æµ‹è¯•</button>
                <button class="btn btn-warning" onclick="runFailedTests()">âŒ è¿è¡Œå¤±è´¥æµ‹è¯•</button>
                <button class="btn btn-danger" onclick="resetAllTests()">ğŸ”„ é‡ç½®æ‰€æœ‰æµ‹è¯•</button>
            </div>
        </div>
        
        <!-- æ•°æ®åŒæ­¥æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”„ æ•°æ®åŒæ­¥æµ‹è¯•</h2>
            <div class="test-category">
                <h3>Firebaseè¿æ¥æµ‹è¯•</h3>
                <div class="test-item" id="test-firebase-connection">
                    <div class="test-item-header">
                        <div class="test-item-title">Firebaseè¿æ¥æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('firebase-connection')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-firebase-connection"></div>
                </div>
                
                <div class="test-item" id="test-firebase-read">
                    <div class="test-item-header">
                        <div class="test-item-title">Firebaseæ•°æ®è¯»å–æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('firebase-read')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-firebase-read"></div>
                </div>
                
                <div class="test-item" id="test-firebase-write">
                    <div class="test-item-header">
                        <div class="test-item-title">Firebaseæ•°æ®å†™å…¥æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('firebase-write')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-firebase-write"></div>
                </div>
            </div>
        </div>
        
        <!-- æ•°æ®ç®¡ç†æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ’¾ æ•°æ®ç®¡ç†æµ‹è¯•</h2>
            <div class="test-category">
                <h3>æœ¬åœ°å­˜å‚¨æµ‹è¯•</h3>
                <div class="test-item" id="test-local-storage">
                    <div class="test-item-header">
                        <div class="test-item-title">æœ¬åœ°å­˜å‚¨è¯»å†™æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('local-storage')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-local-storage"></div>
                </div>
                
                <div class="test-item" id="test-data-consistency">
                    <div class="test-item-header">
                        <div class="test-item-title">æ•°æ®ä¸€è‡´æ€§æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('data-consistency')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-data-consistency"></div>
                </div>
                
                <div class="test-item" id="test-data-backup">
                    <div class="test-item-header">
                        <div class="test-item-title">æ•°æ®å¤‡ä»½æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('data-backup')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-data-backup"></div>
                </div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½æ¨¡å—æµ‹è¯• -->
        <div class="test-section">
            <h2>âš™ï¸ åŠŸèƒ½æ¨¡å—æµ‹è¯•</h2>
            <div class="test-category">
                <h3>ç­¾åˆ°åŠŸèƒ½æµ‹è¯•</h3>
                <div class="test-item" id="test-signin-function">
                    <div class="test-item-header">
                        <div class="test-item-title">ç­¾åˆ°åŠŸèƒ½æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('signin-function')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-signin-function"></div>
                </div>
                
                <div class="test-item" id="test-member-management">
                    <div class="test-item-header">
                        <div class="test-item-title">æˆå‘˜ç®¡ç†æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('member-management')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-member-management"></div>
                </div>
                
                <div class="test-item" id="test-group-management">
                    <div class="test-item-header">
                        <div class="test-item-title">å°ç»„ç®¡ç†æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('group-management')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-group-management"></div>
                </div>
            </div>
        </div>
        
        <!-- æ€§èƒ½æµ‹è¯• -->
        <div class="test-section">
            <h2>âš¡ æ€§èƒ½æµ‹è¯•</h2>
            <div class="test-category">
                <h3>åŠ è½½æ€§èƒ½æµ‹è¯•</h3>
                <div class="test-item" id="test-page-load">
                    <div class="test-item-header">
                        <div class="test-item-title">é¡µé¢åŠ è½½æ€§èƒ½æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('page-load')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-page-load"></div>
                </div>
                
                <div class="test-item" id="test-data-load">
                    <div class="test-item-header">
                        <div class="test-item-title">æ•°æ®åŠ è½½æ€§èƒ½æµ‹è¯•</div>
                        <div class="test-item-status pending">å¾…æµ‹è¯•</div>
                    </div>
                    <div class="test-item-actions">
                        <button class="btn btn-primary" onclick="runTest('data-load')">è¿è¡Œæµ‹è¯•</button>
                    </div>
                    <div class="test-results" id="results-data-load"></div>
                </div>
            </div>
        </div>
        
        <!-- æµ‹è¯•æ—¥å¿— -->
        <div class="test-section">
            <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
            <div class="test-log" id="testLog">
                <div class="log-entry info">åŠŸèƒ½æµ‹è¯•å·¥å…·å·²åŠ è½½</div>
            </div>
            <button class="btn btn-warning" onclick="clearTestLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="../../src/smart-config-loader.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="../../src/utils.js"></script>
    <script src="../../src/new-data-manager.js"></script>
    <script src="../../src/data-backup-manager.js"></script>
    
    <script>
        // åŠŸèƒ½æµ‹è¯•å·¥å…·
        let testResults = {};
        let totalTests = 0;
        let passedTests = 0;
        let failedTests = 0;
        let pendingTests = 0;
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addTestLog('info', 'åŠŸèƒ½æµ‹è¯•å·¥å…·å·²åŠ è½½');
            updateTestStats();
        });
        
        // è¿è¡Œå•ä¸ªæµ‹è¯•
        async function runTest(testId) {
            try {
                addTestLog('info', `å¼€å§‹è¿è¡Œæµ‹è¯•: ${testId}`);
                
                // æ›´æ–°æµ‹è¯•çŠ¶æ€
                updateTestStatus(testId, 'running');
                
                // æ‰§è¡Œæµ‹è¯•
                const result = await executeTest(testId);
                
                // æ›´æ–°æµ‹è¯•ç»“æœ
                testResults[testId] = result;
                updateTestStatus(testId, result.passed ? 'passed' : 'failed');
                displayTestResults(testId, result);
                
                // æ›´æ–°ç»Ÿè®¡
                updateTestStats();
                
                addTestLog(result.passed ? 'success' : 'error', 
                    `æµ‹è¯• ${testId} ${result.passed ? 'é€šè¿‡' : 'å¤±è´¥'}: ${result.message}`);
                
            } catch (error) {
                console.error(`æµ‹è¯• ${testId} å¤±è´¥:`, error);
                addTestLog('error', `æµ‹è¯• ${testId} å¤±è´¥: ${error.message}`);
                updateTestStatus(testId, 'failed');
                updateTestStats();
            }
        }
        
        // æ‰§è¡Œå…·ä½“æµ‹è¯•
        async function executeTest(testId) {
            switch (testId) {
                case 'firebase-connection':
                    return await testFirebaseConnection();
                case 'firebase-read':
                    return await testFirebaseRead();
                case 'firebase-write':
                    return await testFirebaseWrite();
                case 'local-storage':
                    return await testLocalStorage();
                case 'data-consistency':
                    return await testDataConsistency();
                case 'data-backup':
                    return await testDataBackup();
                case 'signin-function':
                    return await testSigninFunction();
                case 'member-management':
                    return await testMemberManagement();
                case 'group-management':
                    return await testGroupManagement();
                case 'page-load':
                    return await testPageLoad();
                case 'data-load':
                    return await testDataLoad();
                default:
                    throw new Error(`æœªçŸ¥æµ‹è¯•: ${testId}`);
            }
        }
        
        // Firebaseè¿æ¥æµ‹è¯•
        async function testFirebaseConnection() {
            try {
                if (typeof firebase === 'undefined') {
                    return { passed: false, message: 'Firebase SDKæœªåŠ è½½' };
                }
                
                if (firebase.apps.length === 0) {
                    return { passed: false, message: 'Firebaseæœªåˆå§‹åŒ–' };
                }
                
                const db = firebase.database();
                await db.ref('test').once('value');
                
                return { passed: true, message: 'Firebaseè¿æ¥æ­£å¸¸' };
            } catch (error) {
                return { passed: false, message: `Firebaseè¿æ¥å¤±è´¥: ${error.message}` };
            }
        }
        
        // Firebaseæ•°æ®è¯»å–æµ‹è¯•
        async function testFirebaseRead() {
            try {
                const db = firebase.database();
                const snapshot = await db.ref('groups').once('value');
                const data = snapshot.val();
                
                return { passed: true, message: `æˆåŠŸè¯»å–æ•°æ®ï¼ŒåŒ…å« ${Object.keys(data || {}).length} ä¸ªå°ç»„` };
            } catch (error) {
                return { passed: false, message: `Firebaseè¯»å–å¤±è´¥: ${error.message}` };
            }
        }
        
        // Firebaseæ•°æ®å†™å…¥æµ‹è¯•
        async function testFirebaseWrite() {
            try {
                const db = firebase.database();
                const testData = { test: 'data', timestamp: new Date().toISOString() };
                
                await db.ref('test').set(testData);
                await db.ref('test').remove();
                
                return { passed: true, message: 'Firebaseå†™å…¥æµ‹è¯•æˆåŠŸ' };
            } catch (error) {
                return { passed: false, message: `Firebaseå†™å…¥å¤±è´¥: ${error.message}` };
            }
        }
        
        // æœ¬åœ°å­˜å‚¨æµ‹è¯•
        async function testLocalStorage() {
            try {
                const testKey = 'msh_test_' + Date.now();
                const testData = { test: 'data', timestamp: new Date().toISOString() };
                
                // å†™å…¥æµ‹è¯•
                localStorage.setItem(testKey, JSON.stringify(testData));
                
                // è¯»å–æµ‹è¯•
                const retrieved = JSON.parse(localStorage.getItem(testKey));
                
                // æ¸…ç†æµ‹è¯•æ•°æ®
                localStorage.removeItem(testKey);
                
                if (JSON.stringify(retrieved) === JSON.stringify(testData)) {
                    return { passed: true, message: 'æœ¬åœ°å­˜å‚¨è¯»å†™æ­£å¸¸' };
                } else {
                    return { passed: false, message: 'æœ¬åœ°å­˜å‚¨æ•°æ®ä¸ä¸€è‡´' };
                }
            } catch (error) {
                return { passed: false, message: `æœ¬åœ°å­˜å‚¨æµ‹è¯•å¤±è´¥: ${error.message}` };
            }
        }
        
        // æ•°æ®ä¸€è‡´æ€§æµ‹è¯•
        async function testDataConsistency() {
            try {
                const groups = JSON.parse(localStorage.getItem('msh_groups') || '{}');
                const groupNames = JSON.parse(localStorage.getItem('msh_groupNames') || '{}');
                
                // æ£€æŸ¥å°ç»„é”®åä¸€è‡´æ€§
                const groupKeys = Object.keys(groups);
                const nameKeys = Object.keys(groupNames);
                
                const missingNames = groupKeys.filter(key => !nameKeys.includes(key));
                const missingGroups = nameKeys.filter(key => !groupKeys.includes(key));
                
                if (missingNames.length > 0 || missingGroups.length > 0) {
                    return { 
                        passed: false, 
                        message: `æ•°æ®ä¸ä¸€è‡´: ç¼ºå°‘åç§° ${missingNames.length} ä¸ª, ç¼ºå°‘å°ç»„ ${missingGroups.length} ä¸ª` 
                    };
                }
                
                return { passed: true, message: `æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡ï¼Œå…± ${groupKeys.length} ä¸ªå°ç»„` };
            } catch (error) {
                return { passed: false, message: `æ•°æ®ä¸€è‡´æ€§æµ‹è¯•å¤±è´¥: ${error.message}` };
            }
        }
        
        // æ•°æ®å¤‡ä»½æµ‹è¯•
        async function testDataBackup() {
            try {
                if (!window.dataBackupManager) {
                    return { passed: false, message: 'æ•°æ®å¤‡ä»½ç®¡ç†å™¨æœªåŠ è½½' };
                }
                
                const backupId = await window.dataBackupManager.createFullBackup('æµ‹è¯•å¤‡ä»½');
                
                return { passed: true, message: `æ•°æ®å¤‡ä»½æµ‹è¯•æˆåŠŸï¼Œå¤‡ä»½ID: ${backupId}` };
            } catch (error) {
                return { passed: false, message: `æ•°æ®å¤‡ä»½æµ‹è¯•å¤±è´¥: ${error.message}` };
            }
        }
        
        // ç­¾åˆ°åŠŸèƒ½æµ‹è¯•
        async function testSigninFunction() {
            try {
                // æ£€æŸ¥ç­¾åˆ°ç›¸å…³å‡½æ•°æ˜¯å¦å­˜åœ¨
                if (typeof window.signin === 'undefined') {
                    return { passed: false, message: 'ç­¾åˆ°å‡½æ•°æœªå®šä¹‰' };
                }
                
                // æ£€æŸ¥å¿…è¦çš„æ•°æ®ç»“æ„
                const groups = JSON.parse(localStorage.getItem('msh_groups') || '{}');
                if (Object.keys(groups).length === 0) {
                    return { passed: false, message: 'æ²¡æœ‰å°ç»„æ•°æ®' };
                }
                
                return { passed: true, message: 'ç­¾åˆ°åŠŸèƒ½æ£€æŸ¥é€šè¿‡' };
            } catch (error) {
                return { passed: false, message: `ç­¾åˆ°åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}` };
            }
        }
        
        // æˆå‘˜ç®¡ç†æµ‹è¯•
        async function testMemberManagement() {
            try {
                const groups = JSON.parse(localStorage.getItem('msh_groups') || '{}');
                let totalMembers = 0;
                
                Object.values(groups).forEach(group => {
                    if (Array.isArray(group)) {
                        totalMembers += group.length;
                    }
                });
                
                return { passed: true, message: `æˆå‘˜ç®¡ç†æ£€æŸ¥é€šè¿‡ï¼Œå…± ${totalMembers} ä¸ªæˆå‘˜` };
            } catch (error) {
                return { passed: false, message: `æˆå‘˜ç®¡ç†æµ‹è¯•å¤±è´¥: ${error.message}` };
            }
        }
        
        // å°ç»„ç®¡ç†æµ‹è¯•
        async function testGroupManagement() {
            try {
                const groups = JSON.parse(localStorage.getItem('msh_groups') || '{}');
                const groupNames = JSON.parse(localStorage.getItem('msh_groupNames') || '{}');
                
                if (Object.keys(groups).length === 0) {
                    return { passed: false, message: 'æ²¡æœ‰å°ç»„æ•°æ®' };
                }
                
                return { passed: true, message: `å°ç»„ç®¡ç†æ£€æŸ¥é€šè¿‡ï¼Œå…± ${Object.keys(groups).length} ä¸ªå°ç»„` };
            } catch (error) {
                return { passed: false, message: `å°ç»„ç®¡ç†æµ‹è¯•å¤±è´¥: ${error.message}` };
            }
        }
        
        // é¡µé¢åŠ è½½æ€§èƒ½æµ‹è¯•
        async function testPageLoad() {
            try {
                const startTime = performance.now();
                
                // æ¨¡æ‹Ÿé¡µé¢åŠ è½½
                await new Promise(resolve => setTimeout(resolve, 100));
                
                const endTime = performance.now();
                const loadTime = endTime - startTime;
                
                return { passed: true, message: `é¡µé¢åŠ è½½æ€§èƒ½æµ‹è¯•å®Œæˆï¼Œè€—æ—¶: ${loadTime.toFixed(2)}ms` };
            } catch (error) {
                return { passed: false, message: `é¡µé¢åŠ è½½æ€§èƒ½æµ‹è¯•å¤±è´¥: ${error.message}` };
            }
        }
        
        // æ•°æ®åŠ è½½æ€§èƒ½æµ‹è¯•
        async function testDataLoad() {
            try {
                const startTime = performance.now();
                
                // æ¨¡æ‹Ÿæ•°æ®åŠ è½½
                const groups = JSON.parse(localStorage.getItem('msh_groups') || '{}');
                const groupNames = JSON.parse(localStorage.getItem('msh_groupNames') || '{}');
                const attendanceRecords = JSON.parse(localStorage.getItem('msh_attendanceRecords') || '[]');
                
                const endTime = performance.now();
                const loadTime = endTime - startTime;
                
                return { passed: true, message: `æ•°æ®åŠ è½½æ€§èƒ½æµ‹è¯•å®Œæˆï¼Œè€—æ—¶: ${loadTime.toFixed(2)}ms` };
            } catch (error) {
                return { passed: false, message: `æ•°æ®åŠ è½½æ€§èƒ½æµ‹è¯•å¤±è´¥: ${error.message}` };
            }
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            addTestLog('info', 'å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            
            const testIds = [
                'firebase-connection', 'firebase-read', 'firebase-write',
                'local-storage', 'data-consistency', 'data-backup',
                'signin-function', 'member-management', 'group-management',
                'page-load', 'data-load'
            ];
            
            for (const testId of testIds) {
                await runTest(testId);
                await new Promise(resolve => setTimeout(resolve, 500)); // å»¶è¿Ÿ500ms
            }
            
            addTestLog('success', 'æ‰€æœ‰æµ‹è¯•è¿è¡Œå®Œæˆ');
        }
        
        // è¿è¡Œé€šè¿‡çš„æµ‹è¯•
        async function runPassedTests() {
            const passedTestIds = Object.keys(testResults).filter(id => testResults[id].passed);
            addTestLog('info', `å¼€å§‹è¿è¡Œ ${passedTestIds.length} ä¸ªé€šè¿‡çš„æµ‹è¯•...`);
            
            for (const testId of passedTestIds) {
                await runTest(testId);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }
        
        // è¿è¡Œå¤±è´¥çš„æµ‹è¯•
        async function runFailedTests() {
            const failedTestIds = Object.keys(testResults).filter(id => !testResults[id].passed);
            addTestLog('info', `å¼€å§‹è¿è¡Œ ${failedTestIds.length} ä¸ªå¤±è´¥çš„æµ‹è¯•...`);
            
            for (const testId of failedTestIds) {
                await runTest(testId);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }
        
        // é‡ç½®æ‰€æœ‰æµ‹è¯•
        function resetAllTests() {
            testResults = {};
            updateTestStats();
            
            // é‡ç½®æ‰€æœ‰æµ‹è¯•çŠ¶æ€
            document.querySelectorAll('.test-item-status').forEach(status => {
                status.textContent = 'å¾…æµ‹è¯•';
                status.className = 'test-item-status pending';
            });
            
            // éšè—æ‰€æœ‰æµ‹è¯•ç»“æœ
            document.querySelectorAll('.test-results').forEach(results => {
                results.style.display = 'none';
            });
            
            addTestLog('info', 'æ‰€æœ‰æµ‹è¯•å·²é‡ç½®');
        }
        
        // æ›´æ–°æµ‹è¯•çŠ¶æ€
        function updateTestStatus(testId, status) {
            const statusElement = document.querySelector(`#test-${testId} .test-item-status`);
            if (statusElement) {
                statusElement.textContent = {
                    'pending': 'å¾…æµ‹è¯•',
                    'running': 'è¿è¡Œä¸­',
                    'passed': 'é€šè¿‡',
                    'failed': 'å¤±è´¥'
                }[status];
                statusElement.className = `test-item-status ${status}`;
            }
        }
        
        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function displayTestResults(testId, result) {
            const resultsElement = document.getElementById(`results-${testId}`);
            if (resultsElement) {
                resultsElement.innerHTML = `
                    <div style="color: ${result.passed ? '#48bb78' : '#f56565'}; font-weight: bold;">
                        ${result.passed ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}: ${result.message}
                    </div>
                `;
                resultsElement.style.display = 'block';
            }
        }
        
        // æ›´æ–°æµ‹è¯•ç»Ÿè®¡
        function updateTestStats() {
            totalTests = document.querySelectorAll('.test-item').length;
            passedTests = Object.values(testResults).filter(result => result.passed).length;
            failedTests = Object.values(testResults).filter(result => !result.passed).length;
            pendingTests = totalTests - Object.keys(testResults).length;
            
            document.getElementById('totalTests').textContent = totalTests;
            document.getElementById('passedTests').textContent = passedTests;
            document.getElementById('failedTests').textContent = failedTests;
            document.getElementById('pendingTests').textContent = pendingTests;
        }
        
        // æ·»åŠ æµ‹è¯•æ—¥å¿—
        function addTestLog(type, message) {
            const container = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString('zh-CN');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
        }
        
        // æ¸…ç©ºæµ‹è¯•æ—¥å¿—
        function clearTestLog() {
            document.getElementById('testLog').innerHTML = '<div class="log-entry info">æµ‹è¯•æ—¥å¿—å·²æ¸…ç©º</div>';
        }
    </script>
</body>
</html>


