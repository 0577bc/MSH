<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»ŸéªŒè¯å·¥å…· - MSHç­¾åˆ°ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../../src/style.css">
    <style>
        .verification-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .verification-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .verification-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .verification-header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .verification-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .verification-section h2 {
            color: #2d3748;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .verification-item {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .verification-item:hover {
            background: #e2e8f0;
            border-color: #4299e1;
        }

        .verification-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .verification-item-title {
            font-weight: bold;
            color: #2d3748;
        }

        .verification-item-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .verification-item-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .verification-item-status.running {
            background: #d1ecf1;
            color: #0c5460;
        }

        .verification-item-status.passed {
            background: #d4edda;
            color: #155724;
        }

        .verification-item-status.failed {
            background: #f8d7da;
            color: #721c24;
        }

        .verification-item-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .verification-results {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 14px;
            display: none;
        }

        .verification-results.show {
            display: block;
        }

        .verification-log {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-info { color: #4299e1; }
        .log-success { color: #48bb78; }
        .log-warning { color: #ed8936; }
        .log-error { color: #f56565; }

        .verification-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .verification-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="verification-container">
        <div class="verification-header">
            <h1>ğŸ” ç³»ç»ŸéªŒè¯å·¥å…·</h1>
            <p>éªŒè¯MSHç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
        </div>
        
        <!-- éªŒè¯ç»Ÿè®¡ -->
        <div class="verification-section">
            <h2>ğŸ“Š éªŒè¯ç»Ÿè®¡</h2>
            <div class="verification-summary">
                <div class="summary-card">
                    <div class="summary-number" id="totalVerifications">0</div>
                    <div class="summary-label">æ€»éªŒè¯é¡¹</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="passedVerifications">0</div>
                    <div class="summary-label">é€šè¿‡éªŒè¯</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="failedVerifications">0</div>
                    <div class="summary-label">å¤±è´¥éªŒè¯</div>
                </div>
                <div class="summary-card">
                    <div class="summary-number" id="pendingVerifications">0</div>
                    <div class="summary-label">å¾…éªŒè¯</div>
                </div>
            </div>
        </div>
        
        <!-- éªŒè¯æ“ä½œ -->
        <div class="verification-section">
            <h2>ğŸ”„ éªŒè¯æ“ä½œ</h2>
            <div class="verification-actions">
                <button class="btn btn-primary" onclick="runAllVerifications()">ğŸš€ è¿è¡Œæ‰€æœ‰éªŒè¯</button>
                <button class="btn btn-success" onclick="runPassedVerifications()">âœ… è¿è¡Œé€šè¿‡éªŒè¯</button>
                <button class="btn btn-warning" onclick="runFailedVerifications()">âŒ è¿è¡Œå¤±è´¥éªŒè¯</button>
                <button class="btn btn-danger" onclick="resetAllVerifications()">ğŸ”„ é‡ç½®æ‰€æœ‰éªŒè¯</button>
            </div>
        </div>
        
        <!-- æ ¸å¿ƒåŠŸèƒ½éªŒè¯ -->
        <div class="verification-section">
            <h2>âš™ï¸ æ ¸å¿ƒåŠŸèƒ½éªŒè¯</h2>
            <div class="verification-item" id="verification-firebase-connection">
                <div class="verification-item-header">
                    <div class="verification-item-title">Firebaseè¿æ¥éªŒè¯</div>
                    <div class="verification-item-status pending">å¾…éªŒè¯</div>
                </div>
                <div class="verification-item-actions">
                    <button class="btn btn-primary" onclick="runVerification('firebase-connection')">è¿è¡ŒéªŒè¯</button>
                </div>
                <div class="verification-results" id="results-firebase-connection"></div>
            </div>
            
            <div class="verification-item" id="verification-data-sync">
                <div class="verification-item-header">
                    <div class="verification-item-title">æ•°æ®åŒæ­¥éªŒè¯</div>
                    <div class="verification-item-status pending">å¾…éªŒè¯</div>
                </div>
                <div class="verification-item-actions">
                    <button class="btn btn-primary" onclick="runVerification('data-sync')">è¿è¡ŒéªŒè¯</button>
                </div>
                <div class="verification-results" id="results-data-sync"></div>
            </div>
            
            <div class="verification-item" id="verification-excluded-members">
                <div class="verification-item-header">
                    <div class="verification-item-title">æ’é™¤äººå‘˜æ ‡è®°åŒ–éªŒè¯</div>
                    <div class="verification-item-status pending">å¾…éªŒè¯</div>
                </div>
                <div class="verification-item-actions">
                    <button class="btn btn-primary" onclick="runVerification('excluded-members')">è¿è¡ŒéªŒè¯</button>
                </div>
                <div class="verification-results" id="results-excluded-members"></div>
            </div>
        </div>
        
        <!-- æ–°å¢åŠŸèƒ½éªŒè¯ -->
        <div class="verification-section">
            <h2>ğŸ†• æ–°å¢åŠŸèƒ½éªŒè¯</h2>
            <div class="verification-item" id="verification-quarantine-mechanism">
                <div class="verification-item-header">
                    <div class="verification-item-title">å†²çªéš”ç¦»æœºåˆ¶éªŒè¯</div>
                    <div class="verification-item-status pending">å¾…éªŒè¯</div>
                </div>
                <div class="verification-item-actions">
                    <button class="btn btn-primary" onclick="runVerification('quarantine-mechanism')">è¿è¡ŒéªŒè¯</button>
                </div>
                <div class="verification-results" id="results-quarantine-mechanism"></div>
            </div>
            
            <div class="verification-item" id="verification-data-backup">
                <div class="verification-item-header">
                    <div class="verification-item-title">æ•°æ®å¤‡ä»½æœºåˆ¶éªŒè¯</div>
                    <div class="verification-item-status pending">å¾…éªŒè¯</div>
                </div>
                <div class="verification-item-actions">
                    <button class="btn btn-primary" onclick="runVerification('data-backup')">è¿è¡ŒéªŒè¯</button>
                </div>
                <div class="verification-results" id="results-data-backup"></div>
            </div>
            
            <div class="verification-item" id="verification-performance-monitor">
                <div class="verification-item-header">
                    <div class="verification-item-title">æ€§èƒ½ç›‘æ§éªŒè¯</div>
                    <div class="verification-item-status pending">å¾…éªŒè¯</div>
                </div>
                <div class="verification-item-actions">
                    <button class="btn btn-primary" onclick="runVerification('performance-monitor')">è¿è¡ŒéªŒè¯</button>
                </div>
                <div class="verification-results" id="results-performance-monitor"></div>
            </div>
            
            <div class="verification-item" id="verification-user-feedback">
                <div class="verification-item-header">
                    <div class="verification-item-title">ç”¨æˆ·åé¦ˆæ”¶é›†éªŒè¯</div>
                    <div class="verification-item-status pending">å¾…éªŒè¯</div>
                </div>
                <div class="verification-item-actions">
                    <button class="btn btn-primary" onclick="runVerification('user-feedback')">è¿è¡ŒéªŒè¯</button>
                </div>
                <div class="verification-results" id="results-user-feedback"></div>
            </div>
        </div>
        
        <!-- ç³»ç»Ÿé›†æˆéªŒè¯ -->
        <div class="verification-section">
            <h2>ğŸ”— ç³»ç»Ÿé›†æˆéªŒè¯</h2>
            <div class="verification-item" id="verification-system-integration">
                <div class="verification-item-header">
                    <div class="verification-item-title">ç³»ç»Ÿé›†æˆéªŒè¯</div>
                    <div class="verification-item-status pending">å¾…éªŒè¯</div>
                </div>
                <div class="verification-item-actions">
                    <button class="btn btn-primary" onclick="runVerification('system-integration')">è¿è¡ŒéªŒè¯</button>
                </div>
                <div class="verification-results" id="results-system-integration"></div>
            </div>
            
            <div class="verification-item" id="verification-data-consistency">
                <div class="verification-item-header">
                    <div class="verification-item-title">æ•°æ®ä¸€è‡´æ€§éªŒè¯</div>
                    <div class="verification-item-status pending">å¾…éªŒè¯</div>
                </div>
                <div class="verification-item-actions">
                    <button class="btn btn-primary" onclick="runVerification('data-consistency')">è¿è¡ŒéªŒè¯</button>
                </div>
                <div class="verification-results" id="results-data-consistency"></div>
            </div>
        </div>
        
        <!-- éªŒè¯æ—¥å¿— -->
        <div class="verification-section">
            <h2>ğŸ“ éªŒè¯æ—¥å¿—</h2>
            <div class="verification-log" id="verificationLog">
                <div class="log-entry info">ç³»ç»ŸéªŒè¯å·¥å…·å·²åŠ è½½</div>
            </div>
            <button class="btn btn-warning" onclick="clearVerificationLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script src="../../config.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="../../src/utils.js"></script>
    <script src="../../src/new-data-manager.js"></script>
    <script src="../../src/data-backup-manager.js"></script>
    <script src="../../src/performance-monitor.js"></script>
    <script src="../../src/user-feedback-collector.js"></script>
    
    <script>
        // ç³»ç»ŸéªŒè¯å·¥å…·
        let verificationResults = {};
        let totalVerifications = 0;
        let passedVerifications = 0;
        let failedVerifications = 0;
        let pendingVerifications = 0;
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addVerificationLog('info', 'ç³»ç»ŸéªŒè¯å·¥å…·å·²åŠ è½½');
            updateVerificationStats();
        });
        
        // è¿è¡Œå•ä¸ªéªŒè¯
        async function runVerification(verificationId) {
            try {
                addVerificationLog('info', `å¼€å§‹è¿è¡ŒéªŒè¯: ${verificationId}`);
                
                // æ›´æ–°éªŒè¯çŠ¶æ€
                updateVerificationStatus(verificationId, 'running');
                
                // æ‰§è¡ŒéªŒè¯
                const result = await executeVerification(verificationId);
                
                // æ›´æ–°éªŒè¯ç»“æœ
                verificationResults[verificationId] = result;
                updateVerificationStatus(verificationId, result.passed ? 'passed' : 'failed');
                displayVerificationResults(verificationId, result);
                
                // æ›´æ–°ç»Ÿè®¡
                updateVerificationStats();
                
                addVerificationLog(result.passed ? 'success' : 'error', 
                    `éªŒè¯ ${verificationId} ${result.passed ? 'é€šè¿‡' : 'å¤±è´¥'}: ${result.message}`);
                
            } catch (error) {
                console.error(`éªŒè¯ ${verificationId} å¤±è´¥:`, error);
                addVerificationLog('error', `éªŒè¯ ${verificationId} å¤±è´¥: ${error.message}`);
                updateVerificationStatus(verificationId, 'failed');
                updateVerificationStats();
            }
        }
        
        // æ‰§è¡Œå…·ä½“éªŒè¯
        async function executeVerification(verificationId) {
            switch (verificationId) {
                case 'firebase-connection':
                    return await verifyFirebaseConnection();
                case 'data-sync':
                    return await verifyDataSync();
                case 'excluded-members':
                    return await verifyExcludedMembers();
                case 'quarantine-mechanism':
                    return await verifyQuarantineMechanism();
                case 'data-backup':
                    return await verifyDataBackup();
                case 'performance-monitor':
                    return await verifyPerformanceMonitor();
                case 'user-feedback':
                    return await verifyUserFeedback();
                case 'system-integration':
                    return await verifySystemIntegration();
                case 'data-consistency':
                    return await verifyDataConsistency();
                default:
                    throw new Error(`æœªçŸ¥éªŒè¯: ${verificationId}`);
            }
        }
        
        // Firebaseè¿æ¥éªŒè¯
        async function verifyFirebaseConnection() {
            try {
                if (typeof firebase === 'undefined') {
                    return { passed: false, message: 'Firebase SDKæœªåŠ è½½' };
                }
                
                if (firebase.apps.length === 0) {
                    return { passed: false, message: 'Firebaseæœªåˆå§‹åŒ–' };
                }
                
                const db = firebase.database();
                await db.ref('test').once('value');
                
                return { passed: true, message: 'Firebaseè¿æ¥æ­£å¸¸' };
            } catch (error) {
                return { passed: false, message: `Firebaseè¿æ¥å¤±è´¥: ${error.message}` };
            }
        }
        
        // æ•°æ®åŒæ­¥éªŒè¯
        async function verifyDataSync() {
            try {
                // æ£€æŸ¥æ•°æ®åŒæ­¥æœºåˆ¶
                const groups = JSON.parse(localStorage.getItem('msh_groups') || '{}');
                const groupNames = JSON.parse(localStorage.getItem('msh_groupNames') || '{}');
                
                if (Object.keys(groups).length === 0) {
                    return { passed: false, message: 'æ²¡æœ‰å°ç»„æ•°æ®' };
                }
                
                // æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
                const groupKeys = Object.keys(groups);
                const nameKeys = Object.keys(groupNames);
                
                if (groupKeys.length !== nameKeys.length) {
                    return { passed: false, message: 'å°ç»„æ•°æ®ä¸åç§°æ•°æ®ä¸ä¸€è‡´' };
                }
                
                return { passed: true, message: `æ•°æ®åŒæ­¥æ­£å¸¸ï¼Œå…± ${groupKeys.length} ä¸ªå°ç»„` };
            } catch (error) {
                return { passed: false, message: `æ•°æ®åŒæ­¥éªŒè¯å¤±è´¥: ${error.message}` };
            }
        }
        
        // æ’é™¤äººå‘˜æ ‡è®°åŒ–éªŒè¯
        async function verifyExcludedMembers() {
            try {
                // æ£€æŸ¥æ’é™¤äººå‘˜æ ‡è®°åŒ–åŠŸèƒ½
                if (typeof window.utils === 'undefined' || !window.utils.setMemberExcluded) {
                    return { passed: false, message: 'æ’é™¤äººå‘˜æ ‡è®°åŒ–åŠŸèƒ½æœªå®ç°' };
                }
                
                // æ£€æŸ¥è¿ç§»åŠŸèƒ½
                if (typeof window.utils.migrateExcludedMembers === 'undefined') {
                    return { passed: false, message: 'æ’é™¤äººå‘˜è¿ç§»åŠŸèƒ½æœªå®ç°' };
                }
                
                return { passed: true, message: 'æ’é™¤äººå‘˜æ ‡è®°åŒ–åŠŸèƒ½æ­£å¸¸' };
            } catch (error) {
                return { passed: false, message: `æ’é™¤äººå‘˜æ ‡è®°åŒ–éªŒè¯å¤±è´¥: ${error.message}` };
            }
        }
        
        // å†²çªéš”ç¦»æœºåˆ¶éªŒè¯
        async function verifyQuarantineMechanism() {
            try {
                // æ£€æŸ¥å†²çªéš”ç¦»åŠŸèƒ½
                const conflictManager = document.querySelector('[href*="data-conflict-manager"]');
                if (!conflictManager) {
                    return { passed: false, message: 'å†²çªç®¡ç†å·¥å…·æœªæ‰¾åˆ°' };
                }
                
                // æ£€æŸ¥éš”ç¦»åŠŸèƒ½
                if (typeof loadQuarantineData === 'undefined') {
                    return { passed: false, message: 'éš”ç¦»åŠŸèƒ½æœªå®ç°' };
                }
                
                return { passed: true, message: 'å†²çªéš”ç¦»æœºåˆ¶æ­£å¸¸' };
            } catch (error) {
                return { passed: false, message: `å†²çªéš”ç¦»æœºåˆ¶éªŒè¯å¤±è´¥: ${error.message}` };
            }
        }
        
        // æ•°æ®å¤‡ä»½éªŒè¯
        async function verifyDataBackup() {
            try {
                // æ£€æŸ¥æ•°æ®å¤‡ä»½ç®¡ç†å™¨
                if (typeof window.dataBackupManager === 'undefined') {
                    return { passed: false, message: 'æ•°æ®å¤‡ä»½ç®¡ç†å™¨æœªåŠ è½½' };
                }
                
                // æ£€æŸ¥å¤‡ä»½åŠŸèƒ½
                if (typeof window.dataBackupManager.createFullBackup === 'undefined') {
                    return { passed: false, message: 'æ•°æ®å¤‡ä»½åŠŸèƒ½æœªå®ç°' };
                }
                
                return { passed: true, message: 'æ•°æ®å¤‡ä»½æœºåˆ¶æ­£å¸¸' };
            } catch (error) {
                return { passed: false, message: `æ•°æ®å¤‡ä»½éªŒè¯å¤±è´¥: ${error.message}` };
            }
        }
        
        // æ€§èƒ½ç›‘æ§éªŒè¯
        async function verifyPerformanceMonitor() {
            try {
                // æ£€æŸ¥æ€§èƒ½ç›‘æ§å™¨
                if (typeof window.performanceMonitor === 'undefined') {
                    return { passed: false, message: 'æ€§èƒ½ç›‘æ§å™¨æœªåŠ è½½' };
                }
                
                // æ£€æŸ¥ç›‘æ§åŠŸèƒ½
                if (typeof window.performanceMonitor.getPerformanceReport === 'undefined') {
                    return { passed: false, message: 'æ€§èƒ½ç›‘æ§åŠŸèƒ½æœªå®ç°' };
                }
                
                return { passed: true, message: 'æ€§èƒ½ç›‘æ§æ­£å¸¸' };
            } catch (error) {
                return { passed: false, message: `æ€§èƒ½ç›‘æ§éªŒè¯å¤±è´¥: ${error.message}` };
            }
        }
        
        // ç”¨æˆ·åé¦ˆæ”¶é›†éªŒè¯
        async function verifyUserFeedback() {
            try {
                // æ£€æŸ¥ç”¨æˆ·åé¦ˆæ”¶é›†å™¨
                if (typeof window.userFeedbackCollector === 'undefined') {
                    return { passed: false, message: 'ç”¨æˆ·åé¦ˆæ”¶é›†å™¨æœªåŠ è½½' };
                }
                
                // æ£€æŸ¥åé¦ˆåŠŸèƒ½
                if (typeof window.userFeedbackCollector.submitFeedback === 'undefined') {
                    return { passed: false, message: 'ç”¨æˆ·åé¦ˆåŠŸèƒ½æœªå®ç°' };
                }
                
                return { passed: true, message: 'ç”¨æˆ·åé¦ˆæ”¶é›†æ­£å¸¸' };
            } catch (error) {
                return { passed: false, message: `ç”¨æˆ·åé¦ˆéªŒè¯å¤±è´¥: ${error.message}` };
            }
        }
        
        // ç³»ç»Ÿé›†æˆéªŒè¯
        async function verifySystemIntegration() {
            try {
                // æ£€æŸ¥æ‰€æœ‰æ ¸å¿ƒç»„ä»¶
                const components = [
                    { name: 'Firebase', check: () => typeof firebase !== 'undefined' },
                    { name: 'Utils', check: () => typeof window.utils !== 'undefined' },
                    { name: 'NewDataManager', check: () => typeof window.newDataManager !== 'undefined' },
                    { name: 'DataBackupManager', check: () => typeof window.dataBackupManager !== 'undefined' },
                    { name: 'PerformanceMonitor', check: () => typeof window.performanceMonitor !== 'undefined' },
                    { name: 'UserFeedbackCollector', check: () => typeof window.userFeedbackCollector !== 'undefined' }
                ];
                
                const missingComponents = components.filter(component => !component.check());
                
                if (missingComponents.length > 0) {
                    return { passed: false, message: `ç¼ºå°‘ç»„ä»¶: ${missingComponents.map(c => c.name).join(', ')}` };
                }
                
                return { passed: true, message: 'ç³»ç»Ÿé›†æˆæ­£å¸¸ï¼Œæ‰€æœ‰ç»„ä»¶å·²åŠ è½½' };
            } catch (error) {
                return { passed: false, message: `ç³»ç»Ÿé›†æˆéªŒè¯å¤±è´¥: ${error.message}` };
            }
        }
        
        // æ•°æ®ä¸€è‡´æ€§éªŒè¯
        async function verifyDataConsistency() {
            try {
                // æ£€æŸ¥æ•°æ®ä¸€è‡´æ€§
                const groups = JSON.parse(localStorage.getItem('msh_groups') || '{}');
                const groupNames = JSON.parse(localStorage.getItem('msh_groupNames') || '{}');
                const attendanceRecords = JSON.parse(localStorage.getItem('msh_attendanceRecords') || '[]');
                
                // æ£€æŸ¥å°ç»„æ•°æ®ä¸€è‡´æ€§
                const groupKeys = Object.keys(groups);
                const nameKeys = Object.keys(groupNames);
                
                if (groupKeys.length !== nameKeys.length) {
                    return { passed: false, message: 'å°ç»„æ•°æ®ä¸åç§°æ•°æ®ä¸ä¸€è‡´' };
                }
                
                // æ£€æŸ¥ç­¾åˆ°è®°å½•ä¸­çš„å°ç»„å¼•ç”¨
                const invalidGroups = attendanceRecords.filter(record => 
                    record.group && !groupKeys.includes(record.group)
                );
                
                if (invalidGroups.length > 0) {
                    return { passed: false, message: `å‘ç° ${invalidGroups.length} æ¡æ— æ•ˆå°ç»„å¼•ç”¨çš„ç­¾åˆ°è®°å½•` };
                }
                
                return { passed: true, message: 'æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡' };
            } catch (error) {
                return { passed: false, message: `æ•°æ®ä¸€è‡´æ€§éªŒè¯å¤±è´¥: ${error.message}` };
            }
        }
        
        // è¿è¡Œæ‰€æœ‰éªŒè¯
        async function runAllVerifications() {
            addVerificationLog('info', 'å¼€å§‹è¿è¡Œæ‰€æœ‰éªŒè¯...');
            
            const verificationIds = [
                'firebase-connection', 'data-sync', 'excluded-members',
                'quarantine-mechanism', 'data-backup', 'performance-monitor',
                'user-feedback', 'system-integration', 'data-consistency'
            ];
            
            for (const verificationId of verificationIds) {
                await runVerification(verificationId);
                await new Promise(resolve => setTimeout(resolve, 500)); // å»¶è¿Ÿ500ms
            }
            
            addVerificationLog('success', 'æ‰€æœ‰éªŒè¯è¿è¡Œå®Œæˆ');
        }
        
        // è¿è¡Œé€šè¿‡çš„éªŒè¯
        async function runPassedVerifications() {
            const passedVerificationIds = Object.keys(verificationResults).filter(id => verificationResults[id].passed);
            addVerificationLog('info', `å¼€å§‹è¿è¡Œ ${passedVerificationIds.length} ä¸ªé€šè¿‡çš„éªŒè¯...`);
            
            for (const verificationId of passedVerificationIds) {
                await runVerification(verificationId);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }
        
        // è¿è¡Œå¤±è´¥çš„éªŒè¯
        async function runFailedVerifications() {
            const failedVerificationIds = Object.keys(verificationResults).filter(id => !verificationResults[id].passed);
            addVerificationLog('info', `å¼€å§‹è¿è¡Œ ${failedVerificationIds.length} ä¸ªå¤±è´¥çš„éªŒè¯...`);
            
            for (const verificationId of failedVerificationIds) {
                await runVerification(verificationId);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }
        
        // é‡ç½®æ‰€æœ‰éªŒè¯
        function resetAllVerifications() {
            verificationResults = {};
            updateVerificationStats();
            
            // é‡ç½®æ‰€æœ‰éªŒè¯çŠ¶æ€
            document.querySelectorAll('.verification-item-status').forEach(status => {
                status.textContent = 'å¾…éªŒè¯';
                status.className = 'verification-item-status pending';
            });
            
            // éšè—æ‰€æœ‰éªŒè¯ç»“æœ
            document.querySelectorAll('.verification-results').forEach(results => {
                results.style.display = 'none';
            });
            
            addVerificationLog('info', 'æ‰€æœ‰éªŒè¯å·²é‡ç½®');
        }
        
        // æ›´æ–°éªŒè¯çŠ¶æ€
        function updateVerificationStatus(verificationId, status) {
            const statusElement = document.querySelector(`#verification-${verificationId} .verification-item-status`);
            if (statusElement) {
                statusElement.textContent = {
                    'pending': 'å¾…éªŒè¯',
                    'running': 'è¿è¡Œä¸­',
                    'passed': 'é€šè¿‡',
                    'failed': 'å¤±è´¥'
                }[status];
                statusElement.className = `verification-item-status ${status}`;
            }
        }
        
        // æ˜¾ç¤ºéªŒè¯ç»“æœ
        function displayVerificationResults(verificationId, result) {
            const resultsElement = document.getElementById(`results-${verificationId}`);
            if (resultsElement) {
                resultsElement.innerHTML = `
                    <div style="color: ${result.passed ? '#48bb78' : '#f56565'}; font-weight: bold;">
                        ${result.passed ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}: ${result.message}
                    </div>
                `;
                resultsElement.style.display = 'block';
            }
        }
        
        // æ›´æ–°éªŒè¯ç»Ÿè®¡
        function updateVerificationStats() {
            totalVerifications = document.querySelectorAll('.verification-item').length;
            passedVerifications = Object.values(verificationResults).filter(result => result.passed).length;
            failedVerifications = Object.values(verificationResults).filter(result => !result.passed).length;
            pendingVerifications = totalVerifications - Object.keys(verificationResults).length;
            
            document.getElementById('totalVerifications').textContent = totalVerifications;
            document.getElementById('passedVerifications').textContent = passedVerifications;
            document.getElementById('failedVerifications').textContent = failedVerifications;
            document.getElementById('pendingVerifications').textContent = pendingVerifications;
        }
        
        // æ·»åŠ éªŒè¯æ—¥å¿—
        function addVerificationLog(type, message) {
            const container = document.getElementById('verificationLog');
            const timestamp = new Date().toLocaleTimeString('zh-CN');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
        }
        
        // æ¸…ç©ºéªŒè¯æ—¥å¿—
        function clearVerificationLog() {
            document.getElementById('verificationLog').innerHTML = '<div class="log-entry info">éªŒè¯æ—¥å¿—å·²æ¸…ç©º</div>';
        }
    </script>
</body>
</html>


