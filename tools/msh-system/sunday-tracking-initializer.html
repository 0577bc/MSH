<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主日跟踪首次计算工具</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="../../src/smart-config-loader.js"></script>
    <script src="../../src/core/time-utils.js"></script>
    <script src="../../src/new-data-manager.js"></script>
    <script src="../../src/features/sunday-tracking-utils.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f4f7f6; 
            color: #333; 
        }
        .container { 
            max-width: 1200px; 
            margin: auto; 
            background: #fff; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        }
        h1 { 
            color: #2c3e50; 
            text-align: center; 
            margin-bottom: 30px; 
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .button-group { 
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            margin: 30px 0; 
            flex-wrap: wrap; 
        }
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            color: white;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        button.primary { background-color: #3498db; }
        button.primary:hover:not(:disabled) { background-color: #2980b9; transform: translateY(-2px); }
        button.secondary { background-color: #2ecc71; }
        button.secondary:hover:not(:disabled) { background-color: #27ae60; transform: translateY(-2px); }
        button.warning { background-color: #f39c12; }
        button.warning:hover:not(:disabled) { background-color: #e67e22; transform: translateY(-2px); }
        .log-container { 
            background-color: #ecf0f1; 
            border-radius: 5px; 
            padding: 15px; 
            max-height: 600px; 
            overflow-y: auto; 
            border: 1px solid #ddd; 
        }
        .log-item { 
            margin-bottom: 8px; 
            font-size: 14px; 
            line-height: 1.4; 
        }
        .log-item.info { color: #34495e; }
        .log-item.success { color: #27ae60; }
        .log-item.warning { color: #f39c12; }
        .log-item.error { color: #c0392b; font-weight: bold; }
        .progress-container {
            margin: 20px 0;
            display: none;
        }
        .progress-bar {
            width: 100%;
            height: 30px;
            background-color: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress-fill {
            height: 100%;
            background-color: #3498db;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .summary {
            margin-top: 20px;
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>主日跟踪首次计算工具</h1>
        
        <div class="form-group">
            <label for="startDate">开始日期（首个主日）:</label>
            <input type="date" id="startDate" value="2025-08-03">
        </div>
        
        <div class="form-group">
            <label for="endDate">结束日期（最后一个主日）:</label>
            <input type="date" id="endDate">
        </div>
        
        <div class="button-group">
            <button class="primary" id="initializeButton">开始首次计算</button>
            <button class="secondary" id="generateDailyReportsButton">生成DailyReports</button>
            <button class="warning" id="checkStatusButton">检查计算状态</button>
            <button class="danger" id="clearLogButton">清空日志</button>
        </div>
        
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
            </div>
            <div id="progressText" style="text-align: center; margin-top: 10px;"></div>
        </div>
        
        <div class="summary" id="summary"></div>
        <div class="log-container">
            <div id="log"></div>
        </div>
    </div>

    <script>
        const logElement = document.getElementById('log');
        const summaryElement = document.getElementById('summary');
        const progressContainer = document.getElementById('progressContainer');

        function appendLog(message, type = 'info') {
            const logItem = document.createElement('div');
            logItem.className = `log-item ${type}`;
            logItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logElement.appendChild(logItem);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function showDeprecated(action) {
            appendLog(`⚠️ 操作已停用：${action}。请使用缺勤计算工具（absence-calculator.html）处理最新数据。`, 'warning');
            summaryElement.innerHTML = `
                <div>缺勤事件与日报生成已迁移至 <code>absence-calculator.html</code>。</div>
                <div>本工具仅保留历史流程参考，不再执行旧逻辑。</div>
            `;
        }

        if (progressContainer) {
            progressContainer.style.display = 'none';
        }

        appendLog('⚠️ 主日跟踪首次计算工具已废弃，缺勤事件由“缺勤计算工具”统一处理。', 'warning');
        summaryElement.innerHTML = `
            <div>新的缺勤计算流程：<code>absence-calculator.html</code></div>
            <div>旧的实时生成逻辑已移除，本页面仅供历史参考。</div>
        `;

        document.getElementById('clearLogButton').addEventListener('click', () => {
            logElement.innerHTML = '';
            summaryElement.innerHTML = '';
            appendLog('日志已清空。', 'info');
        });

        ['checkStatusButton', 'generateDailyReportsButton', 'initializeButton'].forEach((id) => {
            const button = document.getElementById(id);
            if (!button) {
                return;
            }
            button.disabled = true;
            button.addEventListener('click', () => showDeprecated(button.textContent.trim()));
        });
    </script>
</body>
</html>
