# MSHç³»ç»Ÿå·¥å…·ä½¿ç”¨æŒ‡å—

> **æ›´æ–°æ—¥æœŸ**: 2025-10-11  
> **å·¥å…·æ•°é‡**: ä»33ä¸ªå‡å°‘åˆ°14ä¸ªæ ¸å¿ƒå·¥å…·  
> **æ•´åˆçŠ¶æ€**: âœ… å·²å®Œæˆå·¥å…·æ•´åˆå’Œä¼˜åŒ–  
> **æœ€æ–°æ•´åˆ**: âœ… æ–°å¢å·¥å…·æ•´åˆå®Œæˆ (data-verification + delete-management)  
> **æœ€æ–°ä¿®å¤**: âœ… æ•°æ®å†²çªç®¡ç†å·¥å…·å®Œå…¨ä¿®å¤ (äººå‘˜é€‰æ‹©å™¨ + ç­¾åˆ°è®°å½•æ˜¾ç¤º + FirebaseåŒæ­¥)  
> **æœ€æ–°ä¼˜åŒ–**: âœ… æ•°æ®åˆ é™¤æ“ä½œå®Œæ•´åŒæ­¥æœºåˆ¶ (localStorage + NewDataManager + å…¨å±€äº‹ä»¶ + æ“ä½œæ—¥å¿—)  

## ğŸ¯ å·¥å…·æ•´åˆæ¦‚è¿°

æœ¬æ¬¡å·¥å…·æ•´åˆå°†åŸæœ¬33ä¸ªåˆ†æ•£çš„å·¥å…·æ•´åˆä¸º14ä¸ªæ ¸å¿ƒå·¥å…·ï¼Œå‡å°‘äº†57%çš„å·¥å…·æ•°é‡ï¼Œæå‡äº†ç»´æŠ¤æ•ˆç‡å’Œä½¿ç”¨ä¾¿åˆ©æ€§ã€‚

### ğŸ“Š æ•´åˆç»Ÿè®¡
- **åˆ é™¤å·¥å…·**: 19ä¸ªé‡å¤å’Œå†—ä½™å·¥å…·
- **æ•´åˆå·¥å…·**: åˆ›å»º1ä¸ªç»¼åˆæ€§å·¥å…·
- **ä¿ç•™å·¥å…·**: 14ä¸ªæ ¸å¿ƒåŠŸèƒ½å·¥å…·
- **å‡å°‘ç»´æŠ¤è´Ÿæ‹…**: 57%

## ğŸ”§ æ ¸å¿ƒå·¥å…·åˆ†ç±»

### 1. ç»¼åˆç®¡ç†å·¥å…·
- **data-consistency-manager.html** â­ **æ–°å¢æ•´åˆå·¥å…·**
  - åŠŸèƒ½ï¼šæ•°æ®éªŒè¯ã€å¯¼å…¥ã€Firebaseæµ‹è¯•ã€UUIDç®¡ç†ã€æ•°æ®ä¿®å¤ã€è¯Šæ–­ç›‘æ§
  - ç‰¹ç‚¹ï¼š6ä¸ªæ ‡ç­¾é¡µï¼Œæ•´åˆäº†19ä¸ªåŸæœ‰å·¥å…·çš„åŠŸèƒ½
  - ä½¿ç”¨åœºæ™¯ï¼šæ—¥å¸¸æ•°æ®ç®¡ç†å’Œç»´æŠ¤

### 1.1 æœ€æ–°æ•´åˆå·¥å…· (2025-10-04)
- **data-consistency-validator.html** â­ **æ•°æ®ä¸€è‡´æ€§éªŒè¯å·¥å…·**
  - åŠŸèƒ½ï¼šæ•°æ®éªŒè¯ + æ•°æ®æºå¯¹æ¯”
  - ç‰¹ç‚¹ï¼š2ä¸ªæ ‡ç­¾é¡µï¼Œæ•´åˆäº†data-verification.htmlåŠŸèƒ½
  - æ–°å¢ï¼šä¸‰æºæ•°æ®æ ¸å¯¹ï¼ˆFirebase + MSH + å¤–éƒ¨è¡¨å•ï¼‰

- **member-distribution-checker.html** â­ **æˆå‘˜åˆ†å¸ƒæ£€æŸ¥å·¥å…·** (å·²ä¼˜åŒ–)
  - åŠŸèƒ½ï¼šæˆå‘˜åˆ†å¸ƒåˆ†æ + æ‰¹é‡å¯¼å…¥ + æ•°æ®åŒæ­¥æ§åˆ¶
  - ç‰¹ç‚¹ï¼šæ”¯æŒUUID/å§“ååŒé‡åŒ¹é…ï¼Œå†å²å°ç»„åç§°è¿‡æ»¤
  - ä¿®å¤ï¼šæœªåˆ†ç»„æˆå‘˜æ£€æµ‹é€»è¾‘ï¼Œä¿®å¤ç‡77.8%
  - æ–°å¢ï¼šè¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼Œå°ç»„åç§°æ˜ å°„éªŒè¯
  - ä½¿ç”¨åœºæ™¯ï¼šæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å’ŒéªŒè¯

- **data-conflict-manager.html** â­ **æ•°æ®å†²çªç®¡ç†å·¥å…·** âœ… **å·²å®Œå…¨ä¿®å¤ + åŒæ­¥ä¼˜åŒ–**
  - åŠŸèƒ½ï¼šå†²çªç®¡ç† + åˆ é™¤ç®¡ç† + å®Œæ•´æ•°æ®åŒæ­¥
  - ç‰¹ç‚¹ï¼š2ä¸ªæ ‡ç­¾é¡µï¼Œæ•´åˆäº†delete-management.htmlåŠŸèƒ½
  - åˆ é™¤åŠŸèƒ½ï¼šåˆ é™¤äººå‘˜ã€ç­¾åˆ°è®°å½•ã€å°ç»„ã€æ‰¹é‡æ¸…ç†
  - ä¿®å¤å†å²ï¼šäººå‘˜é€‰æ‹©å™¨ã€ç­¾åˆ°è®°å½•æ˜¾ç¤ºã€FirebaseåŒæ­¥é—®é¢˜
  - **åŒæ­¥æœºåˆ¶** (2025-10-11ä¼˜åŒ–):
    * âœ… Firebase å®æ—¶æ›´æ–°
    * âœ… localStorage è‡ªåŠ¨åŒæ­¥
    * âœ… å…¨å±€å˜é‡åŒæ­¥ (window.groups/attendanceRecords)
    * âœ… NewDataManager æ•°æ®ç®¡ç†å™¨åŒæ­¥
    * âœ… å…¨å±€äº‹ä»¶é€šçŸ¥ (dataUpdatedäº‹ä»¶)
    * âœ… æ“ä½œæ—¥å¿—è®°å½• (operationLogs/)
  - ä½¿ç”¨åœºæ™¯ï¼šæ•°æ®å†²çªè§£å†³å’Œæ•°æ®åˆ é™¤ç®¡ç†
  - ğŸ“– è¯¦ç»†è¯´æ˜ï¼šè§ä¸‹æ–¹"æ•°æ®å†²çªç®¡ç†å·¥å…·è¯¦ç»†è¯´æ˜"

### 2. ä¸“ä¸šè¯Šæ–­å·¥å…·
- **diagnose-sunday-tracking.html**
  - åŠŸèƒ½ï¼šä¸»æ—¥è·Ÿè¸ªç³»ç»Ÿè¯Šæ–­
  - ç‰¹ç‚¹ï¼šä¸“é—¨è¯Šæ–­ä¸»æ—¥è·Ÿè¸ªç›¸å…³é—®é¢˜
- **emergency-data-check.html**
  - åŠŸèƒ½ï¼šç´§æ€¥æ•°æ®æ£€æŸ¥
  - ç‰¹ç‚¹ï¼šå¿«é€Ÿæ£€æŸ¥æ•°æ®å¼‚å¸¸
- **emergency-data-recovery.html**
  - åŠŸèƒ½ï¼šç´§æ€¥æ•°æ®æ¢å¤
  - ç‰¹ç‚¹ï¼šæ•°æ®ä¸¢å¤±æ—¶çš„æ¢å¤å·¥å…·

### 3. äº‹ä»¶ç®¡ç†å·¥å…·
- **event-generation-test.html**
  - åŠŸèƒ½ï¼šäº‹ä»¶ç”Ÿæˆæµ‹è¯•
  - ç‰¹ç‚¹ï¼šæµ‹è¯•ä¸»æ—¥è·Ÿè¸ªäº‹ä»¶ç”Ÿæˆé€»è¾‘
- **trigger-event-generation.html**
  - åŠŸèƒ½ï¼šè§¦å‘äº‹ä»¶ç”Ÿæˆ
  - ç‰¹ç‚¹ï¼šæ‰‹åŠ¨è§¦å‘äº‹ä»¶ç”Ÿæˆè¿‡ç¨‹

### 4. æ•°æ®ç®¡ç†å·¥å…·
- **data-conflict-manager.html**
  - åŠŸèƒ½ï¼šæ•°æ®å†²çªç®¡ç†
  - ç‰¹ç‚¹ï¼šè§£å†³æ•°æ®åŒæ­¥å†²çª
- **group-key-standardizer.html**
  - åŠŸèƒ½ï¼šç»„åˆ«é”®æ ‡å‡†åŒ–
  - ç‰¹ç‚¹ï¼šç»Ÿä¸€ç»„åˆ«æ ‡è¯†ç¬¦æ ¼å¼

### 5. æˆå‘˜ç®¡ç†å·¥å…·
- **uuid_editor.html**
  - åŠŸèƒ½ï¼šUUIDç¼–è¾‘å™¨
  - ç‰¹ç‚¹ï¼šç¼–è¾‘å’Œç®¡ç†æˆå‘˜UUID
- **member-distribution-checker.html**
  - åŠŸèƒ½ï¼šæˆå‘˜åˆ†å¸ƒæ£€æŸ¥
  - ç‰¹ç‚¹ï¼šæ£€æŸ¥æˆå‘˜åœ¨å„å°ç»„çš„åˆ†å¸ƒæƒ…å†µ
- **member-extractor.html**
  - åŠŸèƒ½ï¼šæˆå‘˜æå–
  - ç‰¹ç‚¹ï¼šä»æ•°æ®ä¸­æå–æˆå‘˜ä¿¡æ¯

### 6. è¾…åŠ©å·¥å…·
- **msh-data-sync-helper.js**
  - åŠŸèƒ½ï¼šæ•°æ®åŒæ­¥è¾…åŠ©è„šæœ¬
  - ç‰¹ç‚¹ï¼šJavaScriptåº“ï¼Œæ”¯æŒå…¶ä»–å·¥å…·
- **protect_documents.sh**
  - åŠŸèƒ½ï¼šæ–‡æ¡£ä¿æŠ¤è„šæœ¬
  - ç‰¹ç‚¹ï¼šShellè„šæœ¬ï¼Œä¿æŠ¤é‡è¦æ–‡æ¡£
- **IMPORT-GUIDE.md**
  - åŠŸèƒ½ï¼šå¯¼å…¥æŒ‡å—æ–‡æ¡£
  - ç‰¹ç‚¹ï¼šæ•°æ®å¯¼å…¥æ“ä½œæŒ‡å—

## ğŸ“‹ å·¥å…·ä½¿ç”¨å»ºè®®

### ğŸ¯ æ—¥å¸¸ç»´æŠ¤æ¨èæµç¨‹
1. **æ•°æ®ä¸€è‡´æ€§ç®¡ç†å™¨** - å®šæœŸæ£€æŸ¥å’Œç»´æŠ¤æ•°æ®
2. **UUIDç¼–è¾‘å™¨** - ç®¡ç†æˆå‘˜UUID
3. **ä¸»æ—¥è·Ÿè¸ªè¯Šæ–­** - æ£€æŸ¥è·Ÿè¸ªç³»ç»ŸçŠ¶æ€

### ğŸš¨ é—®é¢˜æ’æŸ¥æµç¨‹
1. **ç´§æ€¥æ•°æ®æ£€æŸ¥** - å¿«é€Ÿå‘ç°é—®é¢˜
2. **ç³»ç»Ÿè¯Šæ–­å·¥å…·** - æ·±å…¥åˆ†æé—®é¢˜
3. **ç´§æ€¥æ•°æ®æ¢å¤** - å¿…è¦æ—¶æ¢å¤æ•°æ®

### ğŸ”§ å¼€å‘è°ƒè¯•æµç¨‹
1. **äº‹ä»¶ç”Ÿæˆæµ‹è¯•** - æµ‹è¯•æ–°åŠŸèƒ½
2. **æ•°æ®å†²çªç®¡ç†** - è§£å†³åŒæ­¥é—®é¢˜
3. **æˆå‘˜åˆ†å¸ƒæ£€æŸ¥** - éªŒè¯æ•°æ®å®Œæ•´æ€§

## ğŸ—‘ï¸ å·²åˆ é™¤çš„é‡å¤å·¥å…·

### æ•°æ®ä¸€è‡´æ€§éªŒè¯ç±» (2â†’1)
- âŒ attendance-data-consistency.html
- âŒ data-consistency-checker.html
- âœ… æ•´åˆåˆ° data-consistency-manager.html

### æ•°æ®å¯¼å…¥ç±» (7â†’1)
- âŒ import-attendance-data.html
- âŒ import-attendance-simple.html
- âŒ simple-import.html
- âŒ simple-import-with-sync.html
- âŒ direct-import.html
- âŒ console-import.js
- âŒ quick-import-attendance.js
- âœ… æ•´åˆåˆ° data-consistency-manager.html

### Firebaseæµ‹è¯•ç±» (2â†’1)
- âŒ firebase-connection-test.html
- âŒ firebase-test.html
- âœ… æ•´åˆåˆ° data-consistency-manager.html

### UUIDç®¡ç†ç±» (4â†’1)
- âŒ export_missing_uuids.html
- âŒ enhanced-uuid-upgrade.html
- âŒ simple-uuid-upgrade.html
- âŒ upgrade-excluded-members-uuid.html
- âœ… æ•´åˆåˆ° data-consistency-manager.html

### æ•°æ®ä¿®å¤ç±» (4â†’1)
- âŒ batch_signin_fix.html
- âŒ fix-attendance-date.html
- âŒ timeslot-fixer.html
- âŒ duplicate-records-cleaner.html
- âœ… æ•´åˆåˆ° data-consistency-manager.html

### æˆå‘˜ç®¡ç†ç±» (3â†’0)
- âŒ debug-excluded-members.html
- âŒ simple-debug-excluded.html
- âŒ fix-excluded-members-groups.html
- âœ… åŠŸèƒ½æ•´åˆåˆ°å…¶ä»–å·¥å…·ä¸­

## ğŸ‰ æ•´åˆæ•ˆæœ

### âœ… ä¼˜åŠ¿
1. **ç»´æŠ¤æ•ˆç‡æå‡**: å·¥å…·æ•°é‡å‡å°‘57%ï¼Œç»´æŠ¤è´Ÿæ‹…å¤§å¹…é™ä½
2. **åŠŸèƒ½æ•´åˆ**: ç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨ä¸€ä¸ªå·¥å…·ä¸­ï¼Œä½¿ç”¨æ›´æ–¹ä¾¿
3. **ç•Œé¢ç»Ÿä¸€**: ç°ä»£åŒ–çš„ç•Œé¢è®¾è®¡ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½
4. **ä»£ç å¤ç”¨**: å‡å°‘é‡å¤ä»£ç ï¼Œæå‡å¼€å‘æ•ˆç‡

### ğŸ“ˆ æ€§èƒ½æå‡
- **å·¥å…·åŠ è½½é€Ÿåº¦**: å‡å°‘é‡å¤ä¾èµ–ï¼ŒåŠ è½½æ›´å¿«
- **å†…å­˜ä½¿ç”¨**: å‡å°‘å†—ä½™å·¥å…·ï¼Œå†…å­˜å ç”¨æ›´å°‘
- **å¼€å‘æ•ˆç‡**: é›†ä¸­ç®¡ç†ï¼Œå¼€å‘è°ƒè¯•æ›´æ–¹ä¾¿

### ğŸ”§ æŠ€æœ¯æ”¹è¿›
- **æ¨¡å—åŒ–è®¾è®¡**: æ ‡ç­¾é¡µå¼ç•Œé¢ï¼ŒåŠŸèƒ½æ¸…æ™°åˆ†ç¦»
- **ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ**: æ‰€æœ‰æ“ä½œéƒ½æœ‰è¯¦ç»†çš„æ—¥å¿—è®°å½•
- **è¿›åº¦æŒ‡ç¤º**: é•¿æ—¶é—´æ“ä½œæœ‰è¿›åº¦æ¡æ˜¾ç¤º
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

## ğŸ“š ä½¿ç”¨æŒ‡å—

### æ•°æ®ä¸€è‡´æ€§ç®¡ç†å™¨ä½¿ç”¨æ­¥éª¤
1. æ‰“å¼€ `data-consistency-manager.html`
2. é€‰æ‹©ç›¸åº”çš„åŠŸèƒ½æ ‡ç­¾é¡µ
3. æŒ‰ç…§ç•Œé¢æç¤ºè¿›è¡Œæ“ä½œ
4. æŸ¥çœ‹æ—¥å¿—äº†è§£æ“ä½œç»“æœ

### å·¥å…·é€‰æ‹©å»ºè®®
- **æ—¥å¸¸ç»´æŠ¤**: ä½¿ç”¨æ•°æ®ä¸€è‡´æ€§ç®¡ç†å™¨
- **æ•°æ®éªŒè¯**: ä½¿ç”¨æ•°æ®ä¸€è‡´æ€§éªŒè¯å·¥å…·
- **å†²çªè§£å†³**: ä½¿ç”¨æ•°æ®å†²çªç®¡ç†å·¥å…·
- **ç´§æ€¥æƒ…å†µ**: ä½¿ç”¨ç´§æ€¥æ£€æŸ¥å’Œæ¢å¤å·¥å…·
- **å¼€å‘è°ƒè¯•**: ä½¿ç”¨ä¸“ä¸šè¯Šæ–­å·¥å…·
- **æˆå‘˜ç®¡ç†**: ä½¿ç”¨UUIDç¼–è¾‘å™¨å’Œæˆå‘˜ç®¡ç†å·¥å…·

## ğŸ”„ æœªæ¥è§„åˆ’

1. **åŠŸèƒ½å¢å¼º**: æ ¹æ®ä½¿ç”¨åé¦ˆç»§ç»­ä¼˜åŒ–å·¥å…·åŠŸèƒ½
2. **ç•Œé¢æ”¹è¿›**: æŒç»­æ”¹è¿›ç”¨æˆ·ç•Œé¢å’Œä½“éªŒ
3. **è‡ªåŠ¨åŒ–**: å¢åŠ æ›´å¤šè‡ªåŠ¨åŒ–åŠŸèƒ½ï¼Œå‡å°‘æ‰‹åŠ¨æ“ä½œ
4. **é›†æˆ**: è€ƒè™‘ä¸å…¶ä»–ç³»ç»Ÿå·¥å…·çš„é›†æˆ

---

## ğŸ“˜ æ•°æ®å†²çªç®¡ç†å·¥å…·è¯¦ç»†è¯´æ˜

### ğŸ¯ æ¦‚è¿°

`data-conflict-manager.html` æ˜¯MSHç³»ç»Ÿçš„æ ¸å¿ƒæ•°æ®ç®¡ç†å·¥å…·ï¼Œæä¾›æ•°æ®å†²çªè§£å†³å’Œåˆ é™¤ç®¡ç†åŠŸèƒ½ï¼Œå¹¶å…·å¤‡å®Œæ•´çš„æ•°æ®åŒæ­¥æœºåˆ¶ã€‚

### ğŸ”„ å®Œæ•´åŒæ­¥æœºåˆ¶ (2025-10-11ä¼˜åŒ–)

æ¯ä¸ªåˆ é™¤æ“ä½œéƒ½ä¼šæ‰§è¡Œä»¥ä¸‹å®Œæ•´åŒæ­¥æµç¨‹ï¼š

```
ç”¨æˆ·æ‰§è¡Œåˆ é™¤æ“ä½œ
    â†“
ğŸ”’ å¤šé‡ç¡®è®¤ï¼ˆ2-3æ¬¡ï¼Œé˜²æ­¢è¯¯æ“ä½œï¼‰
    â†“
ğŸ”„ æ›´æ–° Firebaseï¼ˆä¸»æ•°æ®æºï¼‰
    â†“
âœ… æ›´æ–° localStorageï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰
    â”œâ”€ msh_groups
    â”œâ”€ msh_groupNames  
    â””â”€ msh_attendanceRecords
    â†“
âœ… æ›´æ–°å…¨å±€å˜é‡ï¼ˆå†…å­˜æ•°æ®ï¼‰
    â”œâ”€ window.groups
    â”œâ”€ window.groupNames
    â””â”€ window.attendanceRecords
    â†“
âœ… é€šçŸ¥ NewDataManagerï¼ˆæ•°æ®ç®¡ç†å™¨ï¼‰
    â”œâ”€ æ›´æ–°å†…å­˜æ•°æ®
    â”œâ”€ ä¿å­˜åˆ° localStorage
    â””â”€ æ ‡è®°æ•°æ®å˜æ›´
    â†“
âœ… è§¦å‘å…¨å±€äº‹ä»¶ï¼ˆè·¨é¡µé¢é€šçŸ¥ï¼‰
    â””â”€ window.dispatchEvent('dataUpdated')
    â†“
ğŸ“ è®°å½•æ“ä½œæ—¥å¿—åˆ° Firebase
    â””â”€ operationLogs/{pushId}
```

### ğŸ¯ åˆ é™¤æ“ä½œè¯´æ˜

#### 1. åˆ é™¤äººå‘˜
- **åŒæ­¥æ•°æ®**: `groups/{groupKey}`, `attendanceRecords`, localStorage
- **äº‹ä»¶ç±»å‹**: `member_deleted`
- **æ“ä½œæ—¥å¿—**: åŒ…å«å°ç»„ã€äººå‘˜åã€åˆ é™¤è®°å½•æ•°

#### 2. åˆ é™¤å°ç»„  
- **åŒæ­¥æ•°æ®**: `groups/{groupKey}`, `groupNames/{groupKey}`, `attendanceRecords`, localStorage
- **äº‹ä»¶ç±»å‹**: `group_deleted`
- **æ“ä½œæ—¥å¿—**: åŒ…å«å°ç»„åã€æˆå‘˜æ•°ã€åˆ é™¤è®°å½•æ•°

#### 3. åˆ é™¤ç­¾åˆ°è®°å½•
- **åŒæ­¥æ•°æ®**: `attendanceRecords`ï¼ˆå¢é‡åˆ é™¤ï¼‰, localStorage
- **å®‰å…¨æœºåˆ¶**: å¹¶å‘æ£€æŸ¥ + æ•°æ®å¤‡ä»½
- **äº‹ä»¶ç±»å‹**: `attendance_records_deleted`
- **æ“ä½œæ—¥å¿—**: åŒ…å«åˆ é™¤è®°å½•ç´¢å¼•å’Œè¯¦æƒ…

#### 4. æ‰¹é‡æ¸…ç†
- **åŒæ­¥æ•°æ®**: `attendanceRecords`ï¼ˆæŒ‰æ—¥æœŸèŒƒå›´åˆ é™¤ï¼‰, localStorage
- **ç‰¹æ®Šå¤„ç†**: ä»Firebaseé‡æ–°è¯»å–æœ€æ–°æ•°æ®
- **äº‹ä»¶ç±»å‹**: `batch_cleanup`
- **æ“ä½œæ—¥å¿—**: åŒ…å«æ¸…ç†ç±»å‹ã€å¤©æ•°ã€åˆ é™¤æ•°

### ğŸ”— è·¨é¡µé¢æ•°æ®åŒæ­¥

#### ç›‘å¬æ•°æ®æ›´æ–°äº‹ä»¶

å…¶ä»–ä¸šåŠ¡é¡µé¢å¯ä»¥ç›‘å¬ `dataUpdated` äº‹ä»¶æ¥å®æ—¶è·å–æ•°æ®å˜æ›´ï¼š

```javascript
// åœ¨é¡µé¢åˆå§‹åŒ–æ—¶æ·»åŠ 
window.addEventListener('dataUpdated', async function(event) {
    console.log('ğŸ“¡ æ£€æµ‹åˆ°æ•°æ®æ›´æ–°:', event.detail);
    
    const { type, source } = event.detail;
    
    // å¿½ç•¥è‡ªå·±è§¦å‘çš„äº‹ä»¶
    if (source === 'self') return;
    
    // æ ¹æ®æ›´æ–°ç±»å‹å¤„ç†
    switch (type) {
        case 'member_deleted':
            await reloadMembers();
            break;
        case 'group_deleted':
            await reloadGroups();
            break;
        case 'batch_cleanup':
            await reloadRecords();
            break;
    }
    
    // åˆ·æ–°é¡µé¢æ˜¾ç¤º
    if (typeof refreshPage === 'function') {
        refreshPage();
    }
});
```

#### äº‹ä»¶æ•°æ®æ ¼å¼

```javascript
// åˆ é™¤äººå‘˜äº‹ä»¶
{
    type: 'member_deleted',
    groupKey: 'group0',
    groupName: 'å°ç»„åç§°',
    memberName: 'å¼ ä¸‰',
    recordsDeleted: 10,
    timestamp: 1696838400000,
    source: 'data-conflict-manager'
}

// åˆ é™¤å°ç»„äº‹ä»¶
{
    type: 'group_deleted',
    groupKey: 'group0',
    groupName: 'å°ç»„åç§°',
    memberCount: 20,
    recordsDeleted: 150,
    timestamp: 1696838400000,
    source: 'data-conflict-manager'
}

// æ‰¹é‡æ¸…ç†äº‹ä»¶
{
    type: 'batch_cleanup',
    cleanupType: 'attendance',
    recordsDeleted: 500,
    cutoffDate: '2025-01-01',
    cutoffDays: 90,
    timestamp: 1696838400000,
    source: 'data-conflict-manager'
}
```

### ğŸ“ æ“ä½œæ—¥å¿—

#### æ—¥å¿—ä½ç½®
Firebase: `operationLogs/{pushId}/`

#### æ—¥å¿—ç»“æ„
```javascript
{
    timestamp: "2025-10-11T10:30:00.000Z",
    timestampMs: 1696838400000,
    operation: "delete_member",
    details: {
        groupKey: "group0",
        memberName: "å¼ ä¸‰",
        recordsDeleted: 10,
        success: true
    },
    userAgent: "Mozilla/5.0...",
    page: "data-conflict-manager"
}
```

#### æŸ¥çœ‹æ—¥å¿—
1. æ‰“å¼€ Firebase Console
2. è¿›å…¥ Realtime Database
3. å¯¼èˆªåˆ° `operationLogs/`
4. æŸ¥çœ‹æœ€è¿‘çš„æ“ä½œè®°å½•

### ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶

#### æ•°æ®å®‰å…¨
- âœ… å¤šé‡ç¡®è®¤æœºåˆ¶ï¼ˆ2-3æ¬¡ç¡®è®¤ï¼‰
- âœ… å¢é‡æ“ä½œä¼˜å…ˆï¼ˆupdate() è€Œé set()ï¼‰
- âœ… å¹¶å‘å†²çªæ£€æŸ¥ï¼ˆåˆ é™¤ç­¾åˆ°è®°å½•æ—¶ï¼‰
- âœ… è‡ªåŠ¨æ•°æ®å¤‡ä»½ï¼ˆbackups/ï¼‰
- âœ… å®Œæ•´é”™è¯¯å¤„ç†

#### æ“ä½œå®¡è®¡
- âœ… æ‰€æœ‰æ“ä½œè®°å½•åˆ°Firebase
- âœ… åŒ…å«æ“ä½œæ—¶é—´ã€ç±»å‹ã€è¯¦æƒ…
- âœ… æˆåŠŸ/å¤±è´¥çŠ¶æ€è®°å½•
- âœ… å¯è¿½æº¯æ“ä½œå†å²

### ğŸš¨ æ•…éšœæ’æŸ¥

#### é—®é¢˜ï¼šåˆ é™¤åå…¶ä»–é¡µé¢ä»æ˜¾ç¤ºæ—§æ•°æ®

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åˆ·æ–°è¯¥é¡µé¢ï¼ˆä¼šä»localStorageè¯»å–æœ€æ–°æ•°æ®ï¼‰
2. åœ¨è¯¥é¡µé¢æ·»åŠ `dataUpdated`äº‹ä»¶ç›‘å¬
3. æ¸…ç©ºlocalStorageå¼ºåˆ¶ä»Firebaseé‡æ–°åŠ è½½

#### é—®é¢˜ï¼šNewDataManageræœªåŒæ­¥

**æ£€æŸ¥æ–¹æ³•**ï¼š
```javascript
console.log('NewDataManager:', window.newDataManager);
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿é¡µé¢å·²åŠ è½½ `new-data-manager.js`
2. æ£€æŸ¥NewDataManageræ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
3. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

#### é—®é¢˜ï¼šæ“ä½œæ—¥å¿—æœªè®°å½•

**æ£€æŸ¥æ–¹æ³•**ï¼š
```javascript
console.log('Firebase DB:', window.db);
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥Firebaseè¿æ¥çŠ¶æ€
2. éªŒè¯Firebaseå®‰å…¨è§„åˆ™
3. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### ğŸ“Š åŒæ­¥æ•ˆæœå¯¹æ¯”

| æ“ä½œ | Firebase | localStorage | å…¨å±€å˜é‡ | NewDataManager | äº‹ä»¶é€šçŸ¥ | æ“ä½œæ—¥å¿— | æ€»åˆ† |
|------|----------|--------------|---------|---------------|---------|---------|------|
| åˆ é™¤ç­¾åˆ°è®°å½• | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | 100% âœ… |
| åˆ é™¤äººå‘˜ | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | 100% âœ… |
| åˆ é™¤å°ç»„ | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | 100% âœ… |
| æ‰¹é‡æ¸…ç† | âœ… | âœ… | âœ… | âœ… | âœ… | âœ… | 100% âœ… |

### ğŸ’¡ ä½¿ç”¨å»ºè®®

#### å¯¹ç®¡ç†å‘˜
1. **åˆ é™¤å‰**ï¼šç¡®ä¿å·²å¤‡ä»½é‡è¦æ•°æ®
2. **åˆ é™¤æ—¶**ï¼šä»”ç»†é˜…è¯»æ‰€æœ‰ç¡®è®¤å¯¹è¯æ¡†
3. **åˆ é™¤å**ï¼šæ£€æŸ¥æˆåŠŸæç¤ºä¸­çš„åŒæ­¥çŠ¶æ€

#### å¯¹å¼€å‘è€…
1. **ç›‘å¬äº‹ä»¶**ï¼šåœ¨ä¸šåŠ¡é¡µé¢æ·»åŠ `dataUpdated`äº‹ä»¶ç›‘å¬
2. **æŸ¥çœ‹æ—¥å¿—**ï¼šå®šæœŸæ£€æŸ¥`operationLogs`äº†è§£ç³»ç»Ÿä½¿ç”¨æƒ…å†µ
3. **æ•°æ®æ¢å¤**ï¼šè¯¯åˆ æ•°æ®å¯ä»`backups/`èŠ‚ç‚¹æ¢å¤

---

**ç»´æŠ¤è€…**: MSHç³»ç»Ÿå¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-10-11  
**ç‰ˆæœ¬**: 2.1 (æ•´åˆç‰ˆ + åŒæ­¥ä¼˜åŒ–)


