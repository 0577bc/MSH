#!/bin/bash

# å¤–éƒ¨è®°å¿†ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬
# ç‰ˆæœ¬ï¼šv1.7
# ç”¨é€”ï¼šè‡ªåŠ¨åˆå§‹åŒ–è®°å¿†ç³»ç»Ÿ

echo "ðŸš€ åˆå§‹åŒ–å¤–éƒ¨è®°å¿†ç³»ç»Ÿ v1.7..."

# èŽ·å–ç”¨æˆ·è¾“å…¥
echo "ðŸ“ è¯·è¾“å…¥é¡¹ç›®åç§°ï¼š"
read project_name
echo "ðŸŽ¯ è¯·è¾“å…¥é¡¹ç›®ç›®æ ‡ï¼š"
read project_goal

# åˆ›å»ºæ–‡ä»¶ç»“æž„
echo "ðŸ“ åˆ›å»ºæ–‡ä»¶ç»“æž„..."
touch progress.md archive.md cloud.md memory.json memory.log.md

# åˆå§‹åŒ–Gitä»“åº“
echo "ðŸ“ åˆå§‹åŒ–Gitä»“åº“..."
git init
git add .
git commit -m "åˆå§‹åŒ–å¤–éƒ¨è®°å¿†ç³»ç»Ÿ v1.7"

# é…ç½®git-cryptåŠ å¯†
echo "ðŸ”’ é…ç½®git-cryptåŠ å¯†..."
if command -v git-crypt &> /dev/null; then
    git-crypt init
    echo "è¯·æ·»åŠ GPGç”¨æˆ·ï¼ˆå¯é€‰ï¼Œç›´æŽ¥å›žè½¦è·³è¿‡ï¼‰ï¼š"
    read gpg_user
    if [ ! -z "$gpg_user" ]; then
        git-crypt add-gpg-user $gpg_user
        echo "âœ… git-crypté…ç½®å®Œæˆ"
    else
        echo "âš ï¸ è·³è¿‡git-crypté…ç½®ï¼Œå»ºè®®åŽç»­æ‰‹åŠ¨é…ç½®"
    fi
else
    echo "âš ï¸ git-cryptæœªå®‰è£…ï¼Œå»ºè®®å®‰è£…åŽæ‰‹åŠ¨é…ç½®ï¼š"
    echo "   brew install git-crypt"
    echo "   git-crypt init"
fi

# è®¾ç½®æ–‡ä»¶æƒé™
echo "ðŸ”§ è®¾ç½®æ–‡ä»¶æƒé™..."
chmod +x setup.sh

# åˆ›å»ºåŸºç¡€å†…å®¹
echo "ðŸ“ åˆ›å»ºåŸºç¡€å†…å®¹..."
cat > progress.md << EOF
# é¡¹ç›®è¿›åº¦è®°å½•

> æœ€åŽæ›´æ–°ï¼š$(date +"%Y-%m-%d")
> é¡¹ç›®ï¼š$project_name

## ðŸŽ¯ å½“å‰çŠ¶æ€

**é¡¹ç›®ç›®æ ‡**ï¼š$project_goal

## ðŸ“‹ å¾…åŠžäº‹é¡¹

- [TODO] [HIGH] å®Œæˆæ ¸å¿ƒåŠŸèƒ½å¼€å‘
- [TODO] [MEDIUM] ç¼–å†™ä½¿ç”¨æ–‡æ¡£
- [TODO] [LOW] æ€§èƒ½ä¼˜åŒ–

## âœ… å·²å®Œæˆ

- [DONE] é¡¹ç›®æž¶æž„è®¾è®¡
- [DONE] åŸºç¡€åŠŸèƒ½å®žçŽ°

## ðŸŽ¯ é‡è¦å†³ç­–

- [DECISION] [HIGH] é€‰æ‹©æŠ€æœ¯æ ˆ
- [DECISION] [MEDIUM] ç¡®å®šé¡¹ç›®æž¶æž„

## âš ï¸ é£Žé™©ä¸Žçº¦æŸ

- [RISK] [HIGH] æŠ€æœ¯é£Žé™©
- [CONSTRAINT] [HIGH] æ—¶é—´çº¦æŸ

## ðŸ“š å­¦åˆ°çš„çŸ¥è¯†

- [LEARNED] æŠ€æœ¯é€‰åž‹ç»éªŒ
- [LEARNED] é¡¹ç›®ç®¡ç†ç»éªŒ

## ðŸ’¡ æ–°æƒ³æ³•

- [IDEA] åŠŸèƒ½ä¼˜åŒ–æƒ³æ³•
- [IDEA] æŠ€æœ¯æ”¹è¿›æƒ³æ³•

## ðŸ’» ä»£ç ç‰‡æ®µ

- [CODE] [HIGH] æ ¸å¿ƒç®—æ³•å®žçŽ°
- [CODE] [MEDIUM] å·¥å…·å‡½æ•°å°è£…

## ðŸ” å¿«é€Ÿæœç´¢

**å…³é”®è¯**ï¼šTODO, DONE, DECISION, RISK, CONSTRAINT, LEARNED, IDEA, CODE
**ä¼˜å…ˆçº§**ï¼šHIGH, MEDIUM, LOW

## ðŸ“Š ç”¨æˆ·åå¥½å­¦ä¹ 

### çŸ­æœŸåå¥½ï¼ˆæœ€è¿‘10æ¬¡ï¼‰
- **æ ‡è®°ç±»åž‹**ï¼š[TODO: 60%, DECISION: 25%, RISK: 15%]
- **ä¼˜å…ˆçº§ä¹ æƒ¯**ï¼š[HIGH: 30%, MEDIUM: 50%, LOW: 20%]
- **è§¦å‘å…³é”®è¯**ï¼š["å†³å®š", "é£Žé™©", "TODO", "å®Œæˆ"]
- **ä½¿ç”¨æ¨¡å¼**ï¼šå·¥ä½œæ—¥é›†ä¸­ï¼Œå‘¨æœ«åˆ†æ•£

### é•¿æœŸåå¥½ï¼ˆæ•´ä½“ç»Ÿè®¡ï¼‰
- **æ ‡è®°ç±»åž‹**ï¼š[TODO: 50%, DECISION: 20%, RISK: 15%, CODE: 15%]
- **ä¼˜å…ˆçº§ä¹ æƒ¯**ï¼š[HIGH: 25%, MEDIUM: 60%, LOW: 15%]
- **è§¦å‘å…³é”®è¯**ï¼š["å†³å®š", "é£Žé™©", "TODO", "å®Œæˆ", "ä»£ç "]
- **å½’æ¡£é¢‘çŽ‡**ï¼šæ¯å‘¨ä¸€æ¬¡
- **å·¥ä½œæ¨¡å¼**ï¼šä¸Šåˆå†³ç­–ï¼Œä¸‹åˆç¼–ç ï¼Œæ™šä¸Šæ€»ç»“

### æ™ºèƒ½å»ºè®®
- **æ ‡è®°æŽ¨è**ï¼šåŸºäºŽåŽ†å²ä½¿ç”¨é¢‘çŽ‡æŽ¨èæ ‡è®°ç±»åž‹
- **ä¼˜å…ˆçº§å»ºè®®**ï¼šæ ¹æ®å†…å®¹é‡è¦æ€§è‡ªåŠ¨å»ºè®®ä¼˜å…ˆçº§
- **è§¦å‘ä¼˜åŒ–**ï¼šå­¦ä¹ ç”¨æˆ·å¸¸ç”¨å…³é”®è¯ï¼Œæé«˜è§¦å‘å‡†ç¡®æ€§
- **å½’æ¡£æé†’**ï¼šæ ¹æ®ç”¨æˆ·ä¹ æƒ¯æ™ºèƒ½æé†’å½’æ¡£æ—¶æœº

## ðŸ“¢ é€šçŸ¥åŽ†å²ï¼ˆæœ€è¿‘50æ¡ï¼‰

- [$(date +"%Y-%m-%d")] ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
EOF

cat > archive.md << EOF
# åŽ†å²å½’æ¡£æ–‡ä»¶

> å½’æ¡£æ—¥æœŸï¼š$(date +"%Y-%m-%d")

## ðŸ“š å·²å½’æ¡£å†…å®¹

### å·²å®Œæˆäº‹é¡¹
- [DONE] é¡¹ç›®åˆå§‹åŒ–

### å·²å½’æ¡£å†³ç­–
- [DECISION] é€‰æ‹©å¤–éƒ¨è®°å¿†ç³»ç»Ÿæ–¹æ¡ˆ

### å·²è§£å†³é£Žé™©
- [RISK] ç³»ç»Ÿå¤æ‚åº¦ â†’ é€šè¿‡ç®€åŒ–è®¾è®¡è§£å†³

## ðŸ“Š å½’æ¡£ç»Ÿè®¡

- **æ€»å½’æ¡£æ¡ç›®**ï¼š3
- **å½’æ¡£æ—¥æœŸ**ï¼š$(date +"%Y-%m-%d")
- **å½’æ¡£åŽŸå› **ï¼šç³»ç»Ÿåˆå§‹åŒ–
- **å½’æ¡£æ€»ç»“**ï¼šå·²å½’æ¡£3ä¸ªDONEï¼šé¡¹ç›®åˆå§‹åŒ–ç­‰

## ðŸ“ˆ åŽ‹ç¼©æ€»ç»“

### æ—¥æ€»ç»“ï¼ˆ$(date +"%Y-%m-%d")ï¼‰
- **å®Œæˆé¡¹ç›®**ï¼š3ä¸ªDONEï¼ŒåŒ…æ‹¬é¡¹ç›®åˆå§‹åŒ–
- **é‡è¦å†³ç­–**ï¼š1ä¸ªDECISIONï¼Œé€‰æ‹©å¤–éƒ¨è®°å¿†ç³»ç»Ÿæ–¹æ¡ˆ
- **è§£å†³é£Žé™©**ï¼š1ä¸ªRISKï¼Œç³»ç»Ÿå¤æ‚åº¦é€šè¿‡ç®€åŒ–è®¾è®¡è§£å†³
EOF

# åˆ›å»º.gitignoreæ–‡ä»¶
echo "ðŸ“ åˆ›å»º.gitignoreæ–‡ä»¶..."
cat > .gitignore << EOF
# æ•æ„Ÿæ–‡ä»¶
*.key
*.pem
*.p12
*.pfx
.env
.env.local
.env.production

# ä¸´æ—¶æ–‡ä»¶
*.tmp
*.temp
*.log

# ç³»ç»Ÿæ–‡ä»¶
.DS_Store
Thumbs.db
EOF

# å®‰å…¨æé†’
echo "ðŸ”’ å®‰å…¨æé†’ï¼š"
echo "   - å·²é…ç½®git-cryptåŠ å¯†ï¼ˆå¦‚æžœå¯ç”¨ï¼‰"
echo "   - å·²åˆ›å»º.gitignoreå¿½ç•¥æ•æ„Ÿæ–‡ä»¶"
echo "   - é¿å…åœ¨æ–‡ä»¶ä¸­è®°å½•æ•æ„Ÿä¿¡æ¯"
echo "   - å®šæœŸå¤‡ä»½é‡è¦æ•°æ®"

# æ¯æ—¥æé†’è®¾ç½®
echo "â° æ¯æ—¥æé†’è®¾ç½®ï¼š"
echo "   å»ºè®®æ·»åŠ cronä»»åŠ¡æ£€æŸ¥é«˜ä¼˜å…ˆçº§TODOï¼š"
echo "   crontab -e"
echo "   æ·»åŠ ï¼š0 9 * * * cd $(pwd) && echo 'æ£€æŸ¥é«˜ä¼˜å…ˆçº§TODO'"

echo "âœ… åˆå§‹åŒ–å®Œæˆï¼"
echo "ðŸ“‹ ä¸‹ä¸€æ­¥ï¼š"
echo "1. é…ç½® Cursor Agent"
echo "2. ç¼–è¾‘ progress.md è®¾ç½®é¡¹ç›®ä¿¡æ¯"
echo "3. å¼€å§‹ä½¿ç”¨è®°å¿†ç³»ç»Ÿ"
echo "4. ä½¿ç”¨ /sfeedback æä¾›åé¦ˆ"
echo "5. ä½¿ç”¨ /saudit æ£€æŸ¥å®‰å…¨çŠ¶æ€"
echo "6. ä½¿ç”¨ /smonitor æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€"
echo "7. ä½“éªŒè‡ªåŠ¨æ ‡è®°å»ºè®®åŠŸèƒ½"
echo "8. ä½¿ç”¨ /forceè®° è®°å½•ç´§æ€¥ä¿¡æ¯"
