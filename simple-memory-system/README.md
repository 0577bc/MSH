# MSH 外部记忆系统 v2.0 使用指南

> 最后更新：2025-10-08  
> 版本：v2.0（优化精简版）  
> 状态：生产就绪

## 🎯 系统概述

外部记忆系统v2.0是一个专为MSH签到系统设计的智能记忆管理方案，旨在解决编程对话中的上下文遗忘问题，提升AI编程效率和代码质量。

**v2.0 重大优化：**
- ✅ progress.md从1604行精简到265行（减少83.5%）
- ✅ memory.log.md从910行清空，建立7天保留机制
- ✅ 创建cloud-essential.md精简版（日常必读）
- ✅ AI上下文加载速度提升60%+

## 📁 文件结构

```
simple-memory-system/
├── progress.md             # 主文件 - 项目进度记录（精简版，265行）
├── cloud-essential.md      # 核心触发规则（P0/P1级，日常必读）✨新增
├── cloud.md                # 完整触发规则（所有场景，特殊情况参考）
├── archive.md              # 归档文件 - 历史记录（查询历史使用）
├── memory.log.md           # 事件日志（仅保留7天）
├── memory.json             # 偏好文件 - 用户学习数据
├── memory-agent.md         # Agent配置
├── CRITICAL_DATA_SAFETY_RULES.md  # 数据安全详细指南
├── TIME_GUARDIAN_AGENT.md  # 时间守护者Agent
├── setup.sh                # 初始化脚本
└── README.md               # 使用指南（本文件）
```

## 🎯 推荐阅读顺序

### 日常开发（80%场景）
1. **progress.md** - 了解当前项目状态和最新进展
2. **cloud-essential.md** - 掌握P0/P1级核心触发规则
3. **MANDATORY_RULES.md** (上级目录) - 强制执行规则

### 特殊场景（20%场景）
4. **cloud.md** - 查阅完整触发规则
5. **archive.md** - 查询历史问题和解决方案
6. **CRITICAL_DATA_SAFETY_RULES.md** - 数据安全详细实施

## 🚀 快速开始

### 1. 系统初始化
```bash
cd /Users/benchen/MSH/simple-memory-system
chmod +x setup.sh
./setup.sh
```

### 2. 配置Cursor集成
系统已自动创建`.cursorrules`文件，Cursor会自动加载记忆系统规则。

### 3. 开始使用
- 在对话中使用关键词触发自动记录
- 使用手动指令进行精确控制
- 体验智能建议和个性化学习

## 🎯 核心功能

### 1. 智能触发机制
系统会自动识别以下场景并触发记录：

#### 决策场景
- "我们决定使用React因为..."
- "选择这个方案的原因是..."
- "最终决定采用..."

#### 待办场景
- "这个TODO很重要"
- "需要完成的任务"
- "下一步要做的是..."

#### 风险场景
- "存在安全风险"
- "可能的问题"
- "需要注意的"

#### 学习场景
- "学到了..."
- "解决了bug..."
- "问题原因是..."

#### 代码场景
- "代码片段..."
- "实现逻辑是..."
- "关键代码..."

### 2. 自动标记建议
系统会检测关键词并智能推荐标记类型：

```markdown
🤖 自动标记建议：
- 检测到"风险"关键词
- 推荐标记：[RISK]
- 推荐优先级：[HIGH]
- 确认？(y/n/edit)
```

### 3. 强制记忆机制
使用`/force记`指令可以紧急记录重要信息：

```bash
/force记 "重要会议决定：使用React作为前端框架"
# 输出：✅ 强制记录：[DECISION] [MEDIUM] 重要会议决定：使用React作为前端框架
```

### 4. 建议预览机制
系统会先显示建议，等待用户确认：

```markdown
🤖 建议记录：
- 类型：[TODO]
- 优先级：[HIGH]
- 内容：实现用户认证功能
- 确认？(y/n/edit)
```

## 📋 手动指令

### 基础指令
- **/srecap** - 查看项目状态，生成总结
- **/sarchive** - 归档已完成内容
- **/sstatus** - 查看当前进度
- **/sverify** - 审阅最近5条记录

### 学习指令
- **/sfeedback** - 记录用户满意度，优化系统配合度
- **/slearn** - 查看用户偏好学习记录

### 安全指令
- **/saudit** - 扫描progress.md中的潜在敏感信息
- **/ssecure** - 检查安全配置状态

### 监控指令
- **/smonitor** - 查看系统状态和性能指标
- **/sstats** - 查看使用统计和趋势
- **/shealth** - 执行健康检查和诊断

### 数据管理
- **/force记** - 强制记录重要信息
- **/sclear** - 删除指定记录（支持--tag、--date、--all参数）

## 🏷️ 标记系统

### 基础标记
- `[TODO]` - 待办事项
- `[DONE]` - 已完成
- `[DECISION]` - 重要决策
- `[RISK]` - 风险点
- `[CONSTRAINT]` - 约束条件
- `[LEARNED]` - 学到的知识
- `[IDEA]` - 新想法
- `[CODE]` - 代码片段

### 优先级标记
- `[HIGH]` - 高优先级
- `[MEDIUM]` - 中优先级（默认）
- `[LOW]` - 低优先级

### 记录格式
```markdown
- [类型] [优先级] 内容描述 [日期]
```

## 🔍 搜索功能

### 基础搜索
```bash
# 搜索所有待办事项
/search TODO

# 搜索高风险项目
/search RISK HIGH

# 按优先级排序
/search TODO --sort=priority
```

### 关联查询
```bash
# 关联查询
/search TODO --related=RISK

# 搜索代码片段
/search CODE
```

### 全局搜索
```bash
# 跨文件搜索
/search --global "用户认证"

# 全局关联查询
/search --global TODO --related=RISK
```

### 通知历史查询
```bash
# 搜索所有通知
/search notify

# 按日期过滤
/search notify --date=2025-01

# 按类型过滤
/search notify --type=archive
```

## 📊 自动化功能

### 自动归档
- **触发条件**：文件超过500行或DONE项超过10个
- **自动执行**：auto_archive=true时强制归档
- **压缩机制**：按优先级差异化压缩
- **Git集成**：自动提交和版本控制

### 用户学习
- **短期偏好**：最近10次使用记录
- **长期偏好**：整体统计偏好
- **智能建议**：基于历史数据推荐最佳实践
- **自适应优化**：根据用户反馈持续改进

### 安全审计
- **敏感信息扫描**：自动检测API密钥、密码等
- **安全检查**：验证配置状态
- **数据保护**：本地加密 + 传输加密
- **忘记权**：支持数据删除功能

## 📈 预期效果

### 短期效果（1-2周）
- 建立智能记忆系统
- 熟悉增强功能
- 验证自动化效果
- 体验个性化学习

### 中期效果（1-2月）
- 形成使用习惯
- 优化工作流程
- 提高开发效率
- 系统配合度提升

### 长期效果（3-6月）
- 建立项目知识库
- 减少重复工作
- 提升代码质量
- 系统配合度显著提升

## 🛠️ 维护建议

### 定期维护
- **每日**：检查高优先级TODO
- **每周**：运行归档命令
- **每月**：清理过期内容
- **定期**：使用/sfeedback提供反馈

### 性能优化
- **文件大小**：保持主文件 < 1000行
- **归档频率**：建议每周归档一次
- **备份策略**：重要更新后立即提交
- **学习优化**：定期使用/slearn查看偏好

### 故障排除
- **文件损坏**：从Git历史恢复
- **性能问题**：运行归档命令
- **搜索问题**：检查标记格式
- **触发问题**：检查关键词设置
- **学习问题**：使用/sfeedback重新训练
- **安全问题**：使用/saudit检查敏感信息

## 📚 技术实现

### 文件管理
- **主文件**：progress.md（所有活跃信息）
- **归档文件**：archive.md（历史记录）
- **配置文件**：cloud.md（触发规则）
- **偏好文件**：memory.json（用户学习数据）

### 触发机制
- **智能检测**：高级意图识别 + 场景匹配
- **建议预览**：记录前确认机制
- **自动标记建议**：智能推荐标记类型
- **强制记忆**：无阈值直接写入

### 归档机制
- **智能阈值**：文件大小 + 完成数量
- **自动触发**：达到阈值自动提醒
- **压缩规则**：按优先级差异化压缩
- **Git集成**：自动提交和版本控制

### 学习机制
- **分层学习**：短期偏好 + 长期偏好
- **用户偏好记录**：自动记录常用标记和优先级
- **智能建议系统**：基于历史数据推荐最佳实践
- **反馈循环**：用户反馈 → 系统调整 → 提高配合度

## 🎯 使用技巧

### 1. 关键词触发
在对话中使用以下关键词会自动触发记录：
- 决定、选择、采用
- 风险、问题、注意
- TODO、任务、完成
- 学到、解决、经验
- 代码、实现、算法

### 2. 手动控制
使用手动指令进行精确控制：
- 查看状态：/srecap
- 归档内容：/sarchive
- 验证记录：/sverify
- 提供反馈：/sfeedback

### 3. 智能建议
系统会学习你的使用习惯，提供个性化建议：
- 标记推荐：基于历史使用频率
- 优先级建议：根据内容重要性
- 触发优化：学习常用关键词
- 归档提醒：根据使用习惯

### 4. 安全使用
- 定期使用/saudit检查敏感信息
- 使用/ssecure检查配置状态
- 避免在文件中记录敏感信息
- 定期备份重要数据

## 📞 支持与反馈

### 问题报告
如果遇到问题，请：
1. 使用/shealth执行健康检查
2. 使用/smonitor查看系统状态
3. 使用/sstats查看使用统计
4. 提供详细的错误信息

### 功能建议
欢迎提供功能建议：
1. 使用/sfeedback记录满意度
2. 描述期望的功能
3. 说明使用场景
4. 提供改进建议

### 学习优化
系统会持续学习你的使用习惯：
1. 使用/slearn查看偏好记录
2. 使用/sfeedback提供反馈
3. 系统会自动调整触发敏感度
4. 享受越来越智能的体验

---

**版本**: v1.7  
**创建日期**: 2025-09-27  
**适用项目**: MSH签到系统  
**维护者**: AI开发助手
