# 📋 操作前检查清单（Pre-Operation Checklist）

> **创建日期**: 2025-10-08  
> **级别**: P0 - 强制执行  
> **状态**: 永久生效  

---

## ⚠️ 重要说明

**在执行任何操作前，必须完成本检查清单。**

这不是可选的建议，而是强制执行的要求。

---

## 🔴 P0级检查 - 时间管理

### 涉及时间的操作（必须执行）

任何包含日期的操作都必须完成以下检查：

#### ✅ 强制步骤

```bash
# 1. 获取当前系统时间
date +%Y-%m-%d
```

- [ ] 已运行 `date +%Y-%m-%d` 命令
- [ ] 已记录当前日期：________________
- [ ] 确认日期格式为：YYYY-MM-DD
- [ ] 确认不使用历史日期
- [ ] 确认不使用推测日期
- [ ] 确认不使用未来日期
- [ ] 确认不使用对话历史中的日期

#### 📝 使用场景检查

- [ ] 创建新文档 → 必须获取当前时间
- [ ] 更新现有文档 → 必须获取当前时间
- [ ] 更新"最后更新"字段 → 必须获取当前时间
- [ ] 记录"完成日期" → 必须获取当前时间
- [ ] 记录"创建日期" → 必须获取当前时间
- [ ] 写入progress.md → 必须获取当前时间
- [ ] 生成报告或总结 → 必须获取当前时间

#### ❌ 禁止行为

- [ ] 确认未使用"昨天的日期"
- [ ] 确认未使用"记忆中的日期"
- [ ] 确认未使用"推测的日期"
- [ ] 确认未使用"对话开始时的日期"

---

## 🔴 P0级检查 - 文档管理

### 涉及文档创建的操作（必须执行）

任何可能创建新文档的操作都必须完成以下检查：

#### ✅ 强制步骤

- [ ] 检查是否为新建 .md 文档
- [ ] 确认用户是否**明确请求**创建文档
- [ ] 检查是否可以在现有文档中扩展内容
- [ ] 如未明确请求，必须先询问用户

#### 📝 用户明确请求检查

用户的话语是否包含以下明确请求：
- [ ] "创建XXX文档"
- [ ] "生成XXX.md文件"
- [ ] "写一个XXX报告"
- [ ] 其他明确的文档创建请求

如果**没有**以上明确请求，**禁止创建新文档**！

#### ✅ 正确做法检查

- [ ] 优先考虑更新 progress.md
- [ ] 优先考虑更新 README.md
- [ ] 优先考虑更新相关现有文档
- [ ] 如需新文档，已先询问用户并获得许可

#### ❌ 禁止行为确认

- [ ] 确认未主动创建日志文件
- [ ] 确认未主动创建报告文件
- [ ] 确认未"善意"创建文档
- [ ] 确认未跳过用户许可步骤

---

## 🔴 P0级检查 - 数据安全

### 涉及数据操作（必须执行）

#### ✅ 代码安全检查

- [ ] 代码中不包含 `.ref().set(allData)`
- [ ] 代码中不包含 `.ref('attendanceRecords').set()`
- [ ] 代码中不包含全量数据覆盖操作
- [ ] 如使用set()，已确认是工具页面而非业务页面
- [ ] 如使用set()，已获得用户多次确认

#### ✅ 数据完整性检查

- [ ] 确认本地数据是完整的
- [ ] 确认不会丢失历史数据
- [ ] 确认有完整的数据备份
- [ ] 确认添加了数据量检查保护
- [ ] 确认用户已经多次确认操作

#### ✅ 操作范围检查

- [ ] 确认是增量更新而非全量覆盖
- [ ] 确认只修改必要的数据
- [ ] 确认不影响其他数据
- [ ] 确认有回滚机制

#### ⚠️ 危险关键词检测

检查对话中是否包含以下关键词：

- [ ] "覆盖Firebase" → 🚨 需要多次确认
- [ ] "清空数据" → 🚨 需要多次确认
- [ ] "重置数据" → 🚨 需要多次确认
- [ ] "全量同步" → ⚠️ 需要确认
- [ ] "批量删除" → ⚠️ 需要确认

如包含以上关键词，必须：
1. 暂停操作
2. 向用户详细说明风险
3. 获得用户明确确认
4. 确认有完整备份

---

## 🔵 P1级检查 - 规则遵守

### 规则检查

- [ ] 已查阅 MANDATORY_RULES.md
- [ ] 已确认操作符合所有P0级规则
- [ ] 已确认操作符合项目规范
- [ ] 已查阅相关的外部记忆系统规则

### 文档检查

- [ ] 已检查 simple-memory-system/progress.md
- [ ] 已检查 simple-memory-system/cloud.md
- [ ] 已检查 CONTEXT-RULES.md
- [ ] 已了解当前项目状态

---

## 🔵 P1级检查 - 操作记录

### 记录准备

- [ ] 准备好记录操作到progress.md
- [ ] 准备好更新相关文档
- [ ] 准备好记录时间戳
- [ ] 准备好记录操作细节

### 备份准备

- [ ] 确认重要文件已备份
- [ ] 确认可以回滚操作
- [ ] 确认有错误恢复方案

---

## 🟢 P2级检查 - 质量保证

### 代码质量

- [ ] 代码完整可运行，无TODO或占位符
- [ ] 包含完整的错误处理
- [ ] 包含必要的注释
- [ ] 遵循编码规范

### 文档质量

- [ ] 文档结构清晰
- [ ] 内容完整准确
- [ ] 格式统一规范
- [ ] 链接有效可用

---

## 📊 检查清单使用流程

```
开始操作
    ↓
检查是否涉及时间
    ↓
是 → 完成P0级时间管理检查
    ↓
检查是否涉及数据
    ↓
是 → 完成P0级数据安全检查
    ↓
完成P1级规则遵守检查
    ↓
完成P1级操作记录检查
    ↓
完成P2级质量保证检查
    ↓
所有检查通过 → 执行操作
    ↓
记录操作到progress.md
```

---

## ❌ 检查失败处理

### 如果任何P0级检查失败

1. **立即停止操作**
2. **不要继续执行**
3. **修正问题**
4. **重新执行检查**
5. **记录失败原因**

### 如果P1级检查失败

1. **评估风险**
2. **决定是否继续**
3. **记录决策原因**
4. **制定补救措施**

### 如果P2级检查失败

1. **记录问题**
2. **计划改进**
3. **可以继续操作**
4. **后续优化**

---

## 📝 检查记录模板

### 操作前检查记录

```markdown
## 操作前检查 - 2025-10-08

**操作类型**: [创建文档/更新文档/数据操作/其他]
**操作描述**: 具体描述要执行的操作

### P0级检查
- [x] 时间管理检查完成
  - 当前系统时间：2025-10-08
  - 使用的时间：2025-10-08
  - 确认无历史日期
- [x] 数据安全检查完成
  - 不涉及数据覆盖
  - 或：已确认数据完整性

### P1级检查
- [x] 规则遵守检查完成
- [x] 操作记录准备完成

### P2级检查
- [x] 质量保证检查完成

**检查结果**: ✅ 所有检查通过，可以执行操作
**执行时间**: 2025-10-08 HH:MM:SS
```

---

## 🔗 相关文档

- 📖 [MANDATORY_RULES.md](./MANDATORY_RULES.md) - 强制执行规则
- 📖 [simple-memory-system/progress.md](./simple-memory-system/progress.md) - 项目进度记录
- 📖 [simple-memory-system/cloud.md](./simple-memory-system/cloud.md) - 规则触发机制
- 📖 [CRITICAL_DATA_SAFETY_RULES.md](./simple-memory-system/CRITICAL_DATA_SAFETY_RULES.md) - 数据安全规则

---

## 🔄 清单更新

**最后更新**: 2025-10-08  
**版本**: 1.0  
**状态**: 永久生效

### 更新历史

- 2025-10-08: 创建PRE_OPERATION_CHECKLIST.md，建立操作前强制检查机制

---

## ⚠️ 最后提醒

**这个检查清单不是形式主义，而是保护系统安全和数据完整性的关键机制。**

每一项检查都有其重要原因：
- 时间检查：防止文档时间错误
- 数据检查：防止数据丢失
- 规则检查：确保系统一致性
- 记录检查：便于问题追踪

**请认真完成每一项检查！**


