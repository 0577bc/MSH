# MSH签到系统 - 系统需求文档

## 📋 系统概述

MSH签到系统是一个基于Web的签到管理平台，支持多小组管理、成员管理、签到记录统计等功能。

## 🎯 核心功能

### 1. 签到管理
- **实时签到**: 支持早到、准时、迟到三种签到状态
- **重复检查**: 基于UUID防止重复签到
- **新成员登记**: 支持现场添加新成员

### 2. 成员管理
- **成员管理页面**: 独立的成员管理界面，标题为"成员管理"
- **小组创建**: 支持创建和管理多个小组
- **成员管理**: 添加、编辑、删除、移动成员
- **序号管理**: 自动生成和重新分配成员序号
- **花名管理**: 支持成员花名的编辑和保存
- **未签到不统计**: 管理不参与统计的人员列表
  - **添加人员搜索**: 支持按姓名和花名搜索所有成员，添加到排除列表
  - **排除列表搜索**: 支持搜索已排除人员，按姓名、花名、组别进行过滤
  - **智能搜索**: 支持多种字段名格式，大小写不敏感，部分匹配
- **人员检索**: 支持姓名和花名的智能搜索功能
- **按钮布局**: 所有管理按钮位于"小组成员管理"区域右侧
- **UUID管理**: 集成到成员管理页面中的UUID编辑器功能，支持UUID查看、编辑和管理
- **小组选择控件**: 正确显示小组名称和映射关系，支持小组筛选和排序

### 3. 数据统计
- **日报表**: 每日签到情况统计
- **季度报表**: 季度签到统计
- **年度报表**: 年度签到统计
- **主日跟踪**: 主日签到跟踪，支持连续缺勤事件管理
  - **事件建立逻辑**: 任何人员连续超过2次没有签到建立事件
  - **事件终止机制**: 缺勤事件需要手动点击"事件终止"才能结束
  - **多事件支持**: 支持同一成员的多个独立缺勤事件
  - **组别名称显示**: 正确显示组别显示名称（如"静静组"而不是"乐清1组"）
  - **事件分类**: 根据缺勤周数分类（2周、3周、4周以上缺勤）

### 4. 数据管理
- **实时同步**: Firebase实时数据库同步
- **本地缓存**: 离线数据支持
- **数据删除**: 支持删除人员、记录、小组
- **UUID管理**: UUID编辑和修复工具
- **防重复提交**: 防止重复保存和同步操作
- **后台同步**: 数据同步在后台执行，提升用户体验
- **Firebase数据拉取优化**: 统一数据状态管理，避免重复拉取，提升性能
  - **统一检查机制**: 所有页面使用`window.newDataManager.isDataLoaded`检查
  - **等待机制**: 最多等待1秒，每100ms检查一次NewDataManager状态
  - **双重检查**: 检查`isDataLoaded`标志和本地数据存在性
  - **性能提升**: 页面切换速度提升约80%，网络请求减少约90%

## 🏗️ 技术架构

### 前端技术
- **HTML5**: 页面结构
- **CSS3**: 样式设计
- **JavaScript ES6+**: 业务逻辑
- **Firebase SDK v8**: 数据同步

### 后端服务
- **Firebase Realtime Database**: 数据存储
- **Firebase Authentication**: 用户认证（预留）
- **Firebase Hosting**: 静态文件托管

### 数据管理
- **NewDataManager**: 统一数据管理
- **本地存储**: localStorage缓存
- **数据同步**: 自动和手动同步

## 📱 页面结构

### 主要页面
1. **index.html**: 主签到页面
2. **summary.html**: 数据汇总页面
3. **attendance-records.html**: 签到记录查看
4. **sunday-tracking.html**: 主日跟踪页面
5. **admin.html**: 系统管理页面
6. **group-management.html**: 成员管理页面
7. **delete-management.html**: 数据删除管理
8. **tools/uuid_editor.html**: UUID编辑器

### 页面功能分布
- **签到功能**: index.html
- **数据查看**: summary.html, attendance-records.html
- **主日跟踪**: sunday-tracking.html (连续缺勤事件管理、小组筛选、事件导出)
- **系统管理**: admin.html
- **成员管理**: group-management.html (小组管理、成员管理、花名编辑、未签到不统计、人员检索)
- **数据删除**: delete-management.html
- **工具页面**: tools/uuid_editor.html

### 页面导航关系
- **index.html** → **summary.html** → **attendance-records.html** → **summary.html**
- **summary.html** → **sunday-tracking.html**
- **admin.html** → **group-management.html**
- **admin.html** → **delete-management.html**

## 🔧 核心组件

### 数据管理器
- **NewDataManager**: 统一数据管理类
- **数据同步**: 本地和远程数据同步
- **变更检测**: 自动检测数据变更
- **冲突解决**: 数据冲突处理

### 工具类
- **utils.js**: 通用工具函数
- **config-manager.js**: 配置管理
- **security.js**: 安全相关功能
- **performance-monitor.js**: 性能监控

### 样式系统
- **style.css**: 主样式文件
- **响应式设计**: 支持移动端
- **主题统一**: 一致的视觉风格

## 📊 数据模型

### 核心数据结构
```javascript
// 小组数据
groups: {
  "小组名": [
    {
      id: "AA001",
      uuid: "uuid-string",
      name: "成员姓名",
      phone: "联系方式",
      gender: "性别",
      baptized: "是否受洗",
      age: "年龄段"
    }
  ]
}

// 签到记录
attendanceRecords: [
  {
    name: "成员姓名",
    memberUUID: "uuid-string",
    group: "小组名",
    time: "签到时间",
    type: "签到类型"
  }
]

// 组别名称映射
groupNames: {
  "小组名": "显示名称"
}
```

## 🔒 安全特性

### 数据安全
- **数据验证**: 输入数据验证
- **UUID唯一性**: 防止数据重复
- **权限控制**: 管理功能保护
- **数据备份**: 自动数据备份

### 操作安全
- **确认机制**: 重要操作需要确认
- **错误处理**: 完善的错误处理
- **日志记录**: 操作日志（已移除）
- **数据恢复**: 数据恢复机制

## 🚀 部署要求

### 环境要求
- **现代浏览器**: Chrome 80+, Firefox 75+, Safari 13+
- **网络连接**: 支持Firebase访问
- **JavaScript**: ES6+支持
- **存储空间**: 至少10MB本地存储

### 配置要求
- **Firebase项目**: 有效的Firebase项目
- **数据库规则**: 适当的数据库安全规则
- **域名配置**: 支持HTTPS的域名

## 📈 性能指标

### 响应时间
- **页面加载**: < 2秒
- **数据同步**: < 1秒
- **操作响应**: < 500ms

### 数据容量
- **成员数量**: 支持1000+成员
- **签到记录**: 支持10000+记录
- **小组数量**: 支持50+小组

## 🔄 更新维护

### 版本管理
- **语义化版本**: 遵循SemVer规范
- **变更日志**: 详细的变更记录
- **向后兼容**: 保持数据兼容性

### 维护策略
- **定期备份**: 自动数据备份
- **性能监控**: 实时性能监控
- **错误报告**: 错误收集和报告

## 📞 技术支持

### 问题报告
- **功能问题**: 通过系统反馈
- **技术问题**: 联系系统管理员
- **数据问题**: 使用数据恢复工具

### 文档资源
- **用户手册**: 详细使用说明
- **技术文档**: 开发文档
- **API文档**: 接口文档

---

**文档版本**: 2.2  
**最后更新**: 2025-01-18  
**维护者**: MSH系统管理员
