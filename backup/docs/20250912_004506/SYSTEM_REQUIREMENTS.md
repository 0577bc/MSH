# MSH签到系统 - 系统需求文档

## 📋 项目概述

**项目名称**：MSH签到系统  
**版本**：2.0  
**最后更新**：2025-01-11  
**维护者**：MSH系统管理员  

### **项目目标**
为MSH教会提供一套完整的数字化签到管理系统，支持多小组管理、实时数据同步、报表生成等功能。

## 🎯 功能需求

### **1. 核心功能**

#### **1.1 签到管理**
- **多小组支持**：支持多个小组的独立管理
- **成员签到**：支持成员快速签到，记录签到时间
- **新成员添加**：支持动态添加新成员到指定小组
- **签到状态显示**：实时显示早到、准时、迟到状态

#### **1.2 数据管理**
- **实时同步**：使用Firebase实时数据库进行数据同步
- **本地缓存**：支持离线使用，数据自动同步
- **数据备份**：自动备份重要数据，支持数据恢复
- **数据导出**：支持CSV格式数据导出

#### **1.3 报表功能**
- **日报表**：生成每日签到统计报表
- **汇总报表**：支持多时间段数据汇总
- **新增人员表**：记录每日新增成员信息
- **数据可视化**：图表展示签到趋势

### **2. 管理功能**

#### **2.1 小组管理**
- **小组创建**：支持创建新的小组
- **小组编辑**：修改小组名称和显示名称
- **小组删除**：删除不需要的小组
- **成员管理**：添加、编辑、删除小组成员

#### **2.2 数据管理**
- **签到记录管理**：查看、编辑、删除签到记录
- **数据清理**：支持批量删除历史数据
- **数据恢复**：支持从备份恢复数据
- **数据验证**：自动验证数据完整性

### **3. 系统功能**

#### **3.1 用户界面**
- **响应式设计**：支持桌面和移动设备
- **直观操作**：简洁易用的用户界面
- **实时反馈**：操作结果实时显示
- **错误处理**：友好的错误提示和处理

#### **3.2 性能优化**
- **快速加载**：页面加载时间优化
- **数据缓存**：智能缓存机制
- **虚拟滚动**：大数据量表格优化
- **懒加载**：按需加载资源

## 🏗️ 技术架构

### **1. 前端技术**
- **HTML5**：页面结构
- **CSS3**：样式和响应式设计
- **JavaScript ES6+**：业务逻辑
- **PWA**：渐进式Web应用

### **2. 后端服务**
- **Firebase Realtime Database**：实时数据存储
- **Firebase Authentication**：用户认证
- **Service Worker**：离线缓存

### **3. 数据管理**
- **NewDataManager**：统一数据管理类
- **本地存储**：localStorage数据缓存
- **数据同步**：自动和手动同步机制
- **冲突解决**：数据冲突自动处理

## 📊 数据结构

### **1. 核心数据**

#### **1.1 小组数据 (groups)**
```javascript
{
  "乐清1组": [
    {
      "name": "成员姓名",
      "phone": "联系电话",
      "gender": "性别",
      "baptized": "是否受洗",
      "age": "年龄段",
      "joinDate": "加入日期",
      "id": "唯一标识符"
    }
  ]
}
```

#### **1.2 小组名称映射 (groupNames)**
```javascript
{
  "乐清1组": "静静组",
  "乐清2组": "张亮组",
  "乐清3组": "晓杰组",
  "培茹组": "培茹组",
  "未分组": "未分组"
}
```

#### **1.3 签到记录 (attendanceRecords)**
```javascript
[
  {
    "name": "成员姓名",
    "group": "所属小组",
    "time": "签到时间",
    "date": "签到日期",
    "id": "记录唯一标识"
  }
]
```

#### **1.4 当日新增人员 (dailyNewcomers)**
```javascript
{
  "2025-01-11_成员姓名": {
    "name": "成员姓名",
    "group": "所属小组",
    "date": "添加日期",
    "timestamp": "添加时间戳"
  }
}
```

### **2. 数据关系**
- 小组数据与小组名称映射一一对应
- 签到记录引用小组和成员信息
- 当日新增人员独立存储，24小时自动清理

## 🔧 系统配置

### **1. Firebase配置**
```javascript
window.firebaseConfig = {
  apiKey: "AIzaSyBMp9_gt3TpRQivmCFTz6g9SSKF-oOo01Y",
  authDomain: "yjys-4102e.firebaseapp.com",
  databaseURL: "https://yjys-4102e-default-rtdb.firebaseio.com/",
  projectId: "yjys-4102e",
  storageBucket: "yjys-4102e.firebasestorage.app",
  messagingSenderId: "690578220792",
  appId: "1:690578220792:web:8e6d537901e2636782fd0d"
};
```

### **2. 系统设置**
- **缓存时间**：5分钟
- **自动同步间隔**：3秒
- **数据清理周期**：24小时
- **备份频率**：每次数据变更

## 📱 页面结构

### **1. 主要页面**
1. **index.html** - 主签到页面
2. **admin.html** - 管理页面
3. **daily-report.html** - 日报表页面
4. **summary.html** - 汇总页面
5. **attendance-records.html** - 签到原始记录
6. **delete-management.html** - 删除管理页面
7. **firebase-monitor.html** - Firebase监控页面
8. **sunday-tracking.html** - 主日跟踪页面

### **2. 核心JavaScript文件**
1. **main.js** - 主页面逻辑
2. **admin.js** - 管理页面逻辑
3. **new-data-manager.js** - 数据管理核心
4. **utils.js** - 工具函数库
5. **daily-report.js** - 日报表逻辑
6. **summary.js** - 汇总页面逻辑
7. **attendance-records.js** - 签到记录逻辑

## 🔒 安全要求

### **1. 数据安全**
- **CSRF保护**：防止跨站请求伪造
- **数据验证**：输入数据严格验证
- **权限控制**：管理员权限验证
- **数据加密**：敏感数据加密存储

### **2. 系统安全**
- **HTTPS**：强制使用安全连接
- **输入过滤**：防止XSS攻击
- **错误处理**：不暴露系统内部信息
- **日志记录**：重要操作日志记录

## 📈 性能要求

### **1. 响应时间**
- **页面加载**：< 3秒
- **数据同步**：< 1秒
- **操作响应**：< 500ms
- **报表生成**：< 5秒

### **2. 并发支持**
- **同时在线用户**：> 100人
- **数据同步频率**：实时
- **缓存命中率**：> 90%
- **系统可用性**：> 99.5%

## 🧪 测试要求

### **1. 功能测试**
- **签到功能**：各种签到场景测试
- **数据同步**：网络异常情况测试
- **报表生成**：大数据量报表测试
- **用户界面**：多设备兼容性测试

### **2. 性能测试**
- **负载测试**：高并发访问测试
- **压力测试**：系统极限测试
- **兼容性测试**：多浏览器测试
- **移动端测试**：移动设备测试

## 📝 维护要求

### **1. 日常维护**
- **数据备份**：每日自动备份
- **日志检查**：定期检查系统日志
- **性能监控**：实时监控系统性能
- **用户反馈**：及时处理用户反馈

### **2. 版本更新**
- **功能更新**：根据用户需求更新功能
- **安全更新**：及时修复安全漏洞
- **性能优化**：持续优化系统性能
- **文档更新**：保持文档与系统同步

## 🔄 更新历史

### **版本 2.0 (2025-01-11)**
- ✅ 实现NewDataManager统一数据管理
- ✅ 修复数据同步和冲突问题
- ✅ 添加当日新增人员快照机制
- ✅ 实现签到原始记录独立页面
- ✅ 优化系统性能和用户体验
- ✅ 完善数据备份和恢复机制
- ✅ 修复全局变量初始化时机问题
- ✅ 修复数据结构验证和清理逻辑
- ✅ 修复同步验证过于严格的问题
- ✅ 修复数据完整性检查和恢复功能
- ✅ 修复表单验证错误
- ✅ 修复模态框显示和隐藏问题
- ✅ 修复编辑和删除功能索引问题
- ✅ 实现智能数据同步机制
- ✅ 添加数据变更自动检测
- ✅ 完善数据清理和恢复流程

### **版本 1.0 (2024-12-01)**
- ✅ 基础签到功能实现
- ✅ Firebase数据同步
- ✅ 多小组管理功能
- ✅ 基础报表功能

## 📞 联系信息

**系统管理员**：MSH技术团队  
**技术支持**：通过GitHub Issues  
**用户反馈**：通过系统内置反馈功能  

---
*本文档将根据系统更新和用户反馈持续维护更新*
