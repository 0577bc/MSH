<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MSH跟踪事件详情</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="./src/style.css">
  <style>
    /* 跟踪事件详情页面专用样式 */
    .event-detail-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .member-info-card {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .absence-details-card {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .tracking-records-list {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .tracking-record-item {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 10px;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    .loading-indicator {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      text-align: center;
      color: #666;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error-message {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 6px;
      padding: 15px;
      color: #721c24;
      margin: 20px 0;
    }
  </style>
  <!-- 引入配置文件 -->
  <script src="./src/smart-config-loader.js"></script>
  <!-- 引入配置管理器 -->
  <script src="./src/config-manager.js"></script>
  <!-- 引入统一缓存管理器 -->
  <script src="./src/unified-cache-manager.js"></script>
  <!-- 引入实时更新管理器 -->
  <script src="./src/real-time-update-manager.js"></script>
  <!-- 引入 Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
  <main>
    <h1>MSH跟踪事件详情</h1>
    
    <!-- 导航按钮 -->
    <section class="button-row">
      <button id="backToTrackingButton" 
              type="button" 
              class="main-button secondary-button"
              aria-label="返回主日跟踪页面">
        返回跟踪列表
      </button>
      <button id="refreshButton" 
              type="button" 
              class="main-button primary-button"
              aria-label="刷新数据">
        🔄 刷新数据
      </button>
    </section>
    
    <!-- 加载状态 -->
    <div id="loadingIndicator" class="loading-indicator hidden">
      <div class="loading-spinner"></div>
      <p>正在加载跟踪事件详情...</p>
    </div>
    
    <!-- 错误信息 -->
    <div id="errorMessage" class="error-message hidden">
      <p id="errorText"></p>
    </div>
    
    <!-- 跟踪事件详情内容 -->
    <div id="eventDetailContent" class="event-detail-container">
      <!-- 成员信息 -->
      <div id="memberInfo" class="member-info-card">
        <h3>成员信息</h3>
        <p>正在加载...</p>
      </div>
      
      <!-- 缺勤详情 -->
      <div id="absenceDetails" class="absence-details-card">
        <h3>缺勤详情</h3>
        <p>正在加载...</p>
      </div>
      
      <!-- 跟踪记录历史 -->
      <div id="trackingHistory" class="tracking-records-list">
        <h3>跟踪记录历史</h3>
        <p>正在加载...</p>
      </div>
      
      <!-- 操作按钮 -->
      <div id="actionButtons" class="action-buttons">
        <!-- 动态生成操作按钮 -->
      </div>
    </div>
  </main>
  
  <!-- 跟踪对话框 -->
  <div id="resolveTrackingDialog" class="edit-dialog hidden-dialog">
    <div class="dialog-content">
      <h3>跟踪</h3>
      <div class="form-group">
        <label for="trackingDate">日期：</label>
        <input type="date" id="trackingDate" required>
      </div>
      <div class="form-group">
        <label for="trackingContent">内容：</label>
        <textarea id="trackingContent" placeholder="请说明跟踪情况..." required></textarea>
      </div>
      <div class="form-group">
        <label for="trackingCategory">类别：</label>
        <select id="trackingCategory" required>
          <option value="">--请选择类别--</option>
          <option value="电话联系">电话联系</option>
          <option value="微信联系">微信联系</option>
          <option value="上门拜访">上门拜访</option>
          <option value="小组聚会">小组聚会</option>
          <option value="其他">其他</option>
        </select>
      </div>
      <div class="form-group">
        <label for="trackingPerson">回馈人员：</label>
        <input type="text" id="trackingPerson" placeholder="请输入回馈人员姓名" required>
      </div>
      <div class="dialog-buttons">
        <button id="confirmResolve" class="save-btn">确认跟踪</button>
        <button id="cancelResolve" class="cancel-btn">取消</button>
      </div>
    </div>
  </div>
  
  <!-- 忽略对话框 -->
  <div id="ignoreTrackingDialog" class="edit-dialog hidden-dialog">
    <div class="dialog-content">
      <h3>终止跟踪事件</h3>
      <div class="form-group">
        <label for="ignoreReason">终止原因：</label>
        <textarea id="ignoreReason" placeholder="请说明终止原因..." required></textarea>
      </div>
      <div class="form-group">
        <label for="ignoreDate">终止日期：</label>
        <input type="date" id="ignoreDate" required>
      </div>
      <div class="dialog-buttons">
        <button id="confirmIgnore" class="save-btn">确认终止</button>
        <button id="cancelIgnore" class="cancel-btn">取消</button>
      </div>
    </div>
  </div>
  
  <script src="./src/utils.js"></script>
  <script src="./src/navigation-utils.js"></script>
  <script src="./src/tracking-event-detail.js"></script>
</body>
</html>
